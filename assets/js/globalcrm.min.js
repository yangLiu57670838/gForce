/*! globalcrm 22-06-2016 */
app.directive("navbarSearch",["$timeout","$http","$location",function($timeout,$http,$location){return{restrict:"A",scope:!1,templateUrl:"navbar-search.html",link:function(scope,element,attrs){scope.submitNavbarSearch=function(searchText){console.log("search input",searchText),console.log("please select from the list")}}}}]),app.directive("menuToggle",["$location",function($location){return{restrict:"A",transclude:!0,replace:!0,scope:{name:"@",icon:"@"},templateUrl:"menu-toggle.html",link:function(scope,element,attrs){icon=attrs.icon,icon&&element.children().first().prepend('<i class="'+icon+'"></i>&nbsp;'),element.children().first().on("click",function(e){e.preventDefault(),link=angular.element(e.currentTarget),link.hasClass("active")?link.removeClass("active"):link.addClass("active")}),scope.isOpen=function(){return folder="/"+$location.path().split("/")[1],folder==attrs.path}}}}]),app.directive("menuLink",function(){return{restrict:"A",transclude:!0,replace:!0,scope:{href:"@",icon:"@",name:"@"},templateUrl:"menu-link.html",controller:["$element","$location","$rootScope",function($element,$location,$rootScope){this.getName=function(name){return void 0!==name?name:$element.find("a").text().trim()},this.setBreadcrumb=function(name){$rootScope.pageTitle=this.getName(name)},this.isSelected=function(href){return $location.path()==href.slice(1,href.length)}}],link:function(scope,element,attrs,linkCtrl){icon=attrs.icon,icon&&element.children().first().prepend('<i class="'+icon+'"></i>&nbsp;'),linkCtrl.isSelected(attrs.href)&&linkCtrl.setBreadcrumb(attrs.name),element.click(function(){linkCtrl.setBreadcrumb(attrs.name)}),scope.isSelected=function(){return linkCtrl.isSelected(attrs.href)}}}}),app.directive("scrollSpy",["$window",function($window){return{link:function(scope,element,attrs){angular.element($window).bind("scroll",function(){scope.scroll=this.pageYOffset,scope.$$phase||scope.$apply()})}}}]),app.directive("navbarScroll",function($window){return{restrict:"A",link:function(scope,element,attr){var navbar=angular.element(".main-container .navbar");angular.element($window).bind("scroll",function(){this.pageYOffset>0?navbar.addClass("scroll"):navbar.removeClass("scroll")})}}}),app.directive("nouiSlider",function(){return{restrict:"A",link:function(scope,element,attrs){var bind=angular.element(attrs.bind),bindRange=angular.element(attrs.bindRange),indicator=angular.element(attrs.indicator);bind.length&&(start=bind.val()),start=attrs.start?attrs.start:0,range=attrs.range?attrs.range:0,range?(startPoint=[start,range],element.addClass("noUi-range")):startPoint=[start],step=attrs.step?parseInt(attrs.step):0,min=attrs.min?parseInt(attrs.min):0,max=attrs.max?parseInt(attrs.max):10,$(element).noUiSlider({start:startPoint,step:step,range:{min:[min],max:[max]}}),"true"===indicator.selector&&$(element).on("slide set change",function(a,b){$(this).find(".noUi-handle div").length||$(this).find(".noUi-handle").append("<div>"+b+"</div>"),$(this).find(".noUi-handle div").html(b)}),$(element).on("slide",function(a,b){bindRange.length?(v=parseInt(b[0]),v2=parseInt(b[1])):v=parseInt(b),bind.length&&(void 0!==bind[0].value?bind.val(v):bind.html(v)),bindRange.length&&(void 0!==bindRange[0].value?bindRange.val(v2):bindRange.html(v2))})}}}),app.filter("nospace",function(){return function(value){return value?value.replace(/ /g,""):""}}),app.controller("adminbookingsCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location","$rootScope",function($scope,$http,$interval,$filter,NgTableParams,$routeParams,$location,$rootScope){function findCustomers(){$http.get("/findNewBookingCustomersSalesdone?office="+$rootScope.office).success(function(data){for(console.log("looking for customers in:",$rootScope.office),console.log("test all data",data),$scope.customers=data,i=0;i<data.length;i++)$scope.customers[i].time=data[i].time.substring(0,10);$scope.customersTable=new NgTableParams({page:1,count:10,sorting:{time:"asc"}},{total:$scope.customers.length,getData:function(params){return $scope.data=params.sorting()?$filter("orderBy")($scope.customers,params.orderBy()):$scope.customers,$scope.data=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data,$scope.data=$scope.data.slice((params.page()-1)*params.count(),params.page()*params.count()),$scope.data}})})}"superadmin"==$scope.staffRole||"admin"==$scope.staffRole?console.log("works fine"):(console.log("no permission dude"),$location.path("/")),$rootScope.complianceActive=!1,findCustomers(),$scope.viewProfile=function(user){var cid=user.cid;console.log(user.cid),$location.path("/viewProfile/"+cid)}}]),app.controller("bookingsCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location","$rootScope",function($scope,$http,$interval,$filter,NgTableParams,$routeParams,$location,$rootScope){function findCustomers(){$http.get("/findNewBookingCustomers?office="+$rootScope.office).success(function(data){for(console.log("looking for customers in:",$rootScope.office),console.log("test all data",data),$scope.customers=data,i=0;i<data.length;i++)$scope.customers[i].time=data[i].time.substring(0,10);$scope.customersTable=new NgTableParams({page:1,count:10,sorting:{time:"asc"}},{total:$scope.customers.length,getData:function(params){return $scope.data=params.sorting()?$filter("orderBy")($scope.customers,params.orderBy()):$scope.customers,$scope.data=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data,$scope.data=$scope.data.slice((params.page()-1)*params.count(),params.page()*params.count()),$scope.data}})})}"superadmin"==$scope.staffRole||"sales"==$scope.staffRole?console.log("works fine"):(console.log("no permission dude"),$location.path("/")),$rootScope.complianceActive=!1,findCustomers(),$scope.viewProfile=function(user){var cid=user.cid;console.log(user.cid),$location.path("/viewProfile/"+cid)}}]),app.controller("commissionCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location","$rootScope","$aside","$window","$route",function($scope,$http,$interval,$filter,NgTableParams,$routeParams,$location,$rootScope,$aside,$window,$route){function findAllBambooStaff(){$http.get("/findAllBambooStaff").success(function(data){for(console.log("bamboo data",data),$scope.allStaffs=[],$scope.allBambooList=[],i=0;i<data.length;i++)if("Sales"==data[i].fields.department){var name=data[i].fields.firstName+" "+data[i].fields.lastName;$scope.allStaffs.push(name);var one={name:name,office:data[i].fields.location};$scope.allBambooList.push(one)}console.log("staff name list",$scope.allStaffs),console.log("all Bamboo List",$scope.allBambooList),$scope.selected={value:"Select Staff Name"},$scope.payrunDateList={availableOptions:[{id:"1",string:"Pay Run 1 (28/12/2015 - 08/01/2016)",begin:"2015-12-28",end:"2016-01-08"},{id:"2",string:"Pay Run 2 (11/01/2016 - 22/01/2016)",begin:"2016-01-11",end:"2016-01-22"},{id:"3",string:"Pay Run 3 (25/01/2016 - 05/02/2016)",begin:"2016-01-25",end:"2016-02-05"},{id:"4",string:"Pay Run 4 (08/02/2016 - 19/02/2016)",begin:"2016-02-08",end:"2016-02-19"},{id:"5",string:"Pay Run 5 (22/02/2016 - 04/03/2016)",begin:"2016-02-22",end:"2016-03-04"},{id:"6",string:"Pay Run 6 (07/03/2016 - 18/03/2016)",begin:"2016-03-07",end:"2016-03-18"},{id:"7",string:"Pay Run 7 (21/03/2016 - 01/04/2016)",begin:"2016-03-21",end:"2016-04-01"},{id:"8",string:"Pay Run 8 (04/04/2016 - 15/04/2016)",begin:"2016-04-04",end:"2016-04-15"},{id:"9",string:"Pay Run 9 (18/04/2016 - 29/04/2016)",begin:"2016-04-18",end:"2016-04-29"},{id:"10",string:"Pay Run 10 (02/05/2016 - 13/05/2016)",begin:"2016-05-02",end:"2016-05-13"},{id:"11",string:"Pay Run 11 (16/05/2016 - 27/05/2016)",begin:"2016-05-16",end:"2016-05-27"},{id:"12",string:"Pay Run 12 (30/05/2016 - 10/06/2016)",begin:"2016-05-30",end:"2016-06-10"},{id:"13",string:"Pay Run 13 (13/06/2016 - 24/06/2016)",begin:"2016-06-13",end:"2016-06-24"},{id:"14",string:"Pay Run 14 (27/06/2016 - 08/07/2016)",begin:"2016-06-27",end:"2016-07-08"},{id:"15",string:"Pay Run 15 (11/07/2016 - 22/07/2016)",begin:"2016-07-11",end:"2016-07-22"},{id:"16",string:"Pay Run 16 (25/07/2016 - 05/08/2016)",begin:"2016-07-25",end:"2016-08-05"},{id:"17",string:"Pay Run 17 (08/08/2016 - 19/08/2016)",begin:"2016-08-08",end:"2016-08-19"},{id:"18",string:"Pay Run 18 (22/08/2016 - 02/09/2016)",begin:"2016-08-22",end:"2016-09-02"},{id:"19",string:"Pay Run 19 (05/09/2016 - 16/09/2016)",begin:"2016-09-05",end:"2016-09-16"},{id:"20",string:"Pay Run 20 (19/09/2016 - 30/09/2016)",begin:"2016-09-19",end:"2016-09-30"},{id:"21",string:"Pay Run 21 (03/10/2016 - 14/10/2016)",begin:"2016-10-03",end:"2016-10-14"},{id:"22",string:"Pay Run 22 (17/10/2016 - 28/10/2016)",begin:"2016-10-17",end:"2016-10-28"},{id:"23",string:"Pay Run 23 (31/10/2016 - 11/11/2016)",begin:"2016-10-31",end:"2016-11-11"},{id:"24",string:"Pay Run 24 (14/11/2016 - 25/11/2016)",begin:"2016-11-14",end:"2016-11-25"},{id:"25",string:"Pay Run 25 (28/11/2016 - 09/12/2016)",begin:"2016-11-28",end:"2016-12-09"},{id:"26",string:"Pay Run 26 (12/12/2016 - 23/12/2016)",begin:"2016-12-12",end:"2016-12-23"}],selectedOption:{id:"1",string:"Pay Run 1 (28/12/2015 - 08/01/2016)",begin:"2015-12-28",end:"2016-01-08"}},$scope.payrunSelectChange=function(){},$scope.searchCommissions=function(){console.log($scope.selected.value),searchCommissionList(),searchPresentationList(),$scope.presentationStatusAdding={availableOptions:[{id:"pending",name:"Pending"},{id:"declined",name:"Declined"},{id:"approved",name:"Approved"}],selectedOption:{id:"pending",name:"Pending"}},$scope.addNewPresentation=function(){for(addPresentationTPL.show(),$scope.staffAdding=$scope.selected.value,i=0;i<$scope.allBambooList.length;i++)$scope.allBambooList[i].name==$scope.selected.value&&($scope.officeAdding=$scope.allBambooList[i].office)},$scope.hideAddPresentationTPL=function(){addPresentationTPL.hide()},$scope.addP=function(attendDateAdding,presentationAdding,presentationAmountAdding){$http.post("/addP?attendDateAdding="+attendDateAdding+"&presentationAdding="+presentationAdding+"&presentationAmountAdding="+presentationAmountAdding+"&staffAdding="+$scope.staffAdding+"&officeAdding="+$scope.officeAdding+"&status="+$scope.presentationStatusAdding.selectedOption.id).success(function(data){addPresentationTPL.hide(),searchPresentationList()})}},$scope.searchAllArchive=function(){$http.get("/searchAllArchive").success(function(data2){$scope.list=data2;for(var i=0;i<$scope.list.length;i++)$scope.list[i].tableIndex=i+1,$scope.list[i].first_name?$scope.list[i].fullname=$scope.list[i].first_name+" "+$scope.list[i].last_name:$scope.list[i].fullname="NA",$scope.list[i].cid?$scope.list[i].bookingStatus="Received":$scope.list[i].bookingStatus="Not Received";$scope.resumesTable=new NgTableParams({page:1,count:10,sorting:{tableIndex:"desc"}},{total:$scope.list.length,getData:function(params){return $scope.data=params.sorting()?$filter("orderBy")($scope.list,params.orderBy()):$scope.list,$scope.data=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data,$scope.data=$scope.data.slice((params.page()-1)*params.count(),params.page()*params.count()),$scope.data}})}),$http.get("/searchAllPresentationArchive").success(function(data3){$scope.presentationList=data3;for(var i=0;i<$scope.presentationList.length;i++)$scope.presentationList[i].tableIndex=i+1;$scope.presentationTable=new NgTableParams({page:1,count:10,sorting:{tableIndex:"desc"}},{total:$scope.presentationList.length,getData:function(params){return $scope.data2=params.sorting()?$filter("orderBy")($scope.presentationList,params.orderBy()):$scope.presentationList,$scope.data2=params.filter()?$filter("filter")($scope.data2,params.filter()):$scope.data2,$scope.data2=$scope.data2.slice((params.page()-1)*params.count(),params.page()*params.count()),$scope.data2}})})},$scope.deductioncurrency={availableOptions:[{id:"GBP",name:"GBP"},{id:"USD",name:"USD"},{id:"AUD",name:"AUD"},{id:"CAD",name:"CAD"}],selectedOption:{id:"AUD",name:"AUD"}},$scope.bonuscurrency={availableOptions:[{id:"GBP",name:"GBP"},{id:"USD",name:"USD"},{id:"AUD",name:"AUD"},{id:"CAD",name:"CAD"}],selectedOption:{id:"AUD",name:"AUD"}},$scope.updateThisPage=function(){console.log($scope.data[0].commission),console.log("all data",$scope.data),$scope.commission_ids="",$scope.allChangedCommissions=[],$scope.totalCommission=0;for(var i=0;i<$scope.data.length;i++)if("pending"!=$scope.data[i].sales_status){$scope.commission_ids=$scope.commission_ids+$scope.data[i].sales_id+",";var oneChangedCommission={id:$scope.data[i].sales_id,status:$scope.data[i].sales_status,amount:$scope.data[i].commission};$scope.allChangedCommissions.push(oneChangedCommission),"approved"==$scope.data[i].sales_status&&($scope.totalCommission=$scope.totalCommission+parseInt($scope.data[i].commission))}$scope.approvedPresentation_ids="";for(var j=0;j<$scope.data2.length;j++)if("approved"==$scope.data2[j].status){var pid=$scope.data2[j].presentation_id;$scope.approvedPresentation_ids=$scope.approvedPresentation_ids+pid+",",$scope.totalCommission=$scope.totalCommission+parseInt($scope.data2[j].amount)}console.log("changed status commissions",$scope.allChangedCommissions),$scope.totalCommission=$scope.totalCommission+parseInt($scope.bonusAmount)-parseInt($scope.deductionAmount)-parseInt($scope.tableFee),console.log("total commission is ",$scope.totalCommission),$http.post("/addPayroll?approvedPresentation_ids="+$scope.approvedPresentation_ids+"&tableFee="+$scope.tableFee+"&bonusAmount="+$scope.bonusAmount+"&bonusCurrency="+$scope.bonuscurrency.selectedOption.id+"&bonusDescription="+$scope.bonusDescription+"&deductionAmount="+$scope.deductionAmount+"&deductionCurrency="+$scope.deductioncurrency.selectedOption.id+"&deductionDescription="+$scope.deductionDescription+"&commissionIds="+$scope.commission_ids+"&staff="+$scope.selected.value+"&user="+$rootScope.name+"&payrollNo="+$scope.payrunDateList.selectedOption.id+"&totalcommissionamount="+$scope.totalCommission).success(function(datar){$scope.tableFee=0,console.log("success",datar),$rootScope.startAlert("success","Success","Well done! You have successfully saved a new payroll recoreds.","md md-done"),$scope.updateEnd=!1,$scope.presentationUpdateEnd=!1;for(var j=0;j<$scope.allChangedCommissions.length;j++)j==$scope.allChangedCommissions.length-1&&($scope.updateEnd=!0),updatecommission($scope.allChangedCommissions[j].id,$scope.allChangedCommissions[j].amount,$scope.allChangedCommissions[j].status);for(var t=0;t<$scope.data2.length;t++)t==$scope.data2.length-1&&($scope.presentationUpdateEnd=!0),updatePresentation($scope.data2[t].presentation_id,$scope.data2[t].attend_day,$scope.data2[t].presentation,$scope.data2[t].status,$scope.data2[t].amount)})};var editCommissionTPL=$aside({scope:$scope,template:"../sales/editCommissionTPL.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-bottom"});$scope.viewCommissionDetail=function(r){editCommissionTPL.show(),$scope.editingCommission=r,$scope.editingCommission.commission=parseInt(r.commission),$scope.editingCommissionCurrency={availableOptions:[{id:"GBP",name:"GBP"},{id:"USD",name:"USD"},{id:"AUD",name:"AUD"},{id:"CAD",name:"CAD"}],selectedOption:{id:$scope.editingCommission.currency,name:$scope.editingCommission.currency}},$scope.editingCommissionStatus={availableOptions:[{id:"pending",name:"pending"},{id:"declined",name:"declined"},{id:"approved",name:"approved"}],selectedOption:{id:$scope.editingCommission.sales_status,name:$scope.editingCommission.sales_status}},$scope.editingCommissionOffice={availableOptions:[{id:"Australia",name:"Australia"},{id:"Canada",name:"Canada"},{id:"UK",name:"UK"}],selectedOption:{id:$scope.editingCommission.office,name:$scope.editingCommission.office}},$scope.updateCommissionDetail=function(editingCommission){console.log("testg test tesgt",editingCommission),$http.post("/updateCommissionDetail?id="+editingCommission.sales_id+"&amount="+editingCommission.commission+"&currency="+$scope.editingCommissionCurrency.selectedOption.id+"&status="+$scope.editingCommissionStatus.selectedOption.id+"&staff="+editingCommission.staff+"&office="+$scope.editingCommissionOffice.selectedOption.id+"&note="+editingCommission.note+"&email="+editingCommission.customer_email).success(function(data){editCommissionTPL.hide()})}},$scope.hideEditCommissionTPL=function(){editCommissionTPL.hide()};var editPresentationTPL=$aside({scope:$scope,template:"../sales/editPresentationTPL.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-bottom"});$scope.viewPresentationDetail=function(p){editPresentationTPL.show(),$scope.editingPresentation=p,$scope.editingPresentationStatus={availableOptions:[{id:"pending",name:"Pending"},{id:"declined",name:"Declined"},{id:"approved",name:"Approved"}],selectedOption:{id:$scope.editingPresentation.status,name:$scope.editingPresentation.status}},$scope.editingPresentation.presentation=parseInt(p.presentation),$scope.editingPresentation.amount=parseInt(p.amount),$scope.hideEditPresentationTPL=function(){editPresentationTPL.hide(),$scope.editingPresentation=p},$scope.cancelPresentationDetail=function(){$scope.editingPresentation=p}},$scope.updatePresentationDetail=function(editingPresentation){$http.post("/updatePresentationDetail?pid="+editingPresentation.presentation_id+"&attenday="+editingPresentation.attend_day+"&presentation="+editingPresentation.presentation+"&status="+$scope.editingPresentationStatus.selectedOption.id+"&amount="+editingPresentation.amount).success(function(data){editPresentationTPL.hide()})},$scope.viewprofile=function(cid){$window.open($rootScope.remoteURL+"/views/main/main.html#/viewProfile/"+cid,"_blank")}})}function updatecommission(id,amount,status){$http.post("/updatecommission?id="+id+"&amount="+amount+"&status="+status).success(function(data){console.log("one record",data),$scope.updateEnd&&($scope.updateEnd=!1,$rootScope.startAlert("success","Success","Well done! You have successfully updated all commission recoreds.","md md-done"))})}function updatePresentation(pid,attendDay,presentation,status,amount){$http.post("/updatePresentation?pid="+pid+"&attendDay="+attendDay+"&presentation="+presentation+"&status="+status+"&amount="+amount).success(function(data){console.log("one record",data),$scope.presentationUpdateEnd&&($scope.presentationUpdateEnd=!1,$rootScope.startAlert("success","Success","Well done! You have successfully updated all presentation recoreds.","md md-done"))})}function searchCommissionList(){$http.get("/searchCommissions?staff="+$scope.selected.value+"&startdate="+$scope.payrunDateList.selectedOption.begin+"&enddate="+$scope.payrunDateList.selectedOption.end).success(function(data){$scope.list=data;for(var i=0;i<$scope.list.length;i++)$scope.list[i].tableIndex=i+1,console.log("repeat",$scope.list[i].cid),$scope.list[i].first_name?$scope.list[i].fullname=$scope.list[i].first_name+" "+$scope.list[i].last_name:$scope.list[i].fullname="NA",$scope.list[i].cid?$scope.list[i].bookingStatus="Received":$scope.list[i].bookingStatus="Not Received";$scope.resumesTable=new NgTableParams({page:1,count:10,sorting:{tableIndex:"desc"}},{total:$scope.list.length,getData:function(params){return $scope.data=params.sorting()?$filter("orderBy")($scope.list,params.orderBy()):$scope.list,$scope.data=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data,$scope.data=$scope.data.slice((params.page()-1)*params.count(),params.page()*params.count()),$scope.data}})})}function searchPresentationList(){$http.get("/searchPresentation?staff="+$scope.selected.value+"&startdate="+$scope.payrunDateList.selectedOption.begin+"&enddate="+$scope.payrunDateList.selectedOption.end).success(function(data){$scope.presentationList=data,console.log(data);for(var i=0;i<$scope.presentationList.length;i++)$scope.presentationList[i].tableIndex=i+1;$scope.presentationTable=new NgTableParams({page:1,count:10,sorting:{tableIndex:"desc"}},{total:$scope.presentationList.length,getData:function(params){return $scope.data2=params.sorting()?$filter("orderBy")($scope.presentationList,params.orderBy()):$scope.presentationList,$scope.data2=params.filter()?$filter("filter")($scope.data2,params.filter()):$scope.data2,$scope.data2=$scope.data2.slice((params.page()-1)*params.count(),params.page()*params.count()),$scope.data2}})})}"superadmin"==$scope.staffRole||"sales"==$scope.staffRole?console.log("works fine"):(console.log("no permission dude"),$location.path("/")),$scope.tableFee=0;var addPresentationTPL=$aside({scope:$scope,template:"../sales/addPresentationTPL.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-bottom"});findAllBambooStaff()}]),app.controller("complianceCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location","$rootScope",function($scope,$http,$interval,$filter,NgTableParams,$routeParams,$location,$rootScope){function searchallName(){$http.get("/searchComplianceName").success(function(data){$scope.all=data,console.log($scope.all)})}function searchComplianceName(){var fullname=[];for(i=0;i<$scope.all.length;i++){var f=$scope.all[i].first_name+", "+$scope.all[i].last_name;fullname.push(f)}$scope.customerss=fullname}$scope.all=[],"superadmin"==$scope.staffRole||"compliance"==$scope.staffRole?console.log("works fine"):(console.log("no permission dude"),$location.path("/")),searchallName(),$scope.showChanged=function(){isNaN($scope.selectedCustomer)?searchComplianceName():console.log("......")},$scope.addCompliance=function(){function getCID(){$http.get("/getCID2?customerName2="+$scope.selectedCustomer).success(function(data){console.log("test return data",data),1==data.length?(console.log("cid is:",data[0].cid),console.log("input is:",$scope.selectedCustomer),$scope.cid=data[0].cid,addcompliance()):(console.log($scope.selectedCustomer,"test test test"),$rootScope.startAlert("danger","Error","Please type a correct customer name","md md-error"),$location.path("/compliance"))})}function addcompliance(){$http.post("/addcompliance?introCheckA="+$scope.introCheckA+"&introCommentsA="+$scope.introCommentsA+"&introCheckB="+$scope.introCheckB+"&introCommentsB="+$scope.introCommentsB+"&qualificationCheckA="+$scope.qualificationCheckA+"&qualificationCommentsA="+$scope.qualificationCommentsA+"&qualificationCheckB="+$scope.qualificationCheckB+"&qualificationCommentsB="+$scope.qualificationCommentsB+"&qualificationCheckC="+$scope.qualificationCheckC+"&qualificationCommentsC="+$scope.qualificationCommentsC+"&qualificationCheckD="+$scope.qualificationCheckD+"&qualificationCommentsD="+$scope.qualificationCommentsD+"&qualificationCheckE="+$scope.qualificationCheckE+"&qualificationCommentsE="+$scope.qualificationCommentsE+"&backgroundCheckA="+$scope.backgroundCheckA+"&backgroundCommentsA="+$scope.backgroundCommentsA+"&selectionCheckA="+$scope.selectionCheckA+"&selectionCommentsA="+$scope.selectionCommentsA+"&selectionCheckB="+$scope.selectionCheckB+"&selectionCommentsB="+$scope.selectionCommentsB+"&selectionCheckC="+$scope.selectionCheckC+"&selectionCommentsC="+$scope.selectionCommentsC+"&selectionCheckD="+$scope.selectionCheckD+"&selectionCommentsD="+$scope.selectionCommentsD+"&selectionCheckE="+$scope.selectionCheckE+"&selectionCommentsE="+$scope.selectionCommentsE+"&selectionCheckF="+$scope.selectionCheckF+"&selectionCommentsF="+$scope.selectionCommentsF+"&selectionCheckG="+$scope.selectionCheckG+"&selectionCommentsG="+$scope.selectionCommentsG+"&costCheckA="+$scope.costCheckA+"&costCommentsA="+$scope.costCommentsA+"&costCheckB="+$scope.costCheckB+"&costCommentsB="+$scope.costCommentsB+"&costCheckC="+$scope.costCheckC+"&costCommentsC="+$scope.costCommentsC+"&costCheckD="+$scope.costCheckD+"&costCommentsD="+$scope.costCommentsD+"&costCheckE="+$scope.costCheckE+"&costCommentsE="+$scope.costCommentsE+"&costCheckF="+$scope.costCheckF+"&costCommentsF="+$scope.costCommentsF+"&costCheckG="+$scope.costCheckG+"&costCommentsG="+$scope.costCommentsG+"&urgencyCheckA="+$scope.urgencyCheckA+"&urgencyCommentsA="+$scope.urgencyCommentsA+"&urgencyCheckB="+$scope.urgencyCheckB+"&urgencyCommentsB="+$scope.urgencyCommentsB+"&urgencyCheckC="+$scope.urgencyCheckC+"&urgencyCommentsC="+$scope.urgencyCommentsC+"&urgencyCheckD="+$scope.urgencyCheckD+"&urgencyCommentsD="+$scope.urgencyCommentsD+"&urgencyCheckE="+$scope.urgencyCheckE+"&urgencyCommentsE="+$scope.urgencyCommentsE+"&othersCheckA="+$scope.othersCheckA+"&othersCommentsA="+$scope.othersCommentsA+"&othersCheckB="+$scope.othersCheckB+"&othersCommentsB="+$scope.othersCommentsB+"&othersCheckC="+$scope.othersCheckC+"&othersCommentsC="+$scope.othersCommentsC+"&othersCheckD="+$scope.othersCheckD+"&othersCommentsD="+$scope.othersCommentsD+"&othersCheckE="+$scope.othersCheckE+"&othersCommentsE="+$scope.othersCommentsE+"&othersCheckF="+$scope.othersCheckF+"&othersCommentsF="+$scope.othersCommentsF+"&cid="+$scope.cid+"&yellowflag="+$scope.yellowflag+"&redflag="+$scope.redflag).success(function(data){$rootScope.startAlert("success","Success","Well done! You have successfully submitted a new compliance form.","md md-done"),$location.path("/listCompliance")})}$scope.introCheckA&&$scope.introCheckB&&$scope.qualificationCheckA&&$scope.qualificationCheckB&&$scope.qualificationCheckC&&$scope.qualificationCheckD&&$scope.qualificationCheckE&&$scope.backgroundCheckA&&$scope.selectionCheckA&&$scope.selectionCheckB&&$scope.selectionCheckC&&$scope.selectionCheckD&&$scope.selectionCheckE&&$scope.selectionCheckF&&$scope.selectionCheckG&&$scope.costCheckA&&$scope.costCheckB&&$scope.costCheckC&&$scope.costCheckD&&$scope.costCheckE&&$scope.costCheckF&&$scope.costCheckG&&$scope.urgencyCheckA&&$scope.urgencyCheckB&&$scope.urgencyCheckC&&$scope.urgencyCheckD&&$scope.urgencyCheckE?($scope.redflag=0,$scope.yellowflag=0,"no"==$scope.introCheckB&&($scope.yellowflag=$scope.yellowflag+1),"no"==$scope.qualificationCheckC&&($scope.yellowflag=$scope.yellowflag+1),"no"==$scope.qualificationCheckD&&($scope.yellowflag=$scope.yellowflag+1),"yes"==$scope.selectionCheckC&&($scope.redflag=$scope.redflag+1),"yes"==$scope.selectionCheckD&&($scope.redflag=$scope.redflag+1),"yes"==$scope.selectionCheckE&&($scope.redflag=$scope.redflag+1),"yes"==$scope.selectionCheckF&&($scope.redflag=$scope.redflag+1),"yes"==$scope.selectionCheckG&&($scope.redflag=$scope.redflag+1),"no"==$scope.costCheckC&&($scope.redflag=$scope.redflag+1),"no"==$scope.costCheckD&&($scope.redflag=$scope.redflag+1),"yes"==$scope.costCheckE&&($scope.redflag=$scope.redflag+1),"yes"==$scope.costCheckG&&($scope.redflag=$scope.redflag+1),"yes"==$scope.urgencyCheckA&&($scope.yellowflag=$scope.yellowflag+1),"yes"==$scope.urgencyCheckB&&($scope.yellowflag=$scope.yellowflag+1),"yes"==$scope.urgencyCheckC&&($scope.yellowflag=$scope.yellowflag+1),"yes"==$scope.urgencyCheckE&&($scope.redflag=$scope.redflag+1),getCID()):($rootScope.startAlert("danger","Error","Please fullfill every question","md md-error"),$location.path("/compliance"))}}]),app.controller("complianceDetailsCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location",function($scope,$http,$interval,$filter,NgTableParams,$routeParams,$location){function getComplianceDetails(){$http.get("/getComplianceDetails?qid="+$scope.qid).success(function(data){$scope.date=data[0].date,$scope.redflag=data[0].redflag,$scope.yellowflag=data[0].yellowflag,$scope.introCheckA=data[0].consultant_name_check,$scope.introCommentsA=data[0].consultant_name_comments,$scope.introCheckB=data[0].company_name_check,$scope.introCommentsB=data[0].company_name_comments,$scope.qualificationCheckA=data[0].age_check,$scope.qualificationCommentsA=data[0].age_comments,$scope.qualificationCheckB=data[0].citizenship_check,$scope.qualificationCommentsB=data[0].citizenship_comments,$scope.qualificationCheckC=data[0].driving_offense_check,$scope.qualificationCommentsC=data[0].driving_offense_comments,$scope.qualificationCheckD=data[0].criminal_convictions_check,$scope.qualificationCommentsD=data[0].criminal_convictions_comments,$scope.qualificationCheckE=data[0].wh_visa_check,$scope.qualificationCommentsE=data[0].wh_visa_comments,$scope.backgroundCheckA=data[0].amount_travellers_check,$scope.backgroundCommentsA=data[0].amount_travellers_comments,$scope.selectionCheckA=data[0].departure_date_check,$scope.selectionCommentsA=data[0].departure_date_comments,$scope.selectionCheckB=data[0].min_time_check,$scope.selectionCommentsB=data[0].min_time_comments,$scope.selectionCheckC=data[0].job_placement_check,$scope.selectionCommentsC=data[0].job_placement_comments,$scope.selectionCheckD=data[0].job_type_check,$scope.selectionCommentsD=data[0].job_type_comments,$scope.selectionCheckE=data[0].location_check,$scope.selectionCommentsE=data[0].location_comments,$scope.selectionCheckF=data[0].wage_check,$scope.selectionCommentsF=data[0].wage_comments,$scope.selectionCheckG=data[0].work_hour_check,$scope.selectionCommentsG=data[0].work_hour_comments,$scope.costCheckA=data[0].money_save_check,$scope.costCommentsA=data[0].money_save_comments,$scope.costCheckB=data[0].cost_estimate_check,$scope.costCommentsB=data[0].cost_estimate_comments,$scope.costCheckC=data[0].program_price_check,$scope.costCommentsC=data[0].program_price_comments,$scope.costCheckD=data[0].exclusions_check,$scope.costCommentsD=data[0].exclusions_comments,$scope.costCheckE=data[0].flight_cost_check,$scope.costCommentsE=data[0].flight_cost_comments,$scope.costCheckF=data[0].visa_cost_check,$scope.costCommentsF=data[0].visa_cost_comments,$scope.costCheckG=data[0].insurance_cost_check,$scope.costCommentsG=data[0].insurance_cost_comments,$scope.urgencyCheckA=data[0].remaining_spots_check,$scope.urgencyCommentsA=data[0].remaining_spots_comments,$scope.urgencyCheckB=data[0].closing_week_check,$scope.urgencyCommentsB=data[0].closing_week_comments,$scope.urgencyCheckC=data[0].promotion_check,$scope.urgencyCommentsC=data[0].promotion_comments,$scope.urgencyCheckD=data[0].drop_price_check,$scope.urgencyCommentsD=data[0].drop_price_comments,$scope.urgencyCheckE=data[0].deposit_refund_check,$scope.urgencyCommentsE=data[0].deposit_refund_comments,$scope.othersCheckA=data[0].payment_plan_check,$scope.othersCommentsA=data[0].payment_plan_comments,$scope.othersCheckB=data[0].cooling_period_check,$scope.othersCommentsB=data[0].cooling_period_comments,$scope.othersCheckC=data[0].working_together_check,$scope.othersCommentsC=data[0].working_together_comments,$scope.othersCheckD=data[0].tax_return_check,$scope.othersCommentsD=data[0].tax_return_comments,$scope.othersCheckE=data[0].travell_global_check,$scope.othersCommentsE=data[0].travell_global_comments,$scope.othersCheckF=data[0].inclusions_check,$scope.othersCommentsF=data[0].inclusions_comments,"no"==$scope.introCheckB&&($scope.introyellowflag=!0),"no"==$scope.qualificationCheckC&&($scope.qualificationyellowflagC=!0),"no"==$scope.qualificationCheckD&&($scope.qualificationyellowflagD=!0),"yes"==$scope.selectionCheckC&&($scope.selectionredflagC=!0),"yes"==$scope.selectionCheckD&&($scope.selectionredflagD=!0),"yes"==$scope.selectionCheckE&&($scope.selectionredflagE=!0),"yes"==$scope.selectionCheckF&&($scope.selectionredflagF=!0),"yes"==$scope.selectionCheckG&&($scope.selectionredflagG=!0),"no"==$scope.costCheckC&&($scope.costredflagC=!0),"no"==$scope.costCheckD&&($scope.costredflagD=!0),"yes"==$scope.costCheckE&&($scope.costredflagE=!0),"yes"==$scope.costCheckG&&($scope.costredflagG=!0),"yes"==$scope.urgencyCheckA&&($scope.urgencyyellowflagA=!0),"yes"==$scope.urgencyCheckB&&($scope.urgencyyellowflagB=!0),"yes"==$scope.urgencyCheckC&&($scope.urgencyyellowflagC=!0),"yes"==$scope.urgencyCheckE&&($scope.urgencyredflagE=!0)})}function getComplianceNames(){$http.get("/getinfo?cid="+$scope.cid).success(function(data){$scope.firstname=data[0].first_name,$scope.lastname=data[0].last_name})}"superadmin"==$scope.staffRole||"compliance"==$scope.staffRole?console.log("works fine"):(console.log("no permission dude"),$location.path("/")),$scope.cid=$routeParams.cid,
$scope.qid=$routeParams.qid,getComplianceDetails(),getComplianceNames()}]),app.controller("compliancelistCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location","$rootScope",function($scope,$http,$interval,$filter,NgTableParams,$routeParams,$location,$rootScope){function getWantedInfo(){$http.get("/getWantedInfo").success(function(data){console.log("this one test:"+data),$scope.listTable=new NgTableParams({page:1,count:10},{total:data.length,getData:function(params){return $scope.data=params.sorting()?$filter("orderBy")(data,params.orderBy()):data,$scope.data=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data,$scope.data=$scope.data.slice((params.page()-1)*params.count(),params.page()*params.count()),$scope.data}})})}"superadmin"==$scope.staffRole||"compliance"==$scope.staffRole?console.log("works fine"):(console.log("no permission dude"),$location.path("/")),getWantedInfo(),$scope.viewDetails=function(user){$rootScope.complianceActive=!0;var cid=user.cid;$location.path("/viewProfile/"+cid)}}]),app.controller("customersCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location","$rootScope",function($scope,$http,$interval,$filter,NgTableParams,$routeParams,$location,$rootScope){function findCustomers(){$http.get("/findCustomers").success(function(data){for(console.log("test all data",data),$scope.customers=data,i=0;i<data.length;i++)$scope.customers[i].time=data[i].time.substring(0,10);$scope.customersTable=new NgTableParams({page:1,count:10},{total:$scope.customers.length,getData:function(params){return $scope.data=params.sorting()?$filter("orderBy")($scope.customers,params.orderBy()):$scope.customers,$scope.data=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data,$scope.data=$scope.data.slice((params.page()-1)*params.count(),params.page()*params.count()),$scope.data}})})}function createCID(){var rand=Math.floor(9e4*Math.random())+1e4,date=new Date,dd=date.getDate(),mm=date.getMonth()+1;10>mm&&(mm="0"+mm);var y=date.getFullYear();y+="",y=y.slice(2);var todayrd=y+""+mm+dd,cid=todayrd+""+rand;return cid}$rootScope.complianceActive=!1,findCustomers(),$scope.viewProfile=function(user){var cid=user.cid;console.log(user.cid),$location.path("/viewProfile/"+cid)},$scope.addRawCustomer=function(){$http.get("/getAllCID").success(function(data){console.log("cid list",data),$scope.cidList=data;do{var j=0,cid=createCID();console.log(cid);for(var i=0;i<$scope.cidList.length;i++)$scope.cidList[i]==cid&&(console.log("not this cid",cid),j=1)}while(1==j);console.log("this cid is fine",cid),$http.post("/addRawCustomer?cid="+cid).success(function(data){console.log("success",data),$location.path("/viewProfile/"+cid)})})}}]),app.controller("DashboardController",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location","$timeout","promiseTracker","$rootScope",function($scope,$http,$interval,$filter,NgTableParams,$routeParams,$location,$timeout,promiseTracker,$rootScope){function checkStaff(){$http.get("/checkStaff").success(function(data){console.log(data),"true"==data[0]&&($scope.s=data[1],$rootScope.greeting&&($rootScope.startAlert("success","Success","Welcome to gForce, "+$scope.s+"!","md md-done"),$rootScope.greeting=!1))})}checkStaff()}]),app.controller("incompliancelistCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location","$rootScope",function($scope,$http,$interval,$filter,NgTableParams,$routeParams,$location,$rootScope){function getInComplianceCustomer(){$http.get("/getInComplianceCustomer").success(function(data){console.log("this one test:"+data),$scope.listTable=new NgTableParams({page:1,count:10},{total:data.length,getData:function(params){return $scope.data=params.sorting()?$filter("orderBy")(data,params.orderBy()):data,$scope.data=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data,$scope.data=$scope.data.slice((params.page()-1)*params.count(),params.page()*params.count()),$scope.data}})})}"superadmin"==$scope.staffRole||"compliance"==$scope.staffRole?console.log("works fine"):(console.log("no permission dude"),$location.path("/")),getInComplianceCustomer(),$scope.viewDetails=function(user){$rootScope.complianceActive=!0;var cid=user.cid;$location.path("/viewProfile/"+cid)}}]),app.controller("loginCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location","$timeout","promiseTracker","$rootScope",function($scope,$http,$interval,$filter,NgTableParams,$routeParams,$location,$timeout,promiseTracker,$rootScope){function addFakeSession(){$http.get("/addFakeSession").success(function(data){console.log(data)})}function checkIP(){$http.get("/checkIP").success(function(data){console.log(data),"true"==data?(console.log("Welcome Staff"),delaySomething()):(console.log("Test log in"),delaySomething())})}function delaySomething(){var promise=$timeout(function(){$scope.showform=!0,$scope.hideform=!1,$scope.hideLoading=!1,$scope.se=!0,delaySomething2()},2e3);$scope.loadingTracker.addPromise(promise)}function delaySomething2(){var promise=$timeout(function(){window.location.replace("../../views/main/main.html")},3e3);$scope.loadingTracker.addPromise(promise)}$scope.showform=!1,$scope.hideform=!0,$scope.hideLoading=!0,$scope.se=!1,$scope.loadingTracker=promiseTracker(),addFakeSession(),checkIP(),$scope.doLogin=function(){},$scope.dismiss=function(){$scope.se=!1}}]),app.controller("mainCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location","$alert","localStorageService","$timeout","$animate","todoService","$rootScope","$window","$q","$log","$idle","$keepalive","$modal",function($scope,$http,$interval,$filter,NgTableParams,$routeParams,$location,$alert,localStorageService,$timeout,$animate,todoService,$rootScope,$window,$q,$log,$idle,$keepalive,$modal){function checkLogin(){$http.get("/checkLogin").success(function(data){console.log(data),"true"==data[0]?($scope.staffName=data[1],$scope.staffEmail=data[2],$scope.staffRole=data[3],$rootScope.name=data[5],$rootScope.office=data[4],$rootScope.staffRole=data[3],$rootScope.staffID=data[6],console.log("office is ",data[4]),"admin"==data[3]?$scope.adminShow=!0:"travel"==data[3]?$scope.travelShow=!0:"coordinator"==data[3]?$scope.coordinationShow=!0:"finance"==data[3]?$scope.financeShow=!0:"compliance"==data[3]?$scope.complianceShow=!0:"sales"==data[3]?$scope.salesShow=!0:"arrivals"==data[3]?$scope.arrivalsShow=!0:"cancellation"==data[3]?$scope.cancellationShow=!0:"superadmin"==data[3]&&($scope.adminShow=!0,$scope.travelShow=!0,$scope.coordinationShow=!0,$scope.financeShow=!0,$scope.complianceShow=!0,$scope.salesShow=!0,$scope.arrivalsShow=!0,$scope.cancellationShow=!0,$scope.emptyShow=!0,$scope.settingsShow=!0),$idle.watch(),$rootScope.$on("$keepalive",function(){console.log("Keeping alive...")}),$rootScope.$on("$keepaliveResponse",function(data,status){console.log("Status: "+status),console.log(data)}),$rootScope.$on("$userIdle",function(){console.log("You are idle...",$scope.staffEmail),$scope.idlePassword="",$http.get("/logout").success(function(data){console.log("session killed"),loginModal.show(),$scope.idleLogin=function(idlePassword){console.log(idlePassword),$http.get("/findFakePassword?email="+$scope.staffEmail+"&password="+idlePassword).success(function(data){console.log(data),"true"==data?(console.log("session back"),loginModal.hide(),$idle.watch()):"wrongemail"==data?(console.log("wrong email"),window.location.replace("/")):window.location.replace("/")})},$scope.idleLogout=function(){window.location.replace("/")}})}),$rootScope.$on("$userTimeout",function(){console.log("You timed out"),load_pictures()}),$rootScope.$on("$userBack",function(){console.log("Now you are not idle, but session killed already")})):window.location.replace("/")})}function relocate(cid){$location.path("/viewProfile/"+cid)}$scope.theme_colors=["pink","red","purple","indigo","blue","light-blue","cyan","teal","green","light-green","lime","yellow","amber","orange","deep-orange"];var loginModal=$modal({scope:$scope,template:"loginModal.html",show:!1,backdrop:"static",keyboard:!1});service=new todoService($scope),$scope.todosCount=service.count(),$scope.$on("todos:count",function(event,count){$scope.todosCount=count,element=angular.element("#todosCount"),element.hasClass("animated")||$animate.addClass(element,"animated bounce",function(){$animate.removeClass(element,"animated bounce")})}),$scope.fillinContent=function(){$scope.htmlContent="content content"},$scope.changeColorTheme=function(cls){$rootScope.$broadcast("theme:change","Choose template"),$scope.theme.color=cls},$scope.changeTemplateTheme=function(cls){$rootScope.$broadcast("theme:change","Choose color"),$scope.theme.template=cls},localStorageService.get("theme")||(theme={color:"theme-pink",template:"theme-template-dark"},localStorageService.set("theme",theme)),localStorageService.bind($scope,"theme"),checkLogin(),$scope.logout=function(){function load_pictures(){$http.get("/logout").success(function(data){window.location.replace("/")})}load_pictures()};var introductionAlert=$alert({title:"Welcome to Materialism",content:"Stay a while and listen",placement:"top-right",type:"theme",container:".alert-container-top-right",show:!1,template:"alert-introduction.html",animation:"mat-grow-top-right"});localStorageService.get("alert-introduction")||$timeout(function(){$scope.showIntroduction(),localStorageService.set("alert-introduction",1)},2500),$scope.showIntroduction=function(){introductionAlert.show(),console.log("test alert")};var refererNotThemeforest=$alert({title:"Hi there!",content:'You like what you see and interested in using our theme? You can find it at <a href="http://themeforest.net/item/materialism-angular-bootstrap-admin-template/11322821" target="_blank"><img style="height:20px;" src="../../assets/img/icons/themeforest-icon.png" /> Themeforest</a>.',placement:"top-right",type:"theme",container:".alert-container-top-right",show:!1,animation:"mat-grow-top-right"});(""===document.referrer||0!==document.referrer.indexOf("themeforest.net"))&&$timeout(function(){refererNotThemeforest.show()},1750),$scope.showNavbarSearch=!0,$scope.toggleSearch=function(){console.log("toggle close here, nothing else"),$scope.showNavbarSearch=!$scope.showNavbarSearch,1==$scope.showNavbarSearch},$scope.getInterest1=function(searchText){return $http.get("/findSearchedCustomer?input="+searchText).then(function(results){return console.log(results.data),results.data})},$scope.selectedItemChange=function(item){console.log(item),item&&($scope.showNavbarSearch=!1,relocate(item.cid))}}]),app.controller("newCustomerCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location",function($scope,$http,$interval,$filter,NgTableParams,$routeParams,$location){"superadmin"==$scope.staffRole||"admin"==$scope.staffRole||"finance"==$scope.staffRole||"coordinator"==$scope.staffRole?console.log("works fine"):(console.log("no permission dude"),$location.path("/")),$scope.data1={availableOptions:[{id:"Working Holiday",name:"Working Holiday"},{id:"Volunteer",name:"Volunteer"},{id:"Au Pair",name:"Au Pair"},{id:"Teach",name:"Teach"},{id:"Internship",name:"Internship"}],selectedOption:{id:"Working Holiday",name:"Working Holiday"}}}]),app.controller("addPaymentCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location","ngDialog","$timeout","$rootScope",function($scope,$http,$interval,$filter,NgTableParams,$routeParams,$location,ngDialog,$timeout,$rootScope){function checkOffice(){$http.get("/checkOffice").success(function(data){"canada"==data&&($scope.data3.selectedOption.name="CAD",$scope.data3.selectedOption.id="CAD"),"uk"==data&&($scope.data3.selectedOption.name="GBP",$scope.data3.selectedOption.id="GBP"),"australia"==data&&($scope.data3.selectedOption.name="AUD",$scope.data3.selectedOption.id="AUD")})}function findcustomersName(){$http.get("/findcustomersName").success(function(data){$scope.customerName2="";var fullname=[];for(i=0;i<data.length;i++){var f=data[i].first_name+", "+data[i].last_name;fullname.push(f)}$scope.states=fullname})}function addtodopayments(i,c){$http.post("/addPayment?customerName2="+$scope.customerName2+"&paymentStatus="+$scope.todoList[i].paymentStatus.name+"&paymentAmount="+$scope.todoList[i].paymentAmount+"&paymentDate="+$scope.todoList[i].paymentDate+"&currency="+$scope.data3.selectedOption.name+"&cid="+c+"&staffname="+$rootScope.name).success(function(data){i==$scope.todoList.length-1&&($scope.customerName2=null,$scope.paymentAmount=null,$scope.paymentDate=null,$rootScope.startAlert("success","Success","Well done! You successfully submit multiple payments.","md md-done")),$scope.todoList[i].paymentDate=null,$scope.todoList[i].paymentAmount=null,console.log("one added")})}"superadmin"==$scope.staffRole||"coordinator"==$scope.staffRole?console.log("works fine"):(console.log("no permission dude"),$location.path("/")),console.log("rootscope",$rootScope.name),$scope.remove=function(){console.log("alert starting");var myEl=angular.element(document.querySelector("#divID"));myEl.empty()},$scope.data2={availableOptions:[{id:"Paid",name:"Paid"},{id:"Next",name:"Next"},{id:"Error",name:"Error"},{id:"Refund",name:"Refund"},{id:"Discount",name:"Discount"},{id:"On Hold",name:"On Hold"}],selectedOption:{id:"Paid",name:"Paid"}},$scope.data3={availableOptions:[{id:"GBP",name:"GBP"},{id:"USD",name:"USD"},{id:"AUD",name:"AUD"},{id:"CAD",name:"CAD"}],selectedOption:{id:"AUD",name:"AUD"}},$scope.data4={availableOptions:[{id:"Week",name:"Week"},{id:"Month",name:"Month"}],selectedOption:{id:"Week",name:"Week"}},checkOffice(),$scope.dis=!1,$scope.repeatCheck="NO",$scope.isDisabled=!0,$scope.myFunction=function(){"YES"==$scope.repeatCheck?$scope.isDisabled=!1:$scope.isDisabled=!0},findcustomersName(),$scope.addpayment=function(){function getCID(){$http.get("/getCID?customerName2="+customerName2).success(function(data){1==data.length?(console.log("this is not a test ok?????",data[0].cid),"NO"==$scope.repeatCheck?$http.post("/addPayment?customerName2="+customerName2+"&paymentStatus="+paymentStatus+"&paymentAmount="+paymentAmount+"&paymentDate="+paymentDate+"&currency="+currency+"&cid="+data[0].cid+"&staffname="+$rootScope.name).success(function(data2){if($scope.todoList.length>0)for(console.log("ok, here is the list"),i=0;i<$scope.todoList.length;i++)addtodopayments(i,data[0].cid),console.log(i);else $scope.customerName2=null,$scope.paymentAmount=null,$scope.paymentDate=null,$rootScope.startAlert("success","Success","Well done! You successfully submit new payment form.","md md-done")}):$scope.repeatTime&&$scope.repeatPeriod?"Week"==$scope.data4.selectedOption.name?$http.post("/addPaymentRepeatweek?customerName2="+customerName2+"&paymentStatus="+paymentStatus+"&paymentAmount="+paymentAmount+"&paymentDate="+paymentDate+"&currency="+currency+"&cid="+data[0].cid+"&staffname="+$rootScope.name+"&period="+$scope.repeatPeriod+"&times="+$scope.repeatTime).success(function(data){$scope.customerName2=null,$scope.paymentAmount=null,$scope.paymentDate=null,$rootScope.startAlert("success","Success","Well done! You successfully submit MULTIPLE new payments.","md md-done")}):"Month"==$scope.data4.selectedOption.name&&$http.post("/addPaymentRepeatmonth?customerName2="+customerName2+"&paymentStatus="+paymentStatus+"&paymentAmount="+paymentAmount+"&paymentDate="+paymentDate+"&currency="+currency+"&cid="+data[0].cid+"&staffname="+$rootScope.name+"&period="+$scope.repeatPeriod+"&times="+$scope.repeatTime).success(function(data){$scope.customerName2=null,$scope.paymentAmount=null,$scope.paymentDate=null,$rootScope.startAlert("success","Success","Well done! You successfully submit MULTIPLE new payments monthly.","md md-done")}):(console.log("another test ok?????"),$scope.customerName2=null,$scope.paymentAmount=null,$scope.paymentDate=null,$rootScope.startAlert("danger","Error","Well, you must enter the repeat times and period","md md-error"))):(console.log("another test ok?????"),$scope.customerName2=null,$scope.paymentAmount=null,$scope.paymentDate=null,$rootScope.startAlert("danger","Error","Well, you must type a wrong customer name","md md-error"))})}console.log("testttttt",$scope.selectedState);var customerName2=$scope.customerName2,paymentStatus=$scope.data2.selectedOption.name,paymentAmount=$scope.paymentAmount,paymentDate=$scope.paymentDate,currency=$scope.data3.selectedOption.name;console.log("1",paymentDate),getCID()},$scope.change=function(){$scope.totalAmountPaid=0,$scope.totalAmountNext=0,$scope.totalAmountDiscount=0,$http.get("/getCID?customerName2="+$scope.customerName2).success(function(data11){1==data11.length?(console.log("show payments for cid",data11[0].cid),$http.get("/getpayment?cid="+data11[0].cid).success(function(data){if(data.length>0){for($scope.n=$scope.customerName2,$scope.list=data,i=0;i<data.length;i++)"Paid"==data[i].paymentStatus?$scope.totalAmountPaid=$scope.totalAmountPaid+data[i].paymentAmount:"Next"==data[i].paymentStatus?$scope.totalAmountNext=$scope.totalAmountNext+data[i].paymentAmount:"Discount"==data[i].paymentStatus?$scope.totalAmountDiscount=$scope.totalAmountDiscount+data[i].paymentAmount:console.log("no need to count this status payment"),$scope.list[i].paymentAmount=Number(data[i].paymentAmount).toLocaleString("en");$scope.currency=data[0].Currency}else $scope.list={},$scope.totalAmountPaid=0,$scope.totalAmountNext=0,$scope.totalAmountDiscount=0})):console.log("not this customer")})},$scope.todoList=[],$scope.todoAdd=function(){$scope.dis=!0,$scope.todoList.push({done:!1})},$scope.remove=function(index){$scope.todoList.splice(index,1),0==$scope.todoList.length&&($scope.dis=!1)}}]),app.controller("payrollCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location","$rootScope","$aside",function($scope,$http,$interval,$filter,NgTableParams,$routeParams,$location,$rootScope,$aside){function findPayroll(){$http.get("/findPayroll").success(function(data){console.log("test all payroll",data),$scope.payrollList=data,$scope.payrollListTable=new NgTableParams({page:1,count:10},{total:$scope.payrollList.length,getData:function(params){return $scope.data=params.sorting()?$filter("orderBy")($scope.payrollList,params.orderBy()):$scope.payrollList,$scope.data=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data,$scope.data=$scope.data.slice((params.page()-1)*params.count(),params.page()*params.count()),$scope.data}}),$scope.hidePending=!0,$scope.hideArchive=!1})}findPayroll(),$scope.findArchivedPayrun=function(){$http.get("/findArchivedPayrun").success(function(data2){$scope.payrollList=data2,$scope.payrollListTable=new NgTableParams({page:1,count:10},{total:$scope.payrollList.length,getData:function(params){return $scope.data=params.sorting()?$filter("orderBy")($scope.payrollList,params.orderBy()):$scope.payrollList,$scope.data=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data,$scope.data=$scope.data.slice((params.page()-1)*params.count(),params.page()*params.count()),$scope.data}}),$scope.hidePending=!1,$scope.hideArchive=!0})},$scope.findPendingPayrun=function(){findPayroll()};var editPayrollTPL=$aside({scope:$scope,template:"../sales/editPayrollTPL.html",show:!1,placement:"right",backdrop:!1,animation:"am-slide-right"});$scope.hideEditPayrollTPL=function(){$scope.resetThisPayroll(),editPayrollTPL.hide()},$scope.checkPayroll=function(user){if($scope.totalPresentation=0,editPayrollTPL.show(),$scope.editingPayroll=user,$scope.totalClamingAmount=0,""!=$scope.editingPayroll.presentation_ids){var presentationIds=$scope.editingPayroll.presentation_ids.slice(0,-1);console.log("presentationIds",presentationIds),$http.get("/getApprovedPresentation?pids="+presentationIds).success(function(data){console.log("all approved presentations detail",data),$scope.approvedPresentationList=data;for(var i=0;i<$scope.approvedPresentationList.length;i++)$scope.totalPresentation=$scope.totalPresentation+parseInt($scope.approvedPresentationList[i].amount)})}if(""!=$scope.editingPayroll.commission_ids){var commissionIds=$scope.editingPayroll.commission_ids.slice(0,-1);console.log("commissionids",commissionIds),$http.get("/getChangedCommissions?ids="+commissionIds).success(function(data){console.log("all changed commissions detail",data),$scope.changedCommissionList=data;for(var i=0;i<$scope.changedCommissionList.length;i++)"approved"==$scope.changedCommissionList[i].sales_status&&($scope.totalClamingAmount=$scope.totalClamingAmount+parseInt($scope.changedCommissionList[i].commission))})}$scope.bonuscurrency={availableOptions:[{id:"GBP",name:"GBP"},{id:"USD",name:"USD"},{id:"AUD",name:"AUD"},{id:"CAD",name:"CAD"}],selectedOption:{id:$scope.editingPayroll.bonus_currency,name:$scope.editingPayroll.bonus_currency}},$scope.deductioncurrency={availableOptions:[{id:"GBP",name:"GBP"},{id:"USD",name:"USD"},{id:"AUD",name:"AUD"},{id:"CAD",name:"CAD"}],selectedOption:{id:$scope.editingPayroll.deduction_currency,name:$scope.editingPayroll.deduction_currency}},$scope.approveThisPayroll=function(){console.log($scope.editingPayroll.payroll_id),$http.post("/approveThisPayroll?id="+$scope.editingPayroll.payroll_id).success(function(data){findPayroll(),editPayrollTPL.hide(),$rootScope.startAlert("success","Success","Fine! You have successfully approved this payroll.","md md-done")})},$scope.updateThisPayroll=function(){$scope.totalResult=0,console.log("test presentation list",$scope.approvedPresentationList),$scope.totalResult=$scope.totalResult+$scope.totalClamingAmount,$scope.totalResult=$scope.totalResult+parseInt($scope.editingPayroll.bonus_amount)-parseInt($scope.editingPayroll.deduction_amount)+$scope.totalPresentation-parseInt($scope.editingPayroll.table_fee),$http.post("/updateThisPayroll?id="+$scope.editingPayroll.payroll_id+"&tableFee="+$scope.editingPayroll.table_fee+"&bonusAmount="+$scope.editingPayroll.bonus_amount+"&bonusCurrency="+$scope.bonuscurrency.selectedOption.id+"&bonusDescription="+$scope.editingPayroll.bonus_description+"&deductionAmount="+$scope.editingPayroll.deduction_amount+"&deductionCurrency="+$scope.deductioncurrency.selectedOption.id+"&deductionDescription="+$scope.editingPayroll.deduction_description+"&total="+$scope.totalResult).success(function(data){findPayroll(),editPayrollTPL.hide(),$rootScope.startAlert("success","Success","Fine! You have successfully updated this payroll.","md md-done")})},$scope.resetThisPayroll=function(){$http.get("/refreshPayrollData?id="+user.payroll_id).success(function(data){$scope.editingPayroll=data[0],console.log($scope.editingPayroll),console.log("user",user),user=$scope.editingPayroll})}}}]),app.controller("profileCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location","$window","$timeout","$rootScope","$compile","$aside","$animate","$q","$modal","Upload",function($scope,$http,$interval,$filter,NgTableParams,$routeParams,$location,$window,$timeout,$rootScope,$compile,$aside,$animate,$q,$modal,Upload){function findprofile(){$http.get("/findProfile?cid="+$routeParams.cid).success(function(data){console.log(data[0]),$scope.profile=data[0];var email=data[0].email;if(""==$scope.profile.tc_details)$scope.showTC=!1;else{$scope.showTC=!0;var tcDetails=angular.element(document.querySelector("#tcDetails"));tcDetails.append($scope.profile.tc_details)}if(getFlightsList(),getInsuranceList(),getAccommodationList(),getTransferList(),getAddonList(),getCharityList(),getVoucherList(),getOtherChargesList(),$scope.ApproveMedication=!1,$scope.ApproveAge=!1,$scope.ApproveSubject=!1,$scope.ApproveDrink_driving_convictions=!1,$scope.ApproveCriminal_convictions=!1,$scope.ApproveDriving_offences=!1,$scope.ApproveHealth_conditions=!1,$scope.ApproveIllicit=!1,$scope.ApproveDietary=!1,$scope.ApprovePromotion=!1,$scope.ApproveTransactionNO=!1,$scope.ApproveConsultant_guarantee=!1,$scope.ApproveComments=!1,findApprove("approve").then(function(d){console.log("test all approve number for this customer",d.length);for(var i=0;i<d.length;i++)"medication"==d[i].field_name&&($scope.ApproveMedication=!0),"age"==d[i].field_name&&($scope.ApproveAge=!0),"subject"==d[i].field_name&&($scope.ApproveSubject=!0),"drink_driving_convictions"==d[i].field_name&&($scope.ApproveDrink_driving_convictions=!0),"criminal_convictions"==d[i].field_name&&($scope.ApproveCriminal_convictions=!0),"driving_offences"==d[i].field_name&&($scope.ApproveDriving_offences=!0),"health_conditions"==d[i].field_name&&($scope.ApproveHealth_conditions=!0),"illicit"==d[i].field_name&&($scope.ApproveIllicit=!0),"dietary"==d[i].field_name&&($scope.ApproveDietary=!0),"promotion"==d[i].field_name&&($scope.ApprovePromotion=!0),"transactionNO"==d[i].field_name&&($scope.ApproveTransactionNO=!0),"consultant_guarantee"==d[i].field_name&&($scope.ApproveConsultant_guarantee=!0),"comments"==d[i].field_name&&($scope.ApproveComments=!0);$scope.personalNotification=0,$scope.hidePersonalNotification=!0;var ageIcon=angular.element(document.querySelector("#ageIcon"));if(parseInt($scope.profile.age)<18||parseInt($scope.profile.age)>30)if($scope.ApproveAge)$scope.checkagered=!1,ageIcon.empty(),ageIcon.append('<i class="md md-done green icon-color"></i>');else{$scope.checkagered=!0,$scope.personalNotification=$scope.personalNotification+1,$scope.hidePersonalNotification=!1,ageIcon.empty();var ageIconString='<span ng-mouseover="changeIcon(1)"><i class="fa fa-exclamation red icon-color"></i></span>',ageIconStringCompiled=$compile(ageIconString)($scope);ageIcon.append(ageIconStringCompiled)}else ageIcon.empty(),ageIcon.append('<i class="md md-chevron-right lime darken-2 icon-color"></i>');$scope.tripNotification=0,$scope.hideTripNotification=!0;var subjectIcon=angular.element(document.querySelector("#subjectIcon"));if(""==$scope.profile.subject)if($scope.ApproveSubject)$scope.checksubjectred=!1,subjectIcon.empty(),subjectIcon.append('<i class="md md-done green icon-color"></i>');else{$scope.checksubjectred=!0,$scope.tripNotification=$scope.tripNotification+1,$scope.hideTripNotification=!1,subjectIcon.empty();var subjectIconString='<span ng-mouseover="changeIcon(2)"><i class="fa fa-exclamation red icon-color"></i></span>',subjectIconStringCompiled=$compile(subjectIconString)($scope);subjectIcon.append(subjectIconStringCompiled)}else subjectIcon.empty(),subjectIcon.append('<i class="md md-chevron-right lime darken-2 icon-color"></i>');$scope.otherNotification=0,$scope.hideOtherNotification=!0;var drinkDrivingIcon=angular.element(document.querySelector("#drinkDrivingIcon"));if("Yes"==$scope.profile.drink_driving_convictions)if($scope.ApproveDrink_driving_convictions)$scope.checkDrinkDriveRed=!1,drinkDrivingIcon.empty(),drinkDrivingIcon.append('<i class="md md-done green icon-color"></i>');else{$scope.checkDrinkDriveRed=!0,$scope.otherNotification=$scope.otherNotification+1,$scope.hideOtherNotification=!1,drinkDrivingIcon.empty();var drinkDrivingIconString='<span ng-mouseover="changeIcon(3)"><i class="fa fa-exclamation red icon-color"></i></span>',drinkDrivingIconStringCompiled=$compile(drinkDrivingIconString)($scope);drinkDrivingIcon.append(drinkDrivingIconStringCompiled)}else drinkDrivingIcon.empty(),drinkDrivingIcon.append('<i class="md md-chevron-right lime darken-2 icon-color"></i>');var criminalIcon=angular.element(document.querySelector("#criminalIcon"));if("Yes"==$scope.profile.criminal_convictions)if($scope.ApproveCriminal_convictions)$scope.checkCriminalRed=!1,criminalIcon.empty(),criminalIcon.append('<i class="md md-done green icon-color"></i>');else{$scope.checkCriminalRed=!0,$scope.otherNotification=$scope.otherNotification+1,$scope.hideOtherNotification=!1,criminalIcon.empty();var criminalIconString='<span ng-mouseover="changeIcon(4)"><i class="fa fa-exclamation red icon-color"></i></span>',criminalIconStringCompiled=$compile(criminalIconString)($scope);criminalIcon.append(criminalIconStringCompiled)}else criminalIcon.empty(),criminalIcon.append('<i class="md md-chevron-right lime darken-2 icon-color"></i>');var drivingOffencesIcon=angular.element(document.querySelector("#drivingOffencesIcon"));if("Yes"==$scope.profile.driving_offences)if($scope.ApproveDriving_offences)$scope.checkDrivingOffencesRed=!1,drivingOffencesIcon.empty(),drivingOffencesIcon.append('<i class="md md-done green icon-color"></i>');else{$scope.checkDrivingOffencesRed=!0,$scope.otherNotification=$scope.otherNotification+1,$scope.hideOtherNotification=!1,drivingOffencesIcon.empty();var drivingOffencesIconString='<span ng-mouseover="changeIcon(5)"><i class="fa fa-exclamation red icon-color"></i></span>',drivingOffencesIconStringCompiled=$compile(drivingOffencesIconString)($scope);drivingOffencesIcon.append(drivingOffencesIconStringCompiled)}else drivingOffencesIcon.empty(),drivingOffencesIcon.append('<i class="md md-chevron-right lime darken-2 icon-color"></i>');var medicationIcon=angular.element(document.querySelector("#medicationIcon"));if("Yes"==$scope.profile.medication)if($scope.ApproveMedication)console.log("this customer is approved for medication issuie"),$scope.checkMedicationRed=!1,medicationIcon.empty(),medicationIcon.append('<i class="md md-done green icon-color"></i>');else{$scope.checkMedicationRed=!0,$scope.otherNotification=$scope.otherNotification+1,$scope.hideOtherNotification=!1,medicationIcon.empty();var medicationIconString='<span ng-mouseover="changeIcon(6)"><i class="fa fa-exclamation red icon-color"></i></span>',medicationIconStringCompiled=$compile(medicationIconString)($scope);medicationIcon.append(medicationIconStringCompiled)}else medicationIcon.empty(),medicationIcon.append('<i class="md md-chevron-right lime darken-2 icon-color"></i>');var healthIcon=angular.element(document.querySelector("#healthIcon"));if("Yes"==$scope.profile.health_conditions)if($scope.ApproveHealth_conditions)$scope.checkMentalRed=!1,healthIcon.empty(),healthIcon.append('<i class="md md-done green icon-color"></i>');else{$scope.checkMentalRed=!0,$scope.otherNotification=$scope.otherNotification+1,$scope.hideOtherNotification=!1,healthIcon.empty();var healthIconString='<span ng-mouseover="changeIcon(7)"><i class="fa fa-exclamation red icon-color"></i></span>',healthIconStringCompiled=$compile(healthIconString)($scope);healthIcon.append(healthIconStringCompiled)}else healthIcon.empty(),healthIcon.append('<i class="md md-chevron-right lime darken-2 icon-color"></i>');var illicitIcon=angular.element(document.querySelector("#illicitIcon"));if("Never"!=$scope.profile.illicit)if($scope.ApproveIllicit)$scope.checkIllicitRed=!1,illicitIcon.empty(),illicitIcon.append('<i class="md md-done green icon-color"></i>');else{$scope.checkIllicitRed=!0,$scope.otherNotification=$scope.otherNotification+1,$scope.hideOtherNotification=!1,illicitIcon.empty();var illicitIconString='<span ng-mouseover="changeIcon(8)"><i class="fa fa-exclamation red icon-color"></i></span>',illicitIconStringCompiled=$compile(illicitIconString)($scope);illicitIcon.append(illicitIconStringCompiled)}else illicitIcon.empty(),illicitIcon.append('<i class="md md-chevron-right lime darken-2 icon-color"></i>');var dietaryIcon=angular.element(document.querySelector("#dietaryIcon"));if("Yes"==$scope.profile.dietary)if($scope.ApproveDietary)$scope.checkDietaryRed=!1,dietaryIcon.empty(),dietaryIcon.append('<i class="md md-done green icon-color"></i>');else{$scope.checkDietaryRed=!0,$scope.otherNotification=$scope.otherNotification+1,$scope.hideOtherNotification=!1,dietaryIcon.empty();var dietaryIconString='<span ng-mouseover="changeIcon(9)"><i class="fa fa-exclamation red icon-color"></i></span>',dietaryIconStringCompiled=$compile(dietaryIconString)($scope);dietaryIcon.append(dietaryIconStringCompiled)}else dietaryIcon.empty(),dietaryIcon.append('<i class="md md-chevron-right lime darken-2 icon-color"></i>');$scope.paymentNotification=0,$scope.hidePaymentNotification=!0;var promotionIcon=angular.element(document.querySelector("#promotionIcon"));
if(""==$scope.profile.promotion)if($scope.ApprovePromotion)$scope.checkpromotionred=!1,promotionIcon.empty(),promotionIcon.append('<i class="md md-done green icon-color"></i>');else{$scope.checkpromotionred=!0,$scope.paymentNotification=$scope.paymentNotification+1,$scope.hidePaymentNotification=!1,promotionIcon.empty();var promotionIconString='<span ng-mouseover="changeIcon(10)"><i class="fa fa-exclamation red icon-color"></i></span>',promotionIconStringCompiled=$compile(promotionIconString)($scope);promotionIcon.append(promotionIconStringCompiled)}else promotionIcon.empty(),promotionIcon.append('<i class="md md-chevron-right lime darken-2 icon-color"></i>');var transactionIcon=angular.element(document.querySelector("#transactionIcon"));if(""==$scope.profile.transactionNO)if($scope.ApproveTransactionNO)$scope.checktransactionNOred=!1,transactionIcon.empty(),transactionIcon.append('<i class="md md-done green icon-color"></i>');else{$scope.checktransactionNOred=!0,$scope.paymentNotification=$scope.paymentNotification+1,$scope.hidePaymentNotification=!1,transactionIcon.empty();var transactionIconString='<span ng-mouseover="changeIcon(11)"><i class="fa fa-exclamation red icon-color"></i></span>',transactionIconStringCompiled=$compile(transactionIconString)($scope);transactionIcon.append(transactionIconStringCompiled)}else transactionIcon.empty(),transactionIcon.append('<i class="md md-chevron-right lime darken-2 icon-color"></i>');$scope.surveyNotification=0,$scope.hideSurveyNotification=!0;var consultantGuaranteeIcon=angular.element(document.querySelector("#consultantGuaranteeIcon"));if("Yes"==$scope.profile.consultant_guarantee)if($scope.ApproveConsultant_guarantee)$scope.checkConsultantGuaranteeRed=!1,consultantGuaranteeIcon.empty(),consultantGuaranteeIcon.append('<i class="md md-done green icon-color"></i>');else{$scope.checkConsultantGuaranteeRed=!0,$scope.surveyNotification=$scope.surveyNotification+1,$scope.hideSurveyNotification=!1,consultantGuaranteeIcon.empty();var consultantGuaranteeIconString='<span ng-mouseover="changeIcon(12)"><i class="fa fa-exclamation red icon-color"></i></span>',consultantGuaranteeIconStringCompiled=$compile(consultantGuaranteeIconString)($scope);consultantGuaranteeIcon.append(consultantGuaranteeIconStringCompiled)}else consultantGuaranteeIcon.empty(),consultantGuaranteeIcon.append('<i class="md md-chevron-right lime darken-2 icon-color"></i>');var commentsIcon=angular.element(document.querySelector("#commentsIcon"));if(""!=$scope.profile.comments)if($scope.ApproveComments)$scope.checkCommentsRed=!1,commentsIcon.empty(),commentsIcon.append('<i class="md md-done green icon-color"></i>');else{$scope.checkCommentsRed=!0,$scope.surveyNotification=$scope.surveyNotification+1,$scope.hideSurveyNotification=!1,commentsIcon.empty();var commentsIconString='<span ng-mouseover="changeIcon(13)"><i class="fa fa-exclamation red icon-color"></i></span>',commentsIconStringCompiled=$compile(commentsIconString)($scope);commentsIcon.append(commentsIconStringCompiled)}else commentsIcon.empty(),commentsIcon.append('<i class="md md-chevron-right lime darken-2 icon-color"></i>');$scope.changeIcon=function(no){if(console.log("change icon "),1==no){var ageIcon=angular.element(document.querySelector("#ageIcon"));ageIcon.empty();var ageIconString='<span ng-mouseleave="changeIconBack(1)" ng-click="approveIt(1)"><i class="md md-done red icon-color"></i></span>',ageIconStringCompiled=$compile(ageIconString)($scope);ageIcon.append(ageIconStringCompiled)}else if(2==no){var subjectIcon=angular.element(document.querySelector("#subjectIcon"));subjectIcon.empty();var subjectIconString='<span ng-mouseleave="changeIconBack(2)" ng-click="approveIt(2)"><i class="md md-done red icon-color"></i></span>',subjectIconStringCompiled=$compile(subjectIconString)($scope);subjectIcon.append(subjectIconStringCompiled)}else if(3==no){var drinkDrivingIcon=angular.element(document.querySelector("#drinkDrivingIcon"));drinkDrivingIcon.empty();var drinkDrivingIconString='<span ng-mouseleave="changeIconBack(3)" ng-click="approveIt(3)"><i class="md md-done red icon-color"></i></span>',drinkDrivingIconStringCompiled=$compile(drinkDrivingIconString)($scope);drinkDrivingIcon.append(drinkDrivingIconStringCompiled)}else if(4==no){var criminalIcon=angular.element(document.querySelector("#criminalIcon"));criminalIcon.empty();var criminalIconString='<span ng-mouseleave="changeIconBack(4)" ng-click="approveIt(4)"><i class="md md-done red icon-color"></i></span>',criminalIconStringCompiled=$compile(criminalIconString)($scope);criminalIcon.append(criminalIconStringCompiled)}else if(5==no){var drivingOffencesIcon=angular.element(document.querySelector("#drivingOffencesIcon"));drivingOffencesIcon.empty();var drivingOffencesIconString='<span ng-mouseleave="changeIconBack(5)" ng-click="approveIt(5)"><i class="md md-done red icon-color"></i></span>',drivingOffencesIconStringCompiled=$compile(drivingOffencesIconString)($scope);drivingOffencesIcon.append(drivingOffencesIconStringCompiled)}else if(6==no){var medicationIcon=angular.element(document.querySelector("#medicationIcon"));medicationIcon.empty();var medicationIconString='<span ng-mouseleave="changeIconBack(6)" ng-click="approveIt(6)"><i class="md md-done red icon-color"></i></span>',medicationIconStringCompiled=$compile(medicationIconString)($scope);medicationIcon.append(medicationIconStringCompiled)}else if(7==no){var healthIcon=angular.element(document.querySelector("#healthIcon"));healthIcon.empty();var healthIconString='<span ng-mouseleave="changeIconBack(7)" ng-click="approveIt(7)"><i class="md md-done red icon-color"></i></span>',healthIconStringCompiled=$compile(healthIconString)($scope);healthIcon.append(healthIconStringCompiled)}else if(8==no){var illicitIcon=angular.element(document.querySelector("#illicitIcon"));illicitIcon.empty();var illicitIconString='<span ng-mouseleave="changeIconBack(8)" ng-click="approveIt(8)"><i class="md md-done red icon-color"></i></span>',illicitIconStringCompiled=$compile(illicitIconString)($scope);illicitIcon.append(illicitIconStringCompiled)}else if(9==no){var dietaryIcon=angular.element(document.querySelector("#dietaryIcon"));dietaryIcon.empty();var dietaryIconString='<span ng-mouseleave="changeIconBack(9)" ng-click="approveIt(9)"><i class="md md-done red icon-color"></i></span>',dietaryIconStringCompiled=$compile(dietaryIconString)($scope);dietaryIcon.append(dietaryIconStringCompiled)}else if(10==no){var promotionIcon=angular.element(document.querySelector("#promotionIcon"));promotionIcon.empty();var promotionIconString='<span ng-mouseleave="changeIconBack(10)" ng-click="approveIt(10)"><i class="md md-done red icon-color"></i></span>',promotionIconStringCompiled=$compile(promotionIconString)($scope);promotionIcon.append(promotionIconStringCompiled)}else if(11==no){var transactionIcon=angular.element(document.querySelector("#transactionIcon"));transactionIcon.empty();var transactionIconString='<span ng-mouseleave="changeIconBack(11)" ng-click="approveIt(11)"><i class="md md-done red icon-color"></i></span>',transactionIconStringCompiled=$compile(transactionIconString)($scope);transactionIcon.append(transactionIconStringCompiled)}else if(12==no){var consultantGuaranteeIcon=angular.element(document.querySelector("#consultantGuaranteeIcon"));consultantGuaranteeIcon.empty();var consultantGuaranteeIconString='<span ng-mouseleave="changeIconBack(12)" ng-click="approveIt(12)"><i class="md md-done red icon-color"></i></span>',consultantGuaranteeIconStringCompiled=$compile(consultantGuaranteeIconString)($scope);consultantGuaranteeIcon.append(consultantGuaranteeIconStringCompiled)}else if(13==no){var commentsIcon=angular.element(document.querySelector("#commentsIcon"));commentsIcon.empty();var commentsIconString='<span ng-mouseleave="changeIconBack(13)" ng-click="approveIt(13)"><i class="md md-done red icon-color"></i></span>',commentsIconStringCompiled=$compile(commentsIconString)($scope);commentsIcon.append(commentsIconStringCompiled)}},$scope.changeIconBack=function(no){if(console.log("change icon back"),1==no){var ageIcon=angular.element(document.querySelector("#ageIcon"));ageIcon.empty();var ageIconString='<span ng-mouseover="changeIcon(1)"><i class="fa fa-exclamation red icon-color"></i></span>',ageIconStringCompiled=$compile(ageIconString)($scope);ageIcon.append(ageIconStringCompiled)}else if(2==no){var subjectIcon=angular.element(document.querySelector("#subjectIcon"));subjectIcon.empty();var subjectIconString='<span ng-mouseover="changeIcon(2)"><i class="fa fa-exclamation red icon-color"></i></span>',subjectIconStringCompiled=$compile(subjectIconString)($scope);subjectIcon.append(subjectIconStringCompiled)}else if(3==no){var drinkDrivingIcon=angular.element(document.querySelector("#drinkDrivingIcon"));drinkDrivingIcon.empty();var drinkDrivingIconString='<span ng-mouseover="changeIcon(3)"><i class="fa fa-exclamation red icon-color"></i></span>',drinkDrivingIconStringCompiled=$compile(drinkDrivingIconString)($scope);drinkDrivingIcon.append(drinkDrivingIconStringCompiled)}else if(4==no){var criminalIcon=angular.element(document.querySelector("#criminalIcon"));criminalIcon.empty();var criminalIconString='<span ng-mouseover="changeIcon(4)"><i class="fa fa-exclamation red icon-color"></i></span>',criminalIconStringCompiled=$compile(criminalIconString)($scope);criminalIcon.append(criminalIconStringCompiled)}else if(5==no){var drivingOffencesIcon=angular.element(document.querySelector("#drivingOffencesIcon"));drivingOffencesIcon.empty();var drivingOffencesIconString='<span ng-mouseover="changeIcon(5)"><i class="fa fa-exclamation red icon-color"></i></span>',drivingOffencesIconStringCompiled=$compile(drivingOffencesIconString)($scope);drivingOffencesIcon.append(drivingOffencesIconStringCompiled)}else if(6==no){var medicationIcon=angular.element(document.querySelector("#medicationIcon"));medicationIcon.empty();var medicationIconString='<span ng-mouseover="changeIcon(6)"><i class="fa fa-exclamation red icon-color"></i></span>',medicationIconStringCompiled=$compile(medicationIconString)($scope);medicationIcon.append(medicationIconStringCompiled)}else if(7==no){var healthIcon=angular.element(document.querySelector("#healthIcon"));healthIcon.empty();var healthIconString='<span ng-mouseover="changeIcon(7)"><i class="fa fa-exclamation red icon-color"></i></span>',healthIconStringCompiled=$compile(healthIconString)($scope);healthIcon.append(healthIconStringCompiled)}else if(8==no){var illicitIcon=angular.element(document.querySelector("#illicitIcon"));illicitIcon.empty();var illicitIconString='<span ng-mouseover="changeIcon(8)"><i class="fa fa-exclamation red icon-color"></i></span>',illicitIconStringCompiled=$compile(illicitIconString)($scope);illicitIcon.append(illicitIconStringCompiled)}else if(9==no){var dietaryIcon=angular.element(document.querySelector("#dietaryIcon"));dietaryIcon.empty();var dietaryIconString='<span ng-mouseover="changeIcon(9)"><i class="fa fa-exclamation red icon-color"></i></span>',dietaryIconStringCompiled=$compile(dietaryIconString)($scope);dietaryIcon.append(dietaryIconStringCompiled)}else if(10==no){var promotionIcon=angular.element(document.querySelector("#promotionIcon"));promotionIcon.empty();var promotionIconString='<span ng-mouseover="changeIcon(10)"><i class="fa fa-exclamation red icon-color"></i></span>',promotionIconStringCompiled=$compile(promotionIconString)($scope);promotionIcon.append(promotionIconStringCompiled)}else if(11==no){var transactionIcon=angular.element(document.querySelector("#transactionIcon"));transactionIcon.empty();var transactionIconString='<span ng-mouseover="changeIcon(11)"><i class="fa fa-exclamation red icon-color"></i></span>',transactionIconStringCompiled=$compile(transactionIconString)($scope);transactionIcon.append(transactionIconStringCompiled)}else if(12==no){var consultantGuaranteeIcon=angular.element(document.querySelector("#consultantGuaranteeIcon"));consultantGuaranteeIcon.empty();var consultantGuaranteeIconString='<span ng-mouseover="changeIcon(12)"><i class="fa fa-exclamation red icon-color"></i></span>',consultantGuaranteeIconStringCompiled=$compile(consultantGuaranteeIconString)($scope);consultantGuaranteeIcon.append(consultantGuaranteeIconStringCompiled)}else if(13==no){var commentsIcon=angular.element(document.querySelector("#commentsIcon"));commentsIcon.empty();var commentsIconString='<span ng-mouseover="changeIcon(13)"><i class="fa fa-exclamation red icon-color"></i></span>',commentsIconStringCompiled=$compile(commentsIconString)($scope);commentsIcon.append(commentsIconStringCompiled)}},$scope.approveIt=function(p){$scope.fieldname="",approveRedFlagsTpl.show(),$scope.p=p,console.log("test field",p),1==p?$scope.fieldname="age":2==p?$scope.fieldname="subject":3==p?$scope.fieldname="drink_driving_convictions":4==p?$scope.fieldname="criminal_convictions":5==p?$scope.fieldname="driving_offences":6==p?$scope.fieldname="medication":7==p?$scope.fieldname="health_conditions":8==p?$scope.fieldname="illicit":9==p?$scope.fieldname="dietary":10==p?$scope.fieldname="promotion":11==p?$scope.fieldname="transactionNO":12==p?$scope.fieldname="consultant_guarantee":13==p&&($scope.fieldname="comments")},$scope.submitApprove=function(){console.log("test field name",$scope.fieldname),addNewLog($scope.fieldname,"NA","approve").then(function(data){console.log(data),approveRedFlagsTpl.hide(),1==$scope.p?$scope.fieldname="age":2==$scope.p?$scope.fieldname="subject":3==$scope.p?$scope.fieldname="drink_driving_convictions":4==$scope.p?$scope.fieldname="criminal_convictions":5==$scope.p?$scope.fieldname="driving_offences":6==$scope.p?$scope.fieldname="medication":7==$scope.p?$scope.fieldname="health_conditions":8==$scope.p?$scope.fieldname="illicit":9==$scope.p?$scope.fieldname="dietary":10==$scope.p?$scope.fieldname="promotion":11==$scope.p?$scope.fieldname="transactionNO":12==$scope.p?$scope.fieldname="consultant_guarantee":13==$scope.p&&($scope.fieldname="comments")})},$scope.cancelApprove=function(){approveRedFlagsTpl.hide()}}),$http.get("/getHubspotData?email="+email).success(function(data2){function getOwnerName(ownerID){$http.get("/getOwnerName?ownerID="+ownerID).success(function(data3){console.log(data3),data3?$scope.ownerName=data3:$scope.ownerName="NA"})}if(data2.hs_analytics_source?$scope.os=data2.hs_analytics_source.value:$scope.os="NA",data2.createdate?$scope.cd=data2.createdate.value:$scope.cd="NA",data2.hs_analytics_source_data_1?$scope.osd=data2.hs_analytics_source_data_1.value:$scope.osd="NA",data2.closedate?$scope.closedate=data2.closedate.value:$scope.closedate="NA",data2.hubspot_owner_id){var ownerID=data2.hubspot_owner_id.value;getOwnerName(ownerID)}else $scope.ownerName="NA"}),$scope.saveProfileChange=function(){console.log("saving profile changes starting.."),$scope.savecontact(),$scope.savepersonal(),$scope.savetrip(),$scope.saveaddons(),$scope.savetravel(),$scope.saveother(),$scope.savepayment(),$scope.savesurvey(),console.log($scope.changingFieldArray);for(var i=0;i<$scope.changingFieldArray.length;i++){var one={};one.field=$scope.changingFieldArray[i],one.value=$scope.profile[one.field],one.cid=$routeParams.cid,$scope.changingFinalData.push(one)}console.log($scope.changingFinalData);var changingFinalDataJSON=JSON.stringify($scope.changingFinalData);$http.post("/updateChangedData?changingFinalDataJSON="+changingFinalDataJSON).success(function(datar){console.log(datar),$http.post("/addEditLog?changingFinalDataJSON="+changingFinalDataJSON+"&cid="+$routeParams.cid+"&staff="+$rootScope.name+"&staffid="+$rootScope.staffID).success(function(datar2){console.log(datar2),editingProfileButtonsTPL.hide(),$scope.changingFieldArray=[],$scope.changingFinalData=[]})})},$scope.cancelProfileChange=function(){editingProfileButtonsTPL.hide(),console.log("cancel profile changes"),$scope.view.editableValue=$scope.profile.email,$scope.view.editableValue2=$scope.profile.prefferd_contact_no,$scope.view.editableValue3=$scope.profile.skype,$scope.view.editableValue4=$scope.profile.address,$scope.view.editableValue5=$scope.profile.suburb,$scope.view.editableValue6=$scope.profile.state,$scope.view.editableValue7=$scope.profile.country,$scope.view.editableValue8=$scope.profile.post_code,$scope.view.editableValue9=$scope.profile.first_name,$scope.view.editableValue10=$scope.profile.last_name,$scope.viewPersonal.editableValue=$scope.profile.nationality,$scope.viewPersonal.editableValue2=$scope.profile.valid_passport,$scope.viewPersonal.editableValue3=$scope.profile.gender,$scope.viewPersonal.editableValue4=$scope.profile.secondary_contact_no,$scope.viewPersonal.editableValue5=$scope.profile.age,$scope.viewPersonal.editableValue6=$scope.profile.dob,$scope.viewPersonal.editableValue7=$scope.profile.weight,$scope.viewPersonal.editableValue8=$scope.profile.height,$scope.viewTrip.editableValue=$scope.profile.trip_experience_name,$scope.viewTrip.editableValue2=$scope.profile.trip_destination,$scope.viewTrip.editableValue3=$scope.profile.trip_code,$scope.viewTrip.editableValue4=$scope.profile.trip_duration,$scope.viewTrip.editableValue5=$scope.profile.trip_price,$scope.viewTrip.editableValue6=$scope.profile.subject,$scope.viewAddons.editableValue=$scope.profile.addon,$scope.viewTravel.editableValue=$scope.profile.date_departure,$scope.viewTravel.editableValue2=$scope.profile.travel_before_exp,$scope.viewTravel.editableValue3=$scope.profile.travel_before_exp_how_long,$scope.viewTravel.editableValue4=$scope.profile.traveL_with_someone,$scope.viewTravel.editableValue5=$scope.profile.traveL_with_someone_who,$scope.viewTravel.editableValue6=$scope.profile.stay_longer,$scope.viewOther.editableValue=$scope.profile.emrg_contact_name,$scope.viewOther.editableValue2=$scope.profile.emrg_contact_relation,$scope.viewOther.editableValue3=$scope.profile.emrg_contact_email,$scope.viewOther.editableValue4=$scope.profile.emrg_contact_number,$scope.viewOther.editableValue5=$scope.profile.drink_driving_convictions,$scope.viewOther.editableValue6=$scope.profile.drink_driving_convictions_date,$scope.viewOther.editableValue7=$scope.profile.drink_driving_convictions_bac,$scope.viewOther.editableValue8=$scope.profile.drink_driving_convictions_describe,$scope.viewOther.editableValue9=$scope.profile.criminal_convictions,$scope.viewOther.editableValue10=$scope.profile.criminal_convictions_date,$scope.viewOther.editableValue11=$scope.profile.criminal_convictions_describe,$scope.viewOther.editableValue12=$scope.profile.driving_offences,$scope.viewOther.editableValue13=$scope.profile.driving_offences_date,$scope.viewOther.editableValue14=$scope.profile.driving_offences_describe,$scope.viewOther.editableValue15=$scope.profile.tattoos,$scope.viewOther.editableValue16=$scope.profile.tattoos_describe,$scope.viewOther.editableValue17=$scope.profile.medication,$scope.viewOther.editableValue18=$scope.profile.medication_describe,$scope.viewOther.editableValue19=$scope.profile.health_conditions,$scope.viewOther.editableValue20=$scope.profile.health_conditions_describe,$scope.viewOther.editableValue21=$scope.profile.smoke,$scope.viewOther.editableValue22=$scope.profile.alcohol,$scope.viewOther.editableValue23=$scope.profile.illicit,$scope.viewOther.editableValue24=$scope.profile.dietary,$scope.viewOther.editableValue25=$scope.profile.dietary_describe,$scope.viewPayment.editableValue=$scope.profile.promotion,$scope.viewPayment.editableValue2=$scope.profile.transactionNO,$scope.viewPayment.editableValue3=$scope.profile.promotion_detail1,$scope.viewPayment.editableValue4=$scope.profile.promotion_detail2,$scope.viewPayment.editableValue5=$scope.profile.promotion_detail3,$scope.viewPayment.editableValue6=$scope.profile.payment_status,$scope.viewPayment.editableValue7=$scope.profile.paid_amount,$scope.viewPayment.editableValue8=$scope.profile.paid_date,$scope.viewPayment.editableValue9=$scope.profile.paid_tc,$scope.viewPayment.editableValue10=$scope.profile.wish_payment_type,$scope.viewPayment.editableValue11=$scope.profile.wish_payment_promotional,$scope.viewPayment.editableValue12=$scope.profile.wish_payment_method,$scope.viewPayment.editableValue13=$scope.profile.wish_payment_amount,$scope.viewSurvey.editableValue=$scope.profile.hear,$scope.viewSurvey.editableValue2=$scope.profile.hear_other,$scope.viewSurvey.editableValue3=$scope.profile.friend_name,$scope.viewSurvey.editableValue4=$scope.profile.friend_email,$scope.viewSurvey.editableValue5=$scope.profile.friend_number,$scope.viewSurvey.editableValue6=$scope.profile.consultant_name,$scope.viewSurvey.editableValue7=$scope.profile.consultant_answer,$scope.viewSurvey.editableValue8=$scope.profile.consultant_answer_describe,$scope.viewSurvey.editableValue9=$scope.profile.consultant_guarantee,$scope.viewSurvey.editableValue10=$scope.profile.consultant_guarantee_describe,$scope.viewSurvey.editableValue11=$scope.profile.rate,$scope.viewSurvey.editableValue12=$scope.profile.comments},$scope.view={editableValue:$scope.profile.email,editableValue2:$scope.profile.prefferd_contact_no,editableValue3:$scope.profile.skype,editableValue4:$scope.profile.address,editableValue5:$scope.profile.suburb,editableValue6:$scope.profile.state,editableValue7:$scope.profile.country,editableValue8:$scope.profile.post_code,editableValue9:$scope.profile.first_name,editableValue10:$scope.profile.last_name,id:"email",id2:"prefferd_contact_no",id3:"skype",id4:"address",id5:"suburb",id6:"state",id7:"country",id8:"post_code",id9:"first_name",id10:"last_name"},$scope.enableEditorButtons=function(field){-1===$scope.changingFieldArray.indexOf(field)&&$scope.changingFieldArray.push(field),editingProfileButtonsTPL.show()},$scope.savecontact=function(){$scope.profile.email=$scope.view.editableValue,$scope.profile.prefferd_contact_no=$scope.view.editableValue2,$scope.profile.skype=$scope.view.editableValue3,$scope.profile.address=$scope.view.editableValue4,$scope.profile.suburb=$scope.view.editableValue5,$scope.profile.state=$scope.view.editableValue6,$scope.profile.country=$scope.view.editableValue7,$scope.profile.post_code=$scope.view.editableValue8,$scope.profile.first_name=$scope.view.editableValue9,$scope.profile.last_name=$scope.view.editableValue10},$scope.viewPersonal={editableValue:$scope.profile.nationality,editableValue2:$scope.profile.valid_passport,editableValue3:$scope.profile.gender,editableValue4:$scope.profile.secondary_contact_no,editableValue5:$scope.profile.age,editableValue6:$scope.profile.dob,editableValue7:$scope.profile.weight,editableValue8:$scope.profile.height,id:"nationality",id2:"valid_passport",id3:"gender",id4:"secondary_contact_no",id5:"age",id6:"dob",id7:"weight",id8:"height"},$scope.savepersonal=function(){$scope.profile.nationality=$scope.viewPersonal.editableValue,$scope.profile.valid_passport=$scope.viewPersonal.editableValue2,$scope.profile.gender=$scope.viewPersonal.editableValue3,$scope.profile.secondary_contact_no=$scope.viewPersonal.editableValue4,$scope.profile.age=$scope.viewPersonal.editableValue5,$scope.profile.dob=$scope.viewPersonal.editableValue6,$scope.profile.weight=$scope.viewPersonal.editableValue7,$scope.profile.height=$scope.viewPersonal.editableValue8},$scope.viewTrip={editableValue:$scope.profile.trip_experience_name,editableValue2:$scope.profile.trip_destination,editableValue3:$scope.profile.trip_code,editableValue4:$scope.profile.trip_duration,editableValue5:$scope.profile.trip_price,editableValue6:$scope.profile.subject,id:"trip_experience_name",id2:"trip_destination",id3:"trip_code",id4:"trip_duration",id5:"trip_price",id6:"subject"},$scope.savetrip=function(){$scope.profile.trip_experience_name=$scope.viewTrip.editableValue,$scope.profile.trip_destination=$scope.viewTrip.editableValue2,$scope.profile.trip_code=$scope.viewTrip.editableValue3,$scope.profile.trip_duration=$scope.viewTrip.editableValue4,$scope.profile.trip_price=$scope.viewTrip.editableValue5,$scope.profile.subject=$scope.viewTrip.editableValue6},$scope.viewAddons={editableValue:$scope.profile.addon,id:"addon"},$scope.saveaddons=function(){$scope.profile.addon=$scope.viewAddons.editableValue},$scope.viewTravel={editableValue:$scope.profile.date_departure,editableValue2:$scope.profile.travel_before_exp,editableValue3:$scope.profile.travel_before_exp_how_long,editableValue4:$scope.profile.traveL_with_someone,editableValue5:$scope.profile.traveL_with_someone_who,editableValue6:$scope.profile.stay_longer,id:"date_departure",id2:"travel_before_exp",id3:"travel_before_exp_how_long",id4:"traveL_with_someone",id5:"traveL_with_someone_who",id6:"stay_longer"},$scope.savetravel=function(){$scope.profile.date_departure=$scope.viewTravel.editableValue,$scope.profile.travel_before_exp=$scope.viewTravel.editableValue2,$scope.profile.travel_before_exp_how_long=$scope.viewTravel.editableValue3,$scope.profile.traveL_with_someone=$scope.viewTravel.editableValue4,$scope.profile.traveL_with_someone_who=$scope.viewTravel.editableValue5,$scope.profile.stay_longer=$scope.viewTravel.editableValue6},$scope.viewOther={editableValue:$scope.profile.emrg_contact_name,editableValue2:$scope.profile.emrg_contact_relation,editableValue3:$scope.profile.emrg_contact_email,editableValue4:$scope.profile.emrg_contact_number,editableValue5:$scope.profile.drink_driving_convictions,editableValue6:$scope.profile.drink_driving_convictions_date,editableValue7:$scope.profile.drink_driving_convictions_bac,editableValue8:$scope.profile.drink_driving_convictions_describe,editableValue9:$scope.profile.criminal_convictions,editableValue10:$scope.profile.criminal_convictions_date,editableValue11:$scope.profile.criminal_convictions_describe,editableValue12:$scope.profile.driving_offences,editableValue13:$scope.profile.driving_offences_date,editableValue14:$scope.profile.driving_offences_describe,editableValue15:$scope.profile.tattoos,editableValue16:$scope.profile.tattoos_describe,editableValue17:$scope.profile.medication,editableValue18:$scope.profile.medication_describe,editableValue19:$scope.profile.health_conditions,editableValue20:$scope.profile.health_conditions_describe,editableValue21:$scope.profile.smoke,editableValue22:$scope.profile.alcohol,editableValue23:$scope.profile.illicit,editableValue24:$scope.profile.dietary,editableValue25:$scope.profile.dietary_describe,id:"emrg_contact_name",id2:"emrg_contact_relation",id3:"emrg_contact_email",id4:"emrg_contact_number",id5:"drink_driving_convictions",id6:"drink_driving_convictions_date",id7:"drink_driving_convictions_bac",id8:"drink_driving_convictions_describe",id9:"criminal_convictions",id10:"criminal_convictions_date",id11:"criminal_convictions_describe",id12:"driving_offences",id13:"driving_offences_date",id14:"driving_offences_describe",id15:"tattoos",id16:"tattoos_describe",id17:"medication",id18:"medication_describe",id19:"health_conditions",id20:"health_conditions_describe",id21:"smoke",id22:"alcohol",id23:"illicit",id24:"dietary",id25:"dietary_describe"},$scope.saveother=function(){$scope.profile.emrg_contact_name=$scope.viewOther.editableValue,$scope.profile.emrg_contact_relation=$scope.viewOther.editableValue2,$scope.profile.emrg_contact_email=$scope.viewOther.editableValue3,$scope.profile.emrg_contact_number=$scope.viewOther.editableValue4,$scope.profile.drink_driving_convictions=$scope.viewOther.editableValue5,$scope.profile.drink_driving_convictions_date=$scope.viewOther.editableValue6,$scope.profile.drink_driving_convictions_bac=$scope.viewOther.editableValue7,$scope.profile.drink_driving_convictions_describe=$scope.viewOther.editableValue8,$scope.profile.criminal_convictions=$scope.viewOther.editableValue9,$scope.profile.criminal_convictions_date=$scope.viewOther.editableValue10,$scope.profile.criminal_convictions_describe=$scope.viewOther.editableValue11,$scope.profile.driving_offences=$scope.viewOther.editableValue12,$scope.profile.driving_offences_date=$scope.viewOther.editableValue13,$scope.profile.driving_offences_describe=$scope.viewOther.editableValue14,$scope.profile.tattoos=$scope.viewOther.editableValue15,$scope.profile.tattoos_describe=$scope.viewOther.editableValue16,$scope.profile.medication=$scope.viewOther.editableValue17,$scope.profile.medication_describe=$scope.viewOther.editableValue18,$scope.profile.health_conditions=$scope.viewOther.editableValue19,$scope.profile.health_conditions_describe=$scope.viewOther.editableValue20,$scope.profile.smoke=$scope.viewOther.editableValue21,$scope.profile.alcohol=$scope.viewOther.editableValue22,$scope.profile.illicit=$scope.viewOther.editableValue23,$scope.profile.dietary=$scope.viewOther.editableValue24,$scope.profile.dietary_describe=$scope.viewOther.editableValue25},$scope.viewPayment={editableValue:$scope.profile.promotion,editableValue2:$scope.profile.transactionNO,editableValue3:$scope.profile.promotion_detail1,editableValue4:$scope.profile.promotion_detail2,editableValue5:$scope.profile.promotion_detail3,editableValue6:$scope.profile.payment_status,editableValue7:$scope.profile.paid_amount,editableValue8:$scope.profile.paid_date,editableValue9:$scope.profile.paid_tc,editableValue10:$scope.profile.wish_payment_type,editableValue11:$scope.profile.wish_payment_promotional,editableValue12:$scope.profile.wish_payment_method,editableValue13:$scope.profile.wish_payment_amount,id:"promotion",id2:"transactionNO",id3:"promotion_detail1",id4:"promotion_detail2",id5:"promotion_detail3",id6:"payment_status",id7:"paid_amount",id8:"paid_date",id9:"paid_tc",id10:"wish_payment_type",id11:"wish_payment_promotional",id12:"wish_payment_method",id13:"wish_payment_amount"},$scope.savepayment=function(){$scope.profile.promotion=$scope.viewPayment.editableValue,"yes"==$scope.viewPayment.editableValue?($scope.profile.promotion_detail1=$scope.viewPayment.editableValue3,$scope.profile.promotion_detail2=$scope.viewPayment.editableValue4,$scope.profile.promotion_detail3=$scope.viewPayment.editableValue5):($scope.profile.promotion_detail1="",$scope.profile.promotion_detail2="",$scope.profile.promotion_detail3=""),$scope.profile.transactionNO=$scope.viewPayment.editableValue2,$scope.profile.payment_status=$scope.viewPayment.editableValue6,$scope.profile.paid_amount=$scope.viewPayment.editableValue7,$scope.profile.paid_date=$scope.viewPayment.editableValue8,$scope.profile.paid_tc=$scope.viewPayment.editableValue9,$scope.profile.wish_payment_type=$scope.viewPayment.editableValue10,$scope.profile.wish_payment_promotional=$scope.viewPayment.editableValue11,$scope.profile.wish_payment_method=$scope.viewPayment.editableValue12,$scope.profile.wish_payment_amount=$scope.viewPayment.editableValue13},$scope.viewSurvey={editableValue:$scope.profile.hear,editableValue2:$scope.profile.hear_other,editableValue3:$scope.profile.friend_name,editableValue4:$scope.profile.friend_email,editableValue5:$scope.profile.friend_number,editableValue6:$scope.profile.consultant_name,editableValue7:$scope.profile.consultant_answer,editableValue8:$scope.profile.consultant_answer_describe,editableValue9:$scope.profile.consultant_guarantee,editableValue10:$scope.profile.consultant_guarantee_describe,editableValue11:$scope.profile.rate,editableValue12:$scope.profile.comments,id:"hear",id2:"hear_other",id3:"friend_name",id4:"friend_email",id5:"friend_number",id6:"consultant_name",id7:"consultant_answer",id8:"consultant_answer_describe",id9:"consultant_guarantee",id10:"consultant_guarantee_describe",id11:"rate",id12:"comments"},$scope.savesurvey=function(){$scope.profile.hear=$scope.viewSurvey.editableValue,$scope.profile.hear_other=$scope.viewSurvey.editableValue2,$scope.profile.friend_name=$scope.viewSurvey.editableValue3,$scope.profile.friend_email=$scope.viewSurvey.editableValue4,$scope.profile.friend_number=$scope.viewSurvey.editableValue5,$scope.profile.consultant_name=$scope.viewSurvey.editableValue6,$scope.profile.consultant_answer=$scope.viewSurvey.editableValue7,$scope.profile.consultant_answer_describe=$scope.viewSurvey.editableValue8,$scope.profile.consultant_guarantee=$scope.viewSurvey.editableValue9,
$scope.profile.consultant_guarantee_describe=$scope.viewSurvey.editableValue10,$scope.profile.rate=$scope.viewSurvey.editableValue11,$scope.profile.comments=$scope.viewSurvey.editableValue12},findResumeProfile($scope.profile.email),$scope.allTasklists=[{name:"Payment Confirmation",tid:"1",trip:"general"},{name:"Payment Reference No",tid:"2",trip:"general"},{name:"Register",tid:"3",trip:"general"},{name:"Promo Confirmation",tid:"4",trip:"general"},{name:"Booking Approval",tid:"5",trip:"general"},{name:"Trip Subject Added",tid:"6",trip:"general"},{name:"Admin Booking Check",tid:"7",trip:"general"},{name:"Added to Zoho",tid:"8",trip:"general"},{name:"Choose a Coordinator",tid:"9",trip:"general"},{name:"Welcome call",tid:"10",trip:"general"},{name:"Welcome email sent",tid:"11",trip:"general"},{name:"Follow up call every 2 weeks",tid:"12",trip:"general"},{name:"Trip Balance Paid",tid:"13",trip:"general"},{name:"Passport",tid:"14",trip:"general"},{name:"Visa Approved",tid:"15",trip:"general"},{name:"Traveller Profile Submitted online",tid:"16",trip:"general"},{name:"Sent to Travel Department",tid:"17",trip:"general"},{name:"Resume",tid:"18",trip:"WH"},{name:"Photo",tid:"19",trip:"WH"},{name:"2 x References",tid:"20",trip:"WH"},{name:"Sent to Destination",tid:"21",trip:"WH"},{name:"Resume",tid:"22",trip:"Au Pair"},{name:"Family Letter",tid:"23",trip:"Au Pair"},{name:"Photo",tid:"24",trip:"Au Pair"},{name:"Personal Profile",tid:"25",trip:"Au Pair"},{name:"Reference",tid:"26",trip:"Au Pair"},{name:"Police Check",tid:"27",trip:"Au Pair"},{name:"Medical Check",tid:"28",trip:"Au Pair"},{name:"First Aid",tid:"29",trip:"Au Pair"},{name:"Sent to Destination",tid:"30",trip:"Au Pair"},{name:"Placement Form",tid:"31",trip:"Vol"},{name:"Resume",tid:"32",trip:"Vol"},{name:"Cover Letter",tid:"33",trip:"Vol"},{name:"2 x Photos",tid:"34",trip:"Vol"},{name:"Police Check",tid:"35",trip:"Vol"},{name:"Booking with Partner",tid:"36",trip:"Vol"},{name:"Send Global Experience Pack",tid:"37",trip:"Vol"},{name:"In country follow up",tid:"38",trip:"Vol"},{name:"Resume",tid:"39",trip:"Teach"},{name:"Cover Letter",tid:"40",trip:"Teach"},{name:"2 x Photos",tid:"41",trip:"Teach"},{name:"University Transcripts (if applicable)",tid:"42",trip:"Teach"},{name:"90 Days prior to departure: Background Check",tid:"43",trip:"Teach"},{name:"Sent information to Partner",tid:"44",trip:"Teach"},{name:"Send Global Experience Pack",tid:"45",trip:"Teach"},{name:"Resume",tid:"46",trip:"internship"},{name:"Cover Letter",tid:"47",trip:"internship"},{name:"2 x Photos",tid:"48",trip:"internship"},{name:"Police Check",tid:"49",trip:"internship"},{name:"Sent information to Partner",tid:"50",trip:"internship"},{name:"Send Global Experience Pack",tid:"51",trip:"internship"}],$scope.salesDepart=[],"Working Holiday"==$scope.profile.trip_experience_name){$scope.salesD=["no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no"];for(var a=0;a<$scope.allTasklists.length;a++)if("general"==$scope.allTasklists[a].trip||"WH"==$scope.allTasklists[a].trip){var onetask={name:$scope.allTasklists[a].name,tid:$scope.allTasklists[a].tid,trip:$scope.allTasklists[a].trip};$scope.salesDepart.push(onetask)}}else if("Au Pair"==$scope.profile.trip_experience_name){$scope.salesD=["no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no"];for(var a=0;a<$scope.allTasklists.length;a++)if("general"==$scope.allTasklists[a].trip||"Au Pair"==$scope.allTasklists[a].trip){var onetask={name:$scope.allTasklists[a].name,tid:$scope.allTasklists[a].tid,trip:$scope.allTasklists[a].trip};$scope.salesDepart.push(onetask)}}else if("Teach"==$scope.profile.trip_experience_name){$scope.salesD=["no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no"];for(var a=0;a<$scope.allTasklists.length;a++)if("general"==$scope.allTasklists[a].trip||"Teach"==$scope.allTasklists[a].trip){var onetask={name:$scope.allTasklists[a].name,tid:$scope.allTasklists[a].tid,trip:$scope.allTasklists[a].trip};$scope.salesDepart.push(onetask)}}else if("Volunteer"==$scope.profile.trip_experience_name){$scope.salesD=["no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no"];for(var a=0;a<$scope.allTasklists.length;a++)if("general"==$scope.allTasklists[a].trip||"Vol"==$scope.allTasklists[a].trip){var onetask={name:$scope.allTasklists[a].name,tid:$scope.allTasklists[a].tid,trip:$scope.allTasklists[a].trip};$scope.salesDepart.push(onetask)}}else if("Internship"==$scope.profile.trip_experience_name){$scope.salesD=["no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no"];for(var a=0;a<$scope.allTasklists.length;a++)if("general"==$scope.allTasklists[a].trip||"internship"==$scope.allTasklists[a].trip){var onetask={name:$scope.allTasklists[a].name,tid:$scope.allTasklists[a].tid,trip:$scope.allTasklists[a].trip};$scope.salesDepart.push(onetask)}}console.log("test saleDepart array",$scope.salesDepart),findAllValues($scope.salesDepart)})}function findtravel(){$http.get("/findtravel?cid="+$routeParams.cid).success(function(data10){$scope.travelDetails=data10[0]})}function checkMarketingCID(){$http.get("/checkMarketingCID?cid="+$routeParams.cid).success(function(data){console.log("the lenght is: ",data.length),1==data.length?($scope.button="Update Database",$scope.uploadHubspot=function(){function updateHubspot(){$http.post("/updateHubspot?cid="+$scope.c+"&os="+$scope.os+"&createdate="+$scope.cd+"&hsOwner="+$scope.ownerName+"&campName="+$scope.osd+"&closeDate="+$scope.closedate).success(function(data5){console.log(data5),console.log("data updated")})}$scope.os&&$scope.cd&&$scope.ownerName&&$scope.osd&&$scope.closedate?(console.log("test",$scope.ownerName),updateHubspot()):console.log("data empty")}):($scope.button="Insert Into Database",$scope.uploadHubspot=function(){function insertHubspot(){$http.post("/insertHubspot?cid="+$scope.c+"&os="+$scope.os+"&createdate="+$scope.cd+"&hsOwner="+$scope.ownerName+"&campName="+$scope.osd+"&closeDate="+$scope.closedate).success(function(data4){console.log(data4),console.log("data inserted")})}$scope.os&&$scope.cd&&$scope.ownerName&&$scope.osd&&$scope.closedate?(console.log("test",$scope.ownerName),insertHubspot()):console.log("data empty")})})}function findAllValues(salesDepart){$http.get("/findAllValues?cid="+$routeParams.cid).success(function(data){if(data.length>0){$scope.tasklist=[],console.log("hey hey",salesDepart[0].name);for(var i=0;i<salesDepart.length;i++){for(var onetask={taskName:salesDepart[i].name,tid:salesDepart[i].tid,value:"no"},lastTaskID=-1,j=0;j<data.length;j++)data[j].tid==salesDepart[i].tid&&data[j].taskID>lastTaskID&&(lastTaskID=data[j].taskID,onetask=data[j]);$scope.tasklist.push(onetask)}}else{console.log("not this cid"),$scope.tasklist=[];for(var i=0;i<salesDepart.length;i++){var onetask={taskName:salesDepart[i].name,tid:salesDepart[i].tid,value:"no"};$scope.tasklist.push(onetask)}}console.log("test how about tasklist now:",$scope.tasklist);for(var t=0;t<$scope.tasklist.length;t++)"yes"==$scope.tasklist[t].value&&($scope.status=$scope.tasklist[t].taskName,$scope.salesD[t]="yes");console.log("final checking array is here:",$scope.salesD),$scope.checkClick=function(tid,index){console.log("repeat check",tid);var confirmHTML=angular.element(document.querySelector("#t"+index)),htmlString='<button class="btn btn-sm green darken-2 global-button confirm-btn" ng-click="confirmCheckChange('+index+')"><i class="md md-check global-button-icon"></i> </button><button class="btn btn-sm red darken-2 global-button cancel-btn" ng-click="cancelCheckChange('+index+')"><i class="md md-close global-button-icon"></i></button>',htmlStringCompiled=$compile(htmlString)($scope);confirmHTML.append(htmlStringCompiled),$scope.confirmCheckChange=function(i){switch($scope.tasklist[i].tid){case"1":console.log("Payment Confirmation confirm click.."),insertIntoDatabase(i);break;case"2":console.log("Payment Reference No confirm click.."),insertIntoDatabase(i);break;case"3":console.log("Register confirm click.."),insertIntoDatabase(i);break;case"4":console.log("Promo Confirmation confirm click.."),insertIntoDatabase(i);break;case"5":console.log("Booking Approval confirm click.."),insertIntoDatabase(i);break;case"6":console.log("Trip Subject Added confirm click.."),insertIntoDatabase(i);break;case"7":console.log("Admin Booking Check confirm click.."),insertIntoDatabase(i);break;case"8":console.log("Added to Zoho confirm click.."),confirmzohocall(i);break;case"9":if(console.log("Choose Coordinator confirm click.."),"yes"==$scope.salesD[0]&&"yes"==$scope.salesD[1]&&"yes"==$scope.salesD[2]&&"yes"==$scope.salesD[3]&&"yes"==$scope.salesD[4]&&"yes"==$scope.salesD[5]&&"yes"==$scope.salesD[6]&&"yes"==$scope.salesD[7])AllocateCoordinatorTpl.show(),$scope.addCoordinator=function(selectedCoordinators){console.log("new owner is",selectedCoordinators),$scope.owner=selectedCoordinators.fullname,$http.post("/updateDepStatusAdmin?cid="+$routeParams.cid+"&owner="+$scope.owner).success(function(data){console.log("dep status updated",data),insertIntoDatabase(i),AllocateCoordinatorTpl.hide()})};else{$rootScope.startAlert("danger","Error","Please fullfill all of other task above","md md-error");var c=angular.element(document.querySelector("#t"+i));c.empty(),$scope.tasklist[i].value="no"}break;case"10":insertIntoDatabase(i);break;case"11":insertIntoDatabase(i);break;case"12":insertIntoDatabase(i);break;case"13":insertIntoDatabase(i);break;case"14":insertIntoDatabase(i);break;case"15":insertIntoDatabase(i);break;case"16":insertIntoDatabase(i);break;case"17":insertIntoDatabase(i);break;case"18":insertIntoDatabase(i);break;case"19":insertIntoDatabase(i);break;case"20":insertIntoDatabase(i);break;case"21":insertIntoDatabase(i);break;case"22":insertIntoDatabase(i);break;case"23":insertIntoDatabase(i);break;case"24":insertIntoDatabase(i);break;case"25":insertIntoDatabase(i);break;case"26":insertIntoDatabase(i);break;case"27":insertIntoDatabase(i);break;case"10":insertIntoDatabase(i);break;case"28":insertIntoDatabase(i);break;case"29":insertIntoDatabase(i);break;case"30":insertIntoDatabase(i);break;case"31":insertIntoDatabase(i);break;case"32":insertIntoDatabase(i);break;case"33":insertIntoDatabase(i);break;case"34":insertIntoDatabase(i);break;case"35":insertIntoDatabase(i);break;case"36":insertIntoDatabase(i);break;case"37":insertIntoDatabase(i);break;case"38":insertIntoDatabase(i);break;case"39":insertIntoDatabase(i);break;case"40":insertIntoDatabase(i);break;case"41":insertIntoDatabase(i);break;case"42":insertIntoDatabase(i);break;case"43":insertIntoDatabase(i);break;case"44":insertIntoDatabase(i);break;case"45":insertIntoDatabase(i)}},$scope.cancelCheckChange=function(i){console.log(i),"yes"==$scope.tasklist[i].value?$scope.tasklist[i].value="no":$scope.tasklist[i].value="yes";var c=angular.element(document.querySelector("#t"+i));c.empty()}}})}function insertIntoDatabase(i){$http.post("/insertOneTask?cid="+$routeParams.cid+"&taskName="+$scope.tasklist[i].taskName+"&tid="+$scope.tasklist[i].tid+"&value="+$scope.tasklist[i].value+"&user="+$scope.staffName).success(function(inserteddata){console.log("inserted one task"),$scope.tasklist[i].time="just now",$scope.tasklist[i].user=$scope.staffName;var c=angular.element(document.querySelector("#t"+i));c.empty(),"yes"==$scope.tasklist[i].value&&($scope.salesD[i]="yes",changeProfileStatus(i),"yes"==$scope.salesD[0]&&"yes"==$scope.salesD[1]&&"yes"==$scope.salesD[2]&&"yes"==$scope.salesD[3]&&"yes"==$scope.salesD[4]&&$scope.tasklist[i].tid<6&&(console.log("admin status adding.."),$http.post("/addDepStatus?cid="+$routeParams.cid).success(function(data){console.log("dep status added",data),$http.get("/sendSalesLogEmail?lastname="+$scope.profile.last_name+"&firstname="+$scope.profile.first_name).success(function(data){console.log("email sending",data)})})))})}function changeProfileStatus(i){if("Nothing"==$scope.status)$scope.status=$scope.tasklist[i].taskName;else for(var r=0;r<$scope.salesDepart.length;r++)if($scope.salesDepart[r].name==$scope.status){$scope.salesDepart[r].tid<$scope.tasklist[i].tid&&($scope.status=$scope.tasklist[i].taskName);break}}function getAllCoordinators(){$http.get("/getAllCoordinators").success(function(data){$scope.allCoordinators=data;for(var a=0;a<data.length;a++)$scope.allCoordinators[a].fullname=$scope.allCoordinators[a].first_name+" "+$scope.allCoordinators[a].last_name})}function getAllNotes(){$http.get("/getAllNotes?cid="+$routeParams.cid).success(function(data){console.log(data),$scope.notesList=data,0==data.length?$scope.noteRedFlag=!1:$scope.noteRedFlag=!0})}function checkOffice(){$http.get("/checkOffice").success(function(data){"canada"==data&&($scope.data3.selectedOption.name="CAD",$scope.data3.selectedOption.id="CAD"),"uk"==data&&($scope.data3.selectedOption.name="GBP",$scope.data3.selectedOption.id="GBP"),"australia"==data&&($scope.data3.selectedOption.name="AUD",$scope.data3.selectedOption.id="AUD")})}function addtodopayments(i,c){$http.post("/addPayment?customerName2=testNameHere&paymentStatus="+$scope.todoList[i].paymentStatus.name+"&paymentAmount="+$scope.todoList[i].paymentAmount+"&paymentDate="+$scope.todoList[i].paymentDate+"&currency="+$scope.data3.selectedOption.name+"&cid="+c+"&staffname="+$rootScope.name).success(function(data){i==$scope.todoList.length-1&&(addPaymentTpl.toggle(),$rootScope.startAlert("success","Success","Well done! You successfully submit multiple payments.","md md-done")),$scope.todoList[i].paymentDate=null,$scope.todoList[i].paymentAmount=null,console.log("one added")})}function confirmzohocall(i){if(""==$scope.profile.consultant_name){$rootScope.startAlert("danger","Error","There is no consultant name for this customer.","md md-error");var z=angular.element(document.querySelector("#t"+i));z.empty(),$scope.tasklist[i].value="no"}else{var oneContact={first_name:$scope.profile.first_name,last_name:$scope.profile.last_name,email:$scope.profile.email,prefferd_contact_no:$scope.profile.prefferd_contact_no,skype:$scope.profile.skype,address:$scope.profile.address,suburb:$scope.profile.suburb,state:$scope.profile.state,country:$scope.profile.country,post_code:$scope.profile.post_code,nationality:$scope.profile.nationality,valid_passport:$scope.profile.valid_passport,gender:$scope.profile.gender,secondary_contact_no:$scope.profile.secondary_contact_no,age:$scope.profile.age,dob:$scope.profile.dob,weight:$scope.profile.weight,height:$scope.profile.height,trip_experience_name:$scope.profile.trip_experience_name,trip_destination:$scope.profile.trip_destination,trip_code:$scope.profile.trip_code,trip_duration:$scope.profile.trip_duration,trip_price:$scope.profile.trip_price,subject:$scope.profile.subject,addon:$scope.profile.addon,date_departure:$scope.profile.date_departure,travel_before_exp:$scope.profile.travel_before_exp,travel_before_exp_how_long:$scope.profile.travel_before_exp_how_long,traveL_with_someone:$scope.profile.traveL_with_someone,traveL_with_someone_who:$scope.profile.traveL_with_someone_who,stay_longer:$scope.profile.stay_longer,emrg_contact_name:$scope.profile.emrg_contact_name,emrg_contact_relation:$scope.profile.emrg_contact_relation,emrg_contact_email:$scope.profile.emrg_contact_email,emrg_contact_number:$scope.profile.emrg_contact_number,drink_driving_convictions:$scope.profile.drink_driving_convictions,drink_driving_convictions_date:$scope.profile.drink_driving_convictions_date,drink_driving_convictions_bac:$scope.profile.drink_driving_convictions_bac,drink_driving_convictions_describe:$scope.profile.drink_driving_convictions_describe,criminal_convictions:$scope.profile.criminal_convictions,criminal_convictions_date:$scope.profile.criminal_convictions_date,criminal_convictions_describe:$scope.profile.criminal_convictions_describe,driving_offences:$scope.profile.driving_offences,driving_offences_date:$scope.profile.driving_offences_date,driving_offences_describe:$scope.profile.driving_offences_describe,tattoos:$scope.profile.tattoos,tattoos_describe:$scope.profile.tattoos_describe,medication:$scope.profile.medication,medication_describe:$scope.profile.medication_describe,health_conditions:$scope.profile.health_conditions,health_conditions_describe:$scope.profile.health_conditions_describe,smoke:$scope.profile.smoke,alcohol:$scope.profile.alcohol,illicit:$scope.profile.illicit,dietary:$scope.profile.dietary,dietary_describe:$scope.profile.dietary_describe,hear:$scope.profile.hear,hear_other:$scope.profile.hear_other,friend_name:$scope.profile.friend_name,friend_email:$scope.profile.friend_email,friend_number:$scope.profile.friend_number,consultant_name:$scope.profile.consultant_name,consultant_answer:$scope.profile.consultant_answer,consultant_answer_describe:$scope.profile.consultant_answer_describe,consultant_guarantee:$scope.profile.consultant_guarantee,consultant_guarantee_describe:$scope.profile.consultant_guarantee_describe,rate:$scope.profile.rate,comments:$scope.profile.comments,cid:$routeParams.cid};console.log(oneContact.first_name);var oneContact2=JSON.stringify(oneContact);$http.post("/callzoho?oneContact="+oneContact2).success(function(datazoho){console.log("zoho called",datazoho),$scope.showzohoconfirm=!1,"success"==datazoho?($rootScope.startAlert("success","Success","Well done! You have successfully added this guy into Zoho.","md md-done"),insertIntoDatabase(i)):$rootScope.startAlert("danger","Error","Zoho added failed","md md-error")})}}function getComplianceList(){$http.get("/getComplianceList?cid="+$routeParams.cid).success(function(data){if($scope.clist=data,0==data.length){var nocompliance=angular.element(document.querySelector("#nocompliance"));nocompliance.append("<h5>There is no compliance submission for this customer yet.</h5>")}})}function getComplianceDetails(){$http.get("/getComplianceDetails?qid="+$scope.qidNow).success(function(data){$scope.date=data[0].date,$scope.redflagNO=data[0].redflag,$scope.yellowflagNO=data[0].yellowflag,$scope.introCheckA=data[0].consultant_name_check,$scope.introCommentsA=data[0].consultant_name_comments,$scope.introCheckB=data[0].company_name_check,$scope.introCommentsB=data[0].company_name_comments,$scope.qualificationCheckA=data[0].age_check,$scope.qualificationCommentsA=data[0].age_comments,$scope.qualificationCheckB=data[0].citizenship_check,$scope.qualificationCommentsB=data[0].citizenship_comments,$scope.qualificationCheckC=data[0].driving_offense_check,$scope.qualificationCommentsC=data[0].driving_offense_comments,$scope.qualificationCheckD=data[0].criminal_convictions_check,$scope.qualificationCommentsD=data[0].criminal_convictions_comments,$scope.qualificationCheckE=data[0].wh_visa_check,$scope.qualificationCommentsE=data[0].wh_visa_comments,$scope.backgroundCheckA=data[0].amount_travellers_check,$scope.backgroundCommentsA=data[0].amount_travellers_comments,$scope.selectionCheckA=data[0].departure_date_check,$scope.selectionCommentsA=data[0].departure_date_comments,$scope.selectionCheckB=data[0].min_time_check,$scope.selectionCommentsB=data[0].min_time_comments,$scope.selectionCheckC=data[0].job_placement_check,$scope.selectionCommentsC=data[0].job_placement_comments,$scope.selectionCheckD=data[0].job_type_check,$scope.selectionCommentsD=data[0].job_type_comments,$scope.selectionCheckE=data[0].location_check,$scope.selectionCommentsE=data[0].location_comments,$scope.selectionCheckF=data[0].wage_check,$scope.selectionCommentsF=data[0].wage_comments,$scope.selectionCheckG=data[0].work_hour_check,$scope.selectionCommentsG=data[0].work_hour_comments,$scope.costCheckA=data[0].money_save_check,$scope.costCommentsA=data[0].money_save_comments,$scope.costCheckB=data[0].cost_estimate_check,$scope.costCommentsB=data[0].cost_estimate_comments,$scope.costCheckC=data[0].program_price_check,$scope.costCommentsC=data[0].program_price_comments,$scope.costCheckD=data[0].exclusions_check,$scope.costCommentsD=data[0].exclusions_comments,$scope.costCheckE=data[0].flight_cost_check,$scope.costCommentsE=data[0].flight_cost_comments,$scope.costCheckF=data[0].visa_cost_check,$scope.costCommentsF=data[0].visa_cost_comments,$scope.costCheckG=data[0].insurance_cost_check,$scope.costCommentsG=data[0].insurance_cost_comments,$scope.urgencyCheckA=data[0].remaining_spots_check,$scope.urgencyCommentsA=data[0].remaining_spots_comments,$scope.urgencyCheckB=data[0].closing_week_check,$scope.urgencyCommentsB=data[0].closing_week_comments,$scope.urgencyCheckC=data[0].promotion_check,$scope.urgencyCommentsC=data[0].promotion_comments,$scope.urgencyCheckD=data[0].drop_price_check,$scope.urgencyCommentsD=data[0].drop_price_comments,$scope.urgencyCheckE=data[0].deposit_refund_check,$scope.urgencyCommentsE=data[0].deposit_refund_comments,$scope.othersCheckA=data[0].payment_plan_check,$scope.othersCommentsA=data[0].payment_plan_comments,$scope.othersCheckB=data[0].cooling_period_check,$scope.othersCommentsB=data[0].cooling_period_comments,$scope.othersCheckC=data[0].working_together_check,$scope.othersCommentsC=data[0].working_together_comments,$scope.othersCheckD=data[0].tax_return_check,$scope.othersCommentsD=data[0].tax_return_comments,$scope.othersCheckE=data[0].travell_global_check,$scope.othersCommentsE=data[0].travell_global_comments,$scope.othersCheckF=data[0].inclusions_check,$scope.othersCommentsF=data[0].inclusions_comments,"no"==$scope.introCheckB&&($scope.introyellowflag=!0),"no"==$scope.qualificationCheckC&&($scope.qualificationyellowflagC=!0),"no"==$scope.qualificationCheckD&&($scope.qualificationyellowflagD=!0),"yes"==$scope.selectionCheckC&&($scope.selectionredflagC=!0),"yes"==$scope.selectionCheckD&&($scope.selectionredflagD=!0),"yes"==$scope.selectionCheckE&&($scope.selectionredflagE=!0),"yes"==$scope.selectionCheckF&&($scope.selectionredflagF=!0),"yes"==$scope.selectionCheckG&&($scope.selectionredflagG=!0),"no"==$scope.costCheckC&&($scope.costredflagC=!0),"no"==$scope.costCheckD&&($scope.costredflagD=!0),"yes"==$scope.costCheckE&&($scope.costredflagE=!0),"yes"==$scope.costCheckG&&($scope.costredflagG=!0),"yes"==$scope.urgencyCheckA&&($scope.urgencyyellowflagA=!0),"yes"==$scope.urgencyCheckB&&($scope.urgencyyellowflagB=!0),"yes"==$scope.urgencyCheckC&&($scope.urgencyyellowflagC=!0),"yes"==$scope.urgencyCheckE&&($scope.urgencyredflagE=!0)})}function findResumeProfile(e){$http.get("/findResumeProfile?email="+e).success(function(data){if(console.log("resume data is",data[0]),1==data.length){$scope.hideEmptyResume=!1,$scope.form=data[0],console.log("test photo url here",data[0].photo_url),$scope.src="/"+data[0].photo_url,$http.get($scope.src).success(function(data,status){console.log("ac",status)}).error(function(data,status){console.log("bc",status),$scope.src="http://globalworkandtravel.com/resume/uploads/"+$scope.form.photo_url,console.log("test photo url here",$scope.src)}),"complete"==$scope.form.action?$scope.action="complete":$scope.action="incomplete",$scope.actionChange=function(){console.log($scope.action),$http.post("/updateAction?rid="+$scope.form.r_id+"&action="+$scope.action).success(function(returnDate){console.log("action status updated"),$scope.form.modified_date="just now"})};var myintroduce=angular.element(document.querySelector("#myintroduce"));myintroduce.append($scope.form.introduce);var myobjective=angular.element(document.querySelector("#myobjective"));myobjective.append($scope.form.objective);var myskill1=angular.element(document.querySelector("#myskill1"));myskill1.append($scope.form.skill1);var mycertificate=angular.element(document.querySelector("#mycertificate"));mycertificate.append($scope.form.certificate);var mylicense=angular.element(document.querySelector("#mylicense"));mylicense.append($scope.form.license);var myduty1=angular.element(document.querySelector("#myduty1"));myduty1.append($scope.form.duty1);var myduty2=angular.element(document.querySelector("#myduty2"));myduty2.append($scope.form.duty2);var myduty3=angular.element(document.querySelector("#myduty3"));myduty3.append($scope.form.duty3);var myduty4=angular.element(document.querySelector("#myduty4"));myduty4.append($scope.form.duty4);var myduty5=angular.element(document.querySelector("#myduty5"));myduty5.append($scope.form.duty5),$scope.viewIMG={editorEnabled:!1},$scope.enableEditorIMG=function(){$scope.viewIMG.editorEnabled=!0},$scope.disableEditorIMG=function(){$scope.viewIMG.editorEnabled=!1},$scope.saveIMG=function(upload_form){function upload(file){console.log("upload test here"),Upload.upload({url:"/uploadpicture",data:{file:file}}).then(function(resp){console.log("test response after upload",resp.data.error_code),1===resp.data.error_code?$window.alert("an error occured"):(console.log(resp.data.filename),$http.post("/savefilename?fn="+resp.data.filename+"&rid="+$scope.form.r_id).success(function(data){console.log("updated file into database successfully"),$scope.form.modified_date="just now",$scope.src="/"+resp.data.filename}))},function(resp){console.log("Error status: "+resp.status),$window.alert("Error status: "+resp.status)},function(evt){console.log(evt);var progressPercentage=parseInt(100*evt.loaded/evt.total);console.log("progress: "+progressPercentage+"% "+evt.config.data.file.name),$scope.progress="progress: "+progressPercentage+"% "})}$scope.disableEditorIMG(),console.log("avc test");upload_form.file.$valid&&$scope.file&&(console.log("hello "),upload($scope.file))},$scope.enableEditorContact=function(){$scope.view.editorEnabled=!0,$scope.view.editableValue=$scope.form.fname,$scope.view2.editorEnabled=!0,$scope.view2.editableValue=$scope.form.mname,$scope.view3.editorEnabled=!0,$scope.view3.editableValue=$scope.form.lname,$scope.view4.editorEnabled=!0,$scope.view4.editableValue=$scope.form.email,$scope.view5.editorEnabled=!0,$scope.view5.editableValue=$scope.form.phoneno,$scope.view6.editorEnabled=!0,$scope.view6.editableValue=$scope.form.skype},$scope.enableEditorEducation1=function(){$scope.view10.editorEnabled=!0,$scope.view10.editableValue=$scope.form.title1,$scope.view11.editorEnabled=!0,$scope.view11.editableValue=$scope.form.institution1,$scope.view12.editorEnabled=!0,$scope.view12.editableValue=$scope.form.educationfrom1,$scope.view13.editorEnabled=!0,$scope.view13.editableValue=$scope.form.educationto1},$scope.enableEditorEducation2=function(){$scope.view14.editorEnabled=!0,$scope.view14.editableValue=$scope.form.title2,$scope.view15.editorEnabled=!0,$scope.view15.editableValue=$scope.form.institution2,$scope.view16.editorEnabled=!0,$scope.view16.editableValue=$scope.form.educationfrom2,$scope.view17.editorEnabled=!0,$scope.view17.editableValue=$scope.form.educationto2},$scope.enableEditorEducation3=function(){$scope.view18.editorEnabled=!0,$scope.view18.editableValue=$scope.form.title3,$scope.view19.editorEnabled=!0,$scope.view19.editableValue=$scope.form.institution3,$scope.view20.editorEnabled=!0,$scope.view20.editableValue=$scope.form.educationfrom3,$scope.view21.editorEnabled=!0,$scope.view21.editableValue=$scope.form.educationto3},$scope.enableEditorEmployment1=function(){$scope.view24.editorEnabled=!0,$scope.view24.editableValue=$scope.form.jtitle1,$scope.view25.editorEnabled=!0,$scope.view25.editableValue=$scope.form.cname1,$scope.view26.editorEnabled=!0,$scope.view26.editableValue=$scope.form.cwebsite1,$scope.view27.editorEnabled=!0,$scope.view27.editableValue=$scope.form.jfrom1,$scope.view28.editorEnabled=!0,$scope.view28.editableValue=$scope.form.jto1,$scope.view29.editorEnabled=!0,$scope.view29.editableValue=$scope.form.duty1},$scope.enableEditorEmployment2=function(){$scope.view30.editorEnabled=!0,$scope.view30.editableValue=$scope.form.jtitle2,$scope.view31.editorEnabled=!0,$scope.view31.editableValue=$scope.form.cname2,$scope.view32.editorEnabled=!0,$scope.view32.editableValue=$scope.form.cwebsite2,$scope.view33.editorEnabled=!0,$scope.view33.editableValue=$scope.form.jfrom2,$scope.view34.editorEnabled=!0,$scope.view34.editableValue=$scope.form.jto2,$scope.view35.editorEnabled=!0,$scope.view35.editableValue=$scope.form.duty2},$scope.enableEditorEmployment3=function(){$scope.view36.editorEnabled=!0,$scope.view36.editableValue=$scope.form.jtitle3,$scope.view37.editorEnabled=!0,$scope.view37.editableValue=$scope.form.cname3,$scope.view38.editorEnabled=!0,$scope.view38.editableValue=$scope.form.cwebsite3,$scope.view39.editorEnabled=!0,$scope.view39.editableValue=$scope.form.jfrom3,$scope.view40.editorEnabled=!0,$scope.view40.editableValue=$scope.form.jto3,$scope.view41.editorEnabled=!0,$scope.view41.editableValue=$scope.form.duty3},$scope.enableEditorEmployment4=function(){$scope.view42.editorEnabled=!0,$scope.view42.editableValue=$scope.form.jtitle4,$scope.view43.editorEnabled=!0,$scope.view43.editableValue=$scope.form.cname4,$scope.view44.editorEnabled=!0,$scope.view44.editableValue=$scope.form.cwebsite4,$scope.view45.editorEnabled=!0,$scope.view45.editableValue=$scope.form.jfrom4,$scope.view46.editorEnabled=!0,$scope.view46.editableValue=$scope.form.jto4,$scope.view47.editorEnabled=!0,$scope.view47.editableValue=$scope.form.duty4},$scope.enableEditorEmployment5=function(){$scope.view48.editorEnabled=!0,$scope.view48.editableValue=$scope.form.jtitle5,$scope.view49.editorEnabled=!0,$scope.view49.editableValue=$scope.form.cname5,$scope.view50.editorEnabled=!0,$scope.view50.editableValue=$scope.form.cwebsite5,$scope.view51.editorEnabled=!0,$scope.view51.editableValue=$scope.form.jfrom5,$scope.view52.editorEnabled=!0,$scope.view52.editableValue=$scope.form.jto5,$scope.view53.editorEnabled=!0,$scope.view53.editableValue=$scope.form.duty5},$scope.cancelallcontact=function(){$scope.view.editorEnabled=!1,$scope.view2.editorEnabled=!1,$scope.view3.editorEnabled=!1,$scope.view4.editorEnabled=!1,$scope.view5.editorEnabled=!1,$scope.view6.editorEnabled=!1},$scope.cancelalleducation1=function(){$scope.view10.editorEnabled=!1,$scope.view11.editorEnabled=!1,$scope.view12.editorEnabled=!1,$scope.view13.editorEnabled=!1},$scope.form.title2||$scope.form.institution2||$scope.form.educationfrom2||$scope.form.educationto2?$scope.cancelalleducation2=function(){$scope.view14.editorEnabled=!1,$scope.view15.editorEnabled=!1,$scope.view16.editorEnabled=!1,$scope.view17.editorEnabled=!1,console.log($scope.form.institution2,"why")}:$scope.cancelalleducation2=function(){$scope.hideEducation2=!0},$scope.form.title3||$scope.form.institution3||$scope.form.educationfrom3||$scope.form.educationto3?$scope.cancelalleducation3=function(){$scope.view18.editorEnabled=!1,$scope.view19.editorEnabled=!1,$scope.view20.editorEnabled=!1,$scope.view21.editorEnabled=!1}:$scope.cancelalleducation3=function(){$scope.hideEducation3=!0},$scope.cancelallemployment1=function(){$scope.view24.editorEnabled=!1,$scope.view25.editorEnabled=!1,$scope.view26.editorEnabled=!1,$scope.view27.editorEnabled=!1,$scope.view28.editorEnabled=!1,$scope.view29.editorEnabled=!1},$scope.form.jtitle2||$scope.form.cname2||$scope.form.cwebsite2||$scope.form.jfrom2||$scope.form.jto2||$scope.form.duty2?$scope.cancelallemployment2=function(){$scope.view30.editorEnabled=!1,$scope.view31.editorEnabled=!1,$scope.view32.editorEnabled=!1,$scope.view33.editorEnabled=!1,$scope.view34.editorEnabled=!1,$scope.view35.editorEnabled=!1}:$scope.cancelallemployment2=function(){$scope.hideEmployment2=!0},$scope.form.jtitle3||$scope.form.cname3||$scope.form.cwebsite3||$scope.form.jfrom3||$scope.form.jto3||$scope.form.duty3?$scope.cancelallemployment3=function(){$scope.view36.editorEnabled=!1,$scope.view37.editorEnabled=!1,$scope.view38.editorEnabled=!1,$scope.view39.editorEnabled=!1,$scope.view40.editorEnabled=!1,$scope.view41.editorEnabled=!1}:$scope.cancelallemployment3=function(){$scope.hideEmployment3=!0},$scope.form.jtitle4||$scope.form.cname4||$scope.form.cwebsite4||$scope.form.jfrom4||$scope.form.jto4||$scope.form.duty4?$scope.cancelallemployment4=function(){
$scope.view42.editorEnabled=!1,$scope.view43.editorEnabled=!1,$scope.view44.editorEnabled=!1,$scope.view45.editorEnabled=!1,$scope.view46.editorEnabled=!1,$scope.view47.editorEnabled=!1}:$scope.cancelallemployment4=function(){$scope.hideEmployment4=!0},$scope.form.jtitle5||$scope.form.cname5||$scope.form.cwebsite5||$scope.form.jfrom5||$scope.form.jto5||$scope.form.duty5?$scope.cancelallemployment5=function(){$scope.view48.editorEnabled=!1,$scope.view49.editorEnabled=!1,$scope.view50.editorEnabled=!1,$scope.view51.editorEnabled=!1,$scope.view52.editorEnabled=!1,$scope.view53.editorEnabled=!1}:$scope.cancelallemployment5=function(){$scope.hideEmployment5=!0},data[0].title2||data[0].institution2||data[0].educationfrom2||data[0].educationto2?($scope.hideEducation2=!1,$scope.showEditorEducation2=!0,$scope.hidewhenadd2=!1):($scope.hideEducation2=!0,$scope.showEditorEducation2=!1,$scope.hidewhenadd2=!0),$scope.saveallEducation2=function(){$scope.form.title2=$scope.view14.editableValue,$scope.disableEditor14();var cola="title2",elementa=$scope.form.title2;update(cola,elementa),$scope.form.institution2=$scope.view15.editableValue,$scope.disableEditor15();var colb="institution2",elementb=$scope.form.institution2;update(colb,elementb),$scope.form.educationfrom2=$scope.view16.editableValue,$scope.disableEditor16();var colc="educationfrom2",elementc=$scope.form.educationfrom2;elementc=formatdate(elementc),update(colc,elementc),$scope.form.educationto2=$scope.view17.editableValue,$scope.disableEditor17();var cold="educationto2",elementd=$scope.form.educationto2;elementd=formatdate(elementd),update(cold,elementd)},data[0].title3||data[0].institution3||data[0].educationfrom3||data[0].educationto3?($scope.hideEducation3=!1,$scope.showEditorEducation3=!0,$scope.hidewhenadd3=!1):($scope.hideEducation3=!0,$scope.showEditorEducation3=!1,$scope.hidewhenadd3=!0),$scope.saveallEducation3=function(){$scope.form.title3=$scope.view18.editableValue,$scope.disableEditor18();var cola="title3",elementa=$scope.form.title3;update(cola,elementa),$scope.form.institution3=$scope.view19.editableValue,$scope.disableEditor19();var colb="institution3",elementb=$scope.form.institution3;update(colb,elementb),$scope.form.educationfrom3=$scope.view20.editableValue,$scope.disableEditor20();var colc="educationfrom3",elementc=$scope.form.educationfrom3;elementc=formatdate(elementc),update(colc,elementc),$scope.form.educationto3=$scope.view21.editableValue,$scope.disableEditor21();var cold="educationto3",elementd=$scope.form.educationto3;elementd=formatdate(elementd),update(cold,elementd)},data[0].jtitle2||data[0].cname2||data[0].cwebsite2||data[0].jfrom2||data[0].jto2||data[0].duty2?($scope.hideEmployment2=!1,$scope.showEditorEmployment2=!0,$scope.hidewhenaddemployment2=!1):($scope.hideEmployment2=!0,$scope.showEditorEmployment2=!1,$scope.hidewhenaddemployment2=!0),$scope.saveallEmployment2=function(){$scope.form.jtitle2=$scope.view30.editableValue,$scope.disableEditor30();var cola="jtitle2",elementa=$scope.form.jtitle2;update(cola,elementa),$scope.form.cname2=$scope.view31.editableValue,$scope.disableEditor31();var colb="cname2",elementb=$scope.form.cname2;update(colb,elementb),$scope.form.cwebsite2=$scope.view32.editableValue,$scope.disableEditor32();var colc="cwebsite2",elementc=$scope.form.cwebsite2;update(colc,elementc),$scope.form.jfrom2=$scope.view33.editableValue,$scope.disableEditor33();var cold="jfrom2",elementd=$scope.form.jfrom2;elementd=formatdate(elementd),update(cold,elementd),$scope.form.jto2=$scope.view34.editableValue,$scope.disableEditor34();var cole="jto2",elemente=$scope.form.jto2;elemente=formatdate(elemente),update(cole,elemente),$scope.form.duty2=$scope.view35.editableValue,$scope.disableEditor35();var colf="duty2",elementf=$scope.form.duty2;update(colf,elementf);var myduty2=angular.element(document.querySelector("#myduty2"));myduty2.empty(),myduty2.append($scope.form.duty2)},data[0].jtitle3||data[0].cname3||data[0].cwebsite3||data[0].jfrom3||data[0].jto3||data[0].duty3?($scope.hideEmployment3=!1,$scope.showEditorEmployment3=!0,$scope.hidewhenaddemployment3=!1):($scope.hideEmployment3=!0,$scope.showEditorEmployment3=!1,$scope.hidewhenaddemployment3=!0),$scope.saveallEmployment3=function(){$scope.form.jtitle3=$scope.view36.editableValue,$scope.disableEditor36();var cola="jtitle3",elementa=$scope.form.jtitle3;update(cola,elementa),$scope.form.cname3=$scope.view37.editableValue,$scope.disableEditor37();var colb="cname3",elementb=$scope.form.cname3;update(colb,elementb),$scope.form.cwebsite3=$scope.view38.editableValue,$scope.disableEditor38();var colc="cwebsite3",elementc=$scope.form.cwebsite3;update(colc,elementc),$scope.form.jfrom3=$scope.view39.editableValue,$scope.disableEditor39();var cold="jfrom3",elementd=$scope.form.jfrom3;elementd=formatdate(elementd),update(cold,elementd),$scope.form.jto3=$scope.view40.editableValue,$scope.disableEditor40();var cole="jto3",elemente=$scope.form.jto3;elemente=formatdate(elemente),update(cole,elemente),$scope.form.duty3=$scope.view41.editableValue,$scope.disableEditor41();var colf="duty3",elementf=$scope.form.duty3;update(colf,elementf);var myduty3=angular.element(document.querySelector("#myduty3"));myduty3.empty(),myduty3.append($scope.form.duty3)},data[0].jtitle4||data[0].cname4||data[0].cwebsite4||data[0].jfrom4||data[0].jto4||data[0].duty4?($scope.hideEmployment4=!1,$scope.showEditorEmployment4=!0,$scope.hidewhenaddemployment4=!1):($scope.hideEmployment4=!0,$scope.showEditorEmployment4=!1,$scope.hidewhenaddemployment4=!0),$scope.saveallEmployment4=function(){$scope.form.jtitle4=$scope.view42.editableValue,$scope.disableEditor42();var cola="jtitle4",elementa=$scope.form.jtitle4;update(cola,elementa),$scope.form.cname4=$scope.view43.editableValue,$scope.disableEditor43();var colb="cname4",elementb=$scope.form.cname4;update(colb,elementb),$scope.form.cwebsite4=$scope.view44.editableValue,$scope.disableEditor44();var colc="cwebsite4",elementc=$scope.form.cwebsite4;update(colc,elementc),$scope.form.jfrom4=$scope.view45.editableValue,$scope.disableEditor45();var cold="jfrom4",elementd=$scope.form.jfrom4;elementd=formatdate(elementd),update(cold,elementd),$scope.form.jto4=$scope.view46.editableValue,$scope.disableEditor46();var cole="jto4",elemente=$scope.form.jto4;elemente=formatdate(elemente),update(cole,elemente),$scope.form.duty4=$scope.view47.editableValue,$scope.disableEditor47();var colf="duty4",elementf=$scope.form.duty4;update(colf,elementf);var myduty4=angular.element(document.querySelector("#myduty4"));myduty4.empty(),myduty4.append($scope.form.duty4)},data[0].jtitle5||data[0].cname5||data[0].cwebsite5||data[0].jfrom5||data[0].jto5||data[0].duty5?($scope.hideEmployment5=!1,$scope.showEditorEmployment5=!0,$scope.hidewhenaddemployment5=!1):($scope.hideEmployment5=!0,$scope.showEditorEmployment5=!1,$scope.hidewhenaddemployment5=!0),$scope.saveallEmployment5=function(){$scope.form.jtitle5=$scope.view48.editableValue,$scope.disableEditor48();var cola="jtitle5",elementa=$scope.form.jtitle5;update(cola,elementa),$scope.form.cname5=$scope.view49.editableValue,$scope.disableEditor49();var colb="cname5",elementb=$scope.form.cname5;update(colb,elementb),$scope.form.cwebsite5=$scope.view50.editableValue,$scope.disableEditor50();var colc="cwebsite5",elementc=$scope.form.cwebsite5;update(colc,elementc),$scope.form.jfrom5=$scope.view51.editableValue,$scope.disableEditor51();var cold="jfrom5",elementd=$scope.form.jfrom5;elementd=formatdate(elementd),update(cold,elementd),$scope.form.jto5=$scope.view52.editableValue,$scope.disableEditor52();var cole="jto5",elemente=$scope.form.jto5;elemente=formatdate(elemente),update(cole,elemente),$scope.form.duty5=$scope.view53.editableValue,$scope.disableEditor53();var colf="duty5",elementf=$scope.form.duty5;update(colf,elementf);var myduty5=angular.element(document.querySelector("#myduty5"));myduty5.empty(),myduty5.append($scope.form.duty5)},$scope.addoneEducation=function(){1==$scope.hideEducation2?($scope.hideEducation2=!1,$scope.view14.editorEnabled=!0,$scope.view14.editableValue=$scope.form.title2,$scope.view15.editorEnabled=!0,$scope.view15.editableValue=$scope.form.institution2,$scope.view16.editorEnabled=!0,$scope.view16.editableValue=$scope.form.educationfrom2,$scope.view17.editorEnabled=!0,$scope.view17.editableValue=$scope.form.educationto2):1==$scope.hideEducation3?($scope.hideEducation3=!1,$scope.view18.editorEnabled=!0,$scope.view18.editableValue=$scope.form.title3,$scope.view19.editorEnabled=!0,$scope.view19.editableValue=$scope.form.institution3,$scope.view20.editorEnabled=!0,$scope.view20.editableValue=$scope.form.educationfrom3,$scope.view21.editorEnabled=!0,$scope.view21.editableValue=$scope.form.educationto3):console.log("mate, 3 education is enough here")},$scope.addoneEmployment=function(){1==$scope.hideEmployment2?($scope.hideEmployment2=!1,$scope.view30.editorEnabled=!0,$scope.view30.editableValue=$scope.form.jtitle2,$scope.view31.editorEnabled=!0,$scope.view31.editableValue=$scope.form.cname2,$scope.view32.editorEnabled=!0,$scope.view32.editableValue=$scope.form.cwebsite2,$scope.view33.editorEnabled=!0,$scope.view33.editableValue=$scope.form.jfrom2,$scope.view34.editorEnabled=!0,$scope.view34.editableValue=$scope.form.jto2,$scope.view35.editorEnabled=!0,$scope.view35.editableValue=$scope.form.duty2):1==$scope.hideEmployment3?($scope.hideEmployment3=!1,$scope.view36.editorEnabled=!0,$scope.view36.editableValue=$scope.form.jtitle3,$scope.view37.editorEnabled=!0,$scope.view37.editableValue=$scope.form.cname3,$scope.view38.editorEnabled=!0,$scope.view38.editableValue=$scope.form.cwebsite3,$scope.view39.editorEnabled=!0,$scope.view39.editableValue=$scope.form.jfrom3,$scope.view40.editorEnabled=!0,$scope.view40.editableValue=$scope.form.jto3,$scope.view41.editorEnabled=!0,$scope.view41.editableValue=$scope.form.duty3):1==$scope.hideEmployment4?($scope.hideEmployment4=!1,$scope.view42.editorEnabled=!0,$scope.view42.editableValue=$scope.form.jtitle4,$scope.view43.editorEnabled=!0,$scope.view43.editableValue=$scope.form.cname4,$scope.view44.editorEnabled=!0,$scope.view44.editableValue=$scope.form.cwebsite4,$scope.view45.editorEnabled=!0,$scope.view45.editableValue=$scope.form.jfrom4,$scope.view46.editorEnabled=!0,$scope.view46.editableValue=$scope.form.jto4,$scope.view47.editorEnabled=!0,$scope.view47.editableValue=$scope.form.duty4):1==$scope.hideEmployment5&&($scope.hideEmployment5=!1,$scope.view48.editorEnabled=!0,$scope.view48.editableValue=$scope.form.jtitle5,$scope.view49.editorEnabled=!0,$scope.view49.editableValue=$scope.form.cname5,$scope.view50.editorEnabled=!0,$scope.view50.editableValue=$scope.form.cwebsite5,$scope.view51.editorEnabled=!0,$scope.view51.editableValue=$scope.form.jfrom5,$scope.view52.editorEnabled=!0,$scope.view52.editableValue=$scope.form.jto5,$scope.view53.editorEnabled=!0,$scope.view53.editableValue=$scope.form.duty5)},$scope.view={editableValue:$scope.form.fname,editorEnabled:!1},$scope.disableEditor=function(){$scope.view.editorEnabled=!1},$scope.save=function(){$scope.form.fname=$scope.view.editableValue,$scope.disableEditor(),console.log("avc test");var col="fname",element=$scope.form.fname;update(col,element)},$scope.view2={editableValue:$scope.form.mname,editorEnabled:!1},$scope.disableEditor2=function(){$scope.view2.editorEnabled=!1},$scope.save2=function(){$scope.form.mname=$scope.view2.editableValue,$scope.disableEditor2(),console.log("avc test");var col="mname",element=$scope.form.mname;update(col,element)},$scope.view3={editableValue:$scope.form.lname,editorEnabled:!1},$scope.disableEditor3=function(){$scope.view3.editorEnabled=!1},$scope.save3=function(){$scope.form.lname=$scope.view3.editableValue,$scope.disableEditor3(),console.log("avc test");var col="lname",element=$scope.form.lname;update(col,element)},$scope.view4={editableValue:$scope.form.email,editorEnabled:!1},$scope.disableEditor4=function(){$scope.view4.editorEnabled=!1},$scope.save4=function(){$scope.form.email=$scope.view4.editableValue,$scope.disableEditor4(),console.log("avc test");var col="email",element=$scope.form.email;update(col,element)},$scope.view5={editableValue:$scope.form.phoneno,editorEnabled:!1},$scope.disableEditor5=function(){$scope.view5.editorEnabled=!1},$scope.save5=function(){$scope.form.phoneno=$scope.view5.editableValue,$scope.disableEditor5(),console.log("avc test");var col="phoneno",element=$scope.form.phoneno;update(col,element)},$scope.view6={editableValue:$scope.form.skype,editorEnabled:!1},$scope.disableEditor6=function(){$scope.view6.editorEnabled=!1},$scope.save6=function(){$scope.form.skype=$scope.view6.editableValue,$scope.disableEditor6(),console.log("avc test");var col="skype",element=$scope.form.skype;update(col,element)},$scope.view7={editableValue:$scope.form.introduce,editorEnabled:!1},$scope.enableEditor7=function(){$scope.view7.editorEnabled=!0,$scope.view7.editableValue=$scope.form.introduce},$scope.disableEditor7=function(){$scope.view7.editorEnabled=!1},$scope.save7=function(){$scope.form.introduce=$scope.view7.editableValue,console.log($scope.view7.editableValue),$scope.disableEditor7(),console.log("avc test");var col="introduce",element=$scope.form.introduce;update(col,element);var myintroduce=angular.element(document.querySelector("#myintroduce"));myintroduce.empty(),myintroduce.append($scope.form.introduce)},$scope.view8={editableValue:$scope.form.objective,editorEnabled:!1},$scope.enableEditor8=function(){$scope.view8.editorEnabled=!0,$scope.view8.editableValue=$scope.form.objective},$scope.disableEditor8=function(){$scope.view8.editorEnabled=!1},$scope.save8=function(){$scope.form.objective=$scope.view8.editableValue,$scope.disableEditor8(),console.log("avc test");var col="objective",element=$scope.form.objective;update(col,element);var myobjective=angular.element(document.querySelector("#myobjective"));myobjective.empty(),myobjective.append($scope.form.objective)},$scope.view9={editableValue:$scope.form.skill1,editorEnabled:!1},$scope.enableEditor9=function(){$scope.view9.editorEnabled=!0,$scope.view9.editableValue=$scope.form.skill1},$scope.disableEditor9=function(){$scope.view9.editorEnabled=!1},$scope.save9=function(){$scope.form.skill1=$scope.view9.editableValue,$scope.disableEditor9(),console.log("avc test");var col="skill1",element=$scope.form.skill1;update(col,element);var myskill1=angular.element(document.querySelector("#myskill1"));myskill1.empty(),myskill1.append($scope.form.skill1)},$scope.view10={editableValue:$scope.form.title1,editorEnabled:!1},$scope.disableEditor10=function(){$scope.view10.editorEnabled=!1},$scope.save10=function(){$scope.form.title1=$scope.view10.editableValue,$scope.disableEditor10(),console.log("avc test");var col="title1",element=$scope.form.title1;update(col,element)},$scope.view11={editableValue:$scope.form.institution1,editorEnabled:!1},$scope.disableEditor11=function(){$scope.view11.editorEnabled=!1},$scope.save11=function(){$scope.form.institution1=$scope.view11.editableValue,$scope.disableEditor11(),console.log("avc test");var col="institution1",element=$scope.form.institution1;update(col,element)},$scope.view12={editableValue:$scope.form.educationfrom1,editorEnabled:!1},$scope.disableEditor12=function(){$scope.view12.editorEnabled=!1},$scope.save12=function(){$scope.form.educationfrom1=$scope.view12.editableValue,$scope.disableEditor12(),console.log("avc test");var col="educationfrom1",element=$scope.form.educationfrom1;element=formatdate(element),console.log(element),update(col,element)},$scope.view13={editableValue:$scope.form.educationto1,editorEnabled:!1},$scope.disableEditor13=function(){$scope.view13.editorEnabled=!1},$scope.save13=function(){$scope.form.educationto1=$scope.view13.editableValue,$scope.disableEditor13(),console.log("avc test");var col="educationto1",element=$scope.form.educationto1;element=formatdate(element),console.log(element),update(col,element)},$scope.view14={editableValue:$scope.form.title2,editorEnabled:!1},$scope.disableEditor14=function(){$scope.view14.editorEnabled=!1},$scope.save14=function(){$scope.form.title2=$scope.view14.editableValue,$scope.disableEditor14(),console.log("avc test");var col="title2",element=$scope.form.title2;update(col,element)},$scope.view15={editableValue:$scope.form.institution2,editorEnabled:!1},$scope.disableEditor15=function(){$scope.view15.editorEnabled=!1},$scope.save15=function(){$scope.form.institution2=$scope.view15.editableValue,$scope.disableEditor15(),console.log("avc test");var col="institution2",element=$scope.form.institution2;update(col,element)},$scope.view16={editableValue:$scope.form.educationfrom2,editorEnabled:!1},$scope.disableEditor16=function(){$scope.view16.editorEnabled=!1},$scope.save16=function(){$scope.form.educationfrom2=$scope.view16.editableValue,$scope.disableEditor16(),console.log("avc test");var col="educationfrom2",element=$scope.form.educationfrom2;element=formatdate(element),update(col,element)},$scope.view17={editableValue:$scope.form.educationto2,editorEnabled:!1},$scope.disableEditor17=function(){$scope.view17.editorEnabled=!1},$scope.save17=function(){$scope.form.educationto2=$scope.view17.editableValue,$scope.disableEditor17(),console.log("avc test");var col="educationto2",element=$scope.form.educationto2;element=formatdate(element),update(col,element)},$scope.view18={editableValue:$scope.form.title3,editorEnabled:!1},$scope.disableEditor18=function(){$scope.view18.editorEnabled=!1},$scope.save18=function(){$scope.form.title3=$scope.view18.editableValue,$scope.disableEditor18(),console.log("avc test");var col="title3",element=$scope.form.title3;update(col,element)},$scope.view19={editableValue:$scope.form.institution3,editorEnabled:!1},$scope.enableEditor19=function(){$scope.view19.editorEnabled=!0,$scope.view19.editableValue=$scope.form.institution3},$scope.disableEditor19=function(){$scope.view19.editorEnabled=!1},$scope.save19=function(){$scope.form.institution3=$scope.view19.editableValue,$scope.disableEditor19(),console.log("avc test");var col="institution3",element=$scope.form.institution3;update(col,element)},$scope.view20={editableValue:$scope.form.educationfrom3,editorEnabled:!1},$scope.enableEditor20=function(){$scope.view20.editorEnabled=!0,$scope.view20.editableValue=$scope.form.educationfrom3},$scope.disableEditor20=function(){$scope.view20.editorEnabled=!1},$scope.save20=function(){$scope.form.educationfrom3=$scope.view20.editableValue,$scope.disableEditor20(),console.log("avc test");var col="educationfrom3",element=$scope.form.educationfrom3;element=formatdate(element),update(col,element)},$scope.view21={editableValue:$scope.form.educationto3,editorEnabled:!1},$scope.enableEditor21=function(){$scope.view21.editorEnabled=!0,$scope.view21.editableValue=$scope.form.educationto3},$scope.disableEditor21=function(){$scope.view21.editorEnabled=!1},$scope.save21=function(){$scope.form.educationto3=$scope.view21.editableValue,$scope.disableEditor21(),console.log("avc test");var col="educationto3",element=$scope.form.educationto3;element=formatdate(element),update(col,element)},$scope.view22={editableValue:$scope.form.certificate,editorEnabled:!1},$scope.enableEditor22=function(){$scope.view22.editorEnabled=!0,$scope.view22.editableValue=$scope.form.certificate},$scope.disableEditor22=function(){$scope.view22.editorEnabled=!1},$scope.save22=function(){$scope.form.certificate=$scope.view22.editableValue,$scope.disableEditor22(),console.log("avc test");var col="certificate",element=$scope.form.certificate;update(col,element);var mycertificate=angular.element(document.querySelector("#mycertificate"));mycertificate.empty(),mycertificate.append($scope.form.certificate)},$scope.view23={editableValue:$scope.form.license,editorEnabled:!1},$scope.enableEditor23=function(){$scope.view23.editorEnabled=!0,$scope.view23.editableValue=$scope.form.license},$scope.disableEditor23=function(){$scope.view23.editorEnabled=!1},$scope.save23=function(){$scope.form.license=$scope.view23.editableValue,$scope.disableEditor23(),console.log("avc test");var col="license",element=$scope.form.license;update(col,element);var mylicense=angular.element(document.querySelector("#mylicense"));mylicense.empty(),mylicense.append($scope.form.license)},$scope.view24={editableValue:$scope.form.jtitle1,editorEnabled:!1},$scope.disableEditor24=function(){$scope.view24.editorEnabled=!1},$scope.save24=function(){$scope.form.jtitle1=$scope.view24.editableValue,$scope.disableEditor24(),console.log("avc test");var col="jtitle1",element=$scope.form.jtitle1;update(col,element)},$scope.view25={editableValue:$scope.form.cname1,editorEnabled:!1},$scope.disableEditor25=function(){$scope.view25.editorEnabled=!1},$scope.save25=function(){$scope.form.cname1=$scope.view25.editableValue,$scope.disableEditor25(),console.log("avc test");var col="cname1",element=$scope.form.cname1;update(col,element)},$scope.view26={editableValue:$scope.form.cwebsite1,editorEnabled:!1},$scope.disableEditor26=function(){$scope.view26.editorEnabled=!1},$scope.save26=function(){$scope.form.cwebsite1=$scope.view26.editableValue,$scope.disableEditor26(),console.log("avc test");var col="cwebsite1",element=$scope.form.cwebsite1;update(col,element)},$scope.view27={editableValue:$scope.form.jfrom1,editorEnabled:!1},$scope.disableEditor27=function(){$scope.view27.editorEnabled=!1},$scope.save27=function(){$scope.form.jfrom1=$scope.view27.editableValue,$scope.disableEditor27(),console.log("avc test");var col="jfrom1",element=$scope.form.jfrom1;element=formatdate(element),update(col,element)},$scope.view28={editableValue:$scope.form.jto1,editorEnabled:!1},$scope.disableEditor28=function(){$scope.view28.editorEnabled=!1},$scope.save28=function(){$scope.form.jto1=$scope.view28.editableValue,$scope.disableEditor28(),console.log("avc test");var col="jto1",element=$scope.form.jto1;element=formatdate(element),update(col,element)},$scope.view29={editableValue:$scope.form.duty1,editorEnabled:!1},$scope.disableEditor29=function(){$scope.view29.editorEnabled=!1},$scope.save29=function(){$scope.form.duty1=$scope.view29.editableValue,$scope.disableEditor29(),console.log("avc test");var col="duty1",element=$scope.form.duty1;update(col,element);var myduty1=angular.element(document.querySelector("#myduty1"));myduty1.empty(),myduty1.append($scope.form.duty1)},$scope.view30={editableValue:$scope.form.jtitle2,editorEnabled:!1},$scope.enableEditor30=function(){$scope.view30.editorEnabled=!0,$scope.view30.editableValue=$scope.form.jtitle2},$scope.disableEditor30=function(){$scope.view30.editorEnabled=!1},$scope.save30=function(){$scope.form.jtitle2=$scope.view30.editableValue,$scope.disableEditor30(),console.log("avc test");var col="jtitle2",element=$scope.form.jtitle2;update(col,element)},$scope.view31={editableValue:$scope.form.cname2,editorEnabled:!1},$scope.enableEditor31=function(){$scope.view31.editorEnabled=!0,$scope.view31.editableValue=$scope.form.cname2},$scope.disableEditor31=function(){$scope.view31.editorEnabled=!1},$scope.save31=function(){$scope.form.cname2=$scope.view31.editableValue,$scope.disableEditor31(),console.log("avc test");var col="cname2",element=$scope.form.cname2;update(col,element)},$scope.view32={editableValue:$scope.form.cwebsite2,editorEnabled:!1},$scope.enableEditor32=function(){$scope.view32.editorEnabled=!0,$scope.view32.editableValue=$scope.form.cwebsite2},$scope.disableEditor32=function(){$scope.view32.editorEnabled=!1},$scope.save32=function(){$scope.form.cwebsite2=$scope.view32.editableValue,$scope.disableEditor32(),console.log("avc test");var col="cwebsite2",element=$scope.form.cwebsite2;update(col,element)},$scope.view33={editableValue:$scope.form.jfrom2,editorEnabled:!1},$scope.enableEditor33=function(){$scope.view33.editorEnabled=!0,$scope.view33.editableValue=$scope.form.jfrom2},$scope.disableEditor33=function(){$scope.view33.editorEnabled=!1},$scope.save33=function(){$scope.form.jfrom2=$scope.view33.editableValue,$scope.disableEditor33(),console.log("avc test");var col="jfrom2",element=$scope.form.jfrom2;element=formatdate(element),update(col,element)},$scope.view34={editableValue:$scope.form.jto2,editorEnabled:!1},$scope.enableEditor34=function(){$scope.view34.editorEnabled=!0,$scope.view34.editableValue=$scope.form.jto2},$scope.disableEditor34=function(){$scope.view34.editorEnabled=!1},$scope.save34=function(){$scope.form.jto2=$scope.view34.editableValue,$scope.disableEditor34(),console.log("avc test");var col="jto2",element=$scope.form.jto2;element=formatdate(element),update(col,element)},$scope.view35={editableValue:$scope.form.duty2,editorEnabled:!1},$scope.enableEditor35=function(){$scope.view35.editorEnabled=!0,$scope.view35.editableValue=$scope.form.duty2},$scope.disableEditor35=function(){$scope.view35.editorEnabled=!1},$scope.save35=function(){$scope.form.duty2=$scope.view35.editableValue,$scope.disableEditor35(),console.log("avc test");var col="duty2",element=$scope.form.duty2;update(col,element);var myduty2=angular.element(document.querySelector("#myduty2"));myduty2.empty(),myduty2.append($scope.form.duty2)},$scope.view36={editableValue:$scope.form.jtitle3,editorEnabled:!1},$scope.enableEditor36=function(){$scope.view36.editorEnabled=!0,$scope.view36.editableValue=$scope.form.jtitle3},$scope.disableEditor36=function(){$scope.view36.editorEnabled=!1},$scope.save36=function(){$scope.form.jtitle3=$scope.view36.editableValue,$scope.disableEditor36(),console.log("avc test");var col="jtitle3",element=$scope.form.jtitle3;update(col,element)},$scope.view37={editableValue:$scope.form.cname3,editorEnabled:!1},$scope.enableEditor37=function(){$scope.view37.editorEnabled=!0,$scope.view37.editableValue=$scope.form.cname3},$scope.disableEditor37=function(){$scope.view37.editorEnabled=!1},$scope.save37=function(){$scope.form.cname3=$scope.view37.editableValue,$scope.disableEditor37(),console.log("avc test");var col="cname3",element=$scope.form.cname3;update(col,element)},$scope.view38={editableValue:$scope.form.cwebsite3,editorEnabled:!1},$scope.enableEditor38=function(){$scope.view38.editorEnabled=!0,$scope.view38.editableValue=$scope.form.cwebsite3},$scope.disableEditor38=function(){$scope.view38.editorEnabled=!1},$scope.save38=function(){$scope.form.cwebsite3=$scope.view38.editableValue,$scope.disableEditor38(),console.log("avc test");var col="cwebsite3",element=$scope.form.cwebsite3;update(col,element)},$scope.custom38=!0,$scope.toggleCustom38=function(){$scope.custom38=!1},$scope.toggleCustomb38=function(){$scope.custom38=!0},$scope.view39={editableValue:$scope.form.jfrom3,editorEnabled:!1},$scope.enableEditor39=function(){$scope.view39.editorEnabled=!0,$scope.view39.editableValue=$scope.form.jfrom3},$scope.disableEditor39=function(){$scope.view39.editorEnabled=!1},$scope.save39=function(){$scope.form.jfrom3=$scope.view39.editableValue,$scope.disableEditor39(),console.log("avc test");var col="jfrom3",element=$scope.form.jfrom3;element=formatdate(element),update(col,element)},$scope.view40={editableValue:$scope.form.jto3,editorEnabled:!1},$scope.enableEditor40=function(){$scope.view40.editorEnabled=!0,$scope.view40.editableValue=$scope.form.jto3},$scope.disableEditor40=function(){$scope.view40.editorEnabled=!1},$scope.save40=function(){$scope.form.jto3=$scope.view40.editableValue,$scope.disableEditor40(),console.log("avc test");var col="jto3",element=$scope.form.jto3;element=formatdate(element),update(col,element)},$scope.view41={editableValue:$scope.form.duty3,editorEnabled:!1},$scope.enableEditor41=function(){$scope.view41.editorEnabled=!0,$scope.view41.editableValue=$scope.form.duty3},$scope.disableEditor41=function(){$scope.view41.editorEnabled=!1},$scope.save41=function(){$scope.form.duty3=$scope.view41.editableValue,$scope.disableEditor41(),console.log("avc test");var col="duty3",element=$scope.form.duty3;update(col,element);var myduty3=angular.element(document.querySelector("#myduty3"));myduty3.empty(),myduty3.append($scope.form.duty3)},$scope.view42={editableValue:$scope.form.jtitle4,editorEnabled:!1},$scope.enableEditor42=function(){$scope.view42.editorEnabled=!0,$scope.view42.editableValue=$scope.form.jtitle4},$scope.disableEditor42=function(){$scope.view42.editorEnabled=!1},$scope.save42=function(){$scope.form.jtitle4=$scope.view42.editableValue,$scope.disableEditor42(),console.log("avc test");var col="jtitle4",element=$scope.form.jtitle4;update(col,element)},$scope.view43={editableValue:$scope.form.cname4,editorEnabled:!1},$scope.enableEditor43=function(){$scope.view43.editorEnabled=!0,$scope.view43.editableValue=$scope.form.cname4},$scope.disableEditor43=function(){$scope.view43.editorEnabled=!1},$scope.save43=function(){$scope.form.cname4=$scope.view43.editableValue,$scope.disableEditor43(),console.log("avc test");var col="cname4",element=$scope.form.cname4;update(col,element)},$scope.view44={editableValue:$scope.form.cwebsite4,editorEnabled:!1},$scope.enableEditor44=function(){$scope.view44.editorEnabled=!0,$scope.view44.editableValue=$scope.form.cwebsite4},$scope.disableEditor44=function(){$scope.view44.editorEnabled=!1},$scope.save44=function(){$scope.form.cwebsite4=$scope.view44.editableValue,$scope.disableEditor44(),console.log("avc test");var col="cwebsite4",element=$scope.form.cwebsite4;update(col,element)},$scope.view45={editableValue:$scope.form.jfrom4,editorEnabled:!1},$scope.enableEditor45=function(){$scope.view45.editorEnabled=!0,$scope.view45.editableValue=$scope.form.jfrom4},$scope.disableEditor45=function(){$scope.view45.editorEnabled=!1},$scope.save45=function(){$scope.form.jfrom4=$scope.view45.editableValue,$scope.disableEditor45(),console.log("avc test");var col="jfrom4",element=$scope.form.jfrom4;element=formatdate(element),update(col,element)},$scope.view46={editableValue:$scope.form.jto4,editorEnabled:!1},$scope.enableEditor46=function(){$scope.view46.editorEnabled=!0,$scope.view46.editableValue=$scope.form.jto4},$scope.disableEditor46=function(){$scope.view46.editorEnabled=!1},$scope.save46=function(){$scope.form.jto4=$scope.view46.editableValue,$scope.disableEditor46(),console.log("avc test");var col="jto4",element=$scope.form.jto4;element=formatdate(element),update(col,element)},$scope.view47={editableValue:$scope.form.duty4,editorEnabled:!1},$scope.enableEditor47=function(){$scope.view47.editorEnabled=!0,$scope.view47.editableValue=$scope.form.duty4},$scope.disableEditor47=function(){$scope.view47.editorEnabled=!1},$scope.save47=function(){$scope.form.duty4=$scope.view47.editableValue,$scope.disableEditor47(),console.log("avc test");var col="duty4",element=$scope.form.duty4;update(col,element);var myduty4=angular.element(document.querySelector("#myduty4"));myduty4.empty(),myduty4.append($scope.form.duty4)},$scope.view48={editableValue:$scope.form.jtitle5,editorEnabled:!1},$scope.enableEditor48=function(){$scope.view48.editorEnabled=!0,$scope.view48.editableValue=$scope.form.jtitle5},$scope.disableEditor48=function(){$scope.view48.editorEnabled=!1},$scope.save48=function(){$scope.form.jtitle5=$scope.view48.editableValue,$scope.disableEditor48(),console.log("avc test");var col="jtitle5",element=$scope.form.jtitle5;update(col,element)},$scope.view49={editableValue:$scope.form.cname5,editorEnabled:!1},$scope.enableEditor49=function(){$scope.view49.editorEnabled=!0,$scope.view49.editableValue=$scope.form.cname5},$scope.disableEditor49=function(){$scope.view49.editorEnabled=!1},$scope.save49=function(){$scope.form.cname5=$scope.view49.editableValue,$scope.disableEditor49(),console.log("avc test");var col="cname5",element=$scope.form.cname5;update(col,element)},$scope.view50={editableValue:$scope.form.cwebsite5,editorEnabled:!1},$scope.enableEditor50=function(){$scope.view50.editorEnabled=!0,$scope.view50.editableValue=$scope.form.cwebsite5},$scope.disableEditor50=function(){$scope.view50.editorEnabled=!1},$scope.save50=function(){$scope.form.cwebsite5=$scope.view50.editableValue,$scope.disableEditor50(),console.log("avc test");var col="cwebsite5",element=$scope.form.cwebsite5;
update(col,element)},$scope.view51={editableValue:$scope.form.jfrom5,editorEnabled:!1},$scope.enableEditor51=function(){$scope.view51.editorEnabled=!0,$scope.view51.editableValue=$scope.form.jfrom5},$scope.disableEditor51=function(){$scope.view51.editorEnabled=!1},$scope.save51=function(){$scope.form.jfrom5=$scope.view51.editableValue,$scope.disableEditor51(),console.log("avc test");var col="jfrom5",element=$scope.form.jfrom5;element=formatdate(element),update(col,element)},$scope.view52={editableValue:$scope.form.jto5,editorEnabled:!1},$scope.enableEditor52=function(){$scope.view52.editorEnabled=!0,$scope.view52.editableValue=$scope.form.jto5},$scope.disableEditor52=function(){$scope.view52.editorEnabled=!1},$scope.save52=function(){$scope.form.jto5=$scope.view52.editableValue,$scope.disableEditor52(),console.log("avc test");var col="jto5",element=$scope.form.jto5;element=formatdate(element),update(col,element)},$scope.view53={editableValue:$scope.form.duty5,editorEnabled:!1},$scope.enableEditor53=function(){$scope.view53.editorEnabled=!0,$scope.view53.editableValue=$scope.form.duty5},$scope.disableEditor53=function(){$scope.view53.editorEnabled=!1},$scope.save53=function(){$scope.form.duty5=$scope.view53.editableValue,$scope.disableEditor53(),console.log("avc test");var col="duty5",element=$scope.form.duty5;update(col,element);var myduty5=angular.element(document.querySelector("#myduty5"));myduty5.empty(),myduty5.append($scope.form.duty5)},$scope.createpdf=function(){$http.post("/createpdf?rid="+$scope.form.r_id+"&url="+$scope.src).success(function(data){function downloadpdf(){var s=$rootScope.remoteURL+"/"+$scope.dd;$window.open(s,"_blank")}console.log(data),$scope.dd=data,$timeout(downloadpdf,7e3)})}}else console.log("Message: no resume for this customer, or there may be repeat resumes"),$scope.resumeErrorMessage="No Resume yet",$scope.hideEmptyResume=!0})}function formatdate(element){var array=element.split("-");return"01"==array[0]?element="January-"+array[1]:"02"==array[0]?element="February-"+array[1]:"03"==array[0]?element="March-"+array[1]:"04"==array[0]?element="April-"+array[1]:"05"==array[0]?element="May-"+array[1]:"06"==array[0]?element="June-"+array[1]:"07"==array[0]?element="July-"+array[1]:"08"==array[0]?element="August-"+array[1]:"09"==array[0]?element="September-"+array[1]:"10"==array[0]?element="October-"+array[1]:"11"==array[0]?element="November-"+array[1]:"12"==array[0]&&(element="December-"+array[1]),element}function update(col,element){$http.post("/updatecol?rid="+$scope.form.r_id+"&col="+col+"&element="+element).success(function(data){$scope.form.modified_date="just now",console.log("data updated")})}function findApprove(status){var defer=$q.defer();return $http.get("/findApprove?cid="+$routeParams.cid+"&status="+status).success(function(data){defer.resolve(data)}),defer.promise}function addNewLog(fieldname,value,status){var defer=$q.defer();return $http.post("/addNewLog?cid="+$routeParams.cid+"&staff="+$rootScope.name+"&staffid="+$rootScope.staffID+"&fieldname="+fieldname+"&value="+value+"&status="+status).success(function(data){defer.resolve(data)}),defer.promise}function getLog(fieldname){$http.get("/getLog?cid="+$routeParams.cid+"&fieldname="+fieldname).success(function(data){$scope.loglist=data,$scope.f=fieldname,myModal.$promise.then(myModal.show)})}function getAllPayment(){$http.get("/getpayment?cid="+$routeParams.cid).success(function(data){if(data.length>0){for($scope.list=data,$scope.allPaymentTimeline=data,0==$scope.allPaymentTimeline.length&&getAllNoteTimeline(),i=0;i<data.length;i++)"Paid"==data[i].paymentStatus?$scope.totalAmountPaid=$scope.totalAmountPaid+data[i].paymentAmount:"Next"==data[i].paymentStatus?$scope.totalAmountNext=$scope.totalAmountNext+data[i].paymentAmount:"Discount"==data[i].paymentStatus?$scope.totalAmountDiscount=$scope.totalAmountDiscount+data[i].paymentAmount:console.log("no need to count this status payment"),$scope.list[i].paymentAmount=Number(data[i].paymentAmount).toLocaleString("en");$scope.currency=data[0].Currency}else $scope.list={},$scope.totalAmountPaid=0,$scope.totalAmountNext=0,$scope.totalAmountDiscount=0;for(j=0;j<$scope.allPaymentTimeline.length;j++){"left"==$scope.position?$scope.position="right":$scope.position="left";var text=$scope.allPaymentTimeline[j].paymentAmount+" "+$scope.allPaymentTimeline[j].Currency+" with "+$scope.allPaymentTimeline[j].paymentStatus+" status.",h="New Payment Added",one={text:text,position:$scope.position,badgeClass:"danger",badgeIconClass:"glyphicon-credit-card",heading:h,staff:$scope.allPaymentTimeline[j].Staff,time:$scope.allPaymentTimeline[j].time};$scope.timelineData.push(one),j==$scope.allPaymentTimeline.length-1&&getAllNoteTimeline()}})}function getAllNoteTimeline(){$http.get("/getAllNoteTimeline?cid="+$routeParams.cid).success(function(data){for($scope.allNoteTimeline=data,0==$scope.allNoteTimeline.length&&getAllTaskTimeline(),j=0;j<$scope.allNoteTimeline.length;j++){"left"==$scope.position?$scope.position="right":$scope.position="left";var h="New Note Added",one={text:$scope.allNoteTimeline[j].text,position:$scope.position,badgeClass:"info",badgeIconClass:"glyphicon-pencil",heading:h,staff:$scope.allNoteTimeline[j].staff,time:$scope.allNoteTimeline[j].time};$scope.timelineData.push(one),j==$scope.allNoteTimeline.length-1&&getAllTaskTimeline()}})}function getAllTaskTimeline(){$http.get("/getAllTaskTimeline?cid="+$routeParams.cid).success(function(data){for($scope.allTaskTimeline=data,0==$scope.allTaskTimeline.length&&getAllApproveTimeline(),j=0;j<$scope.allTaskTimeline.length;j++){"left"==$scope.position?$scope.position="right":$scope.position="left";var text="",h=$scope.allTaskTimeline[j].taskName+" has been done",one={text:text,position:$scope.position,badgeClass:"warning",badgeIconClass:"glyphicon-tasks",heading:h,staff:$scope.allTaskTimeline[j].user,time:$scope.allTaskTimeline[j].time};$scope.timelineData.push(one),j==$scope.allTaskTimeline.length-1&&getAllApproveTimeline()}})}function getAllApproveTimeline(){$http.get("/getAllApproveTimeline?cid="+$routeParams.cid).success(function(data){for($scope.allApproveTimeline=data,j=0;j<$scope.allApproveTimeline.length;j++){"left"==$scope.position?$scope.position="right":$scope.position="left";var h=$scope.allApproveTimeline[j].field_name+" has been approved",text="",one={text:text,position:$scope.position,badgeClass:"success",badgeIconClass:"glyphicon-check",heading:h,staff:$scope.allApproveTimeline[j].staff_name,time:$scope.allApproveTimeline[j].date};$scope.timelineData.push(one)}})}function getFlightsList(){$http.get("/getFlightsList?cid="+$routeParams.cid).success(function(data){$scope.flightsList=data,0==data.length&&($scope.flightTableNodata=!0)})}function getInsuranceList(){$http.get("/getInsuranceList?cid="+$routeParams.cid).success(function(data){0==data.length&&($scope.insuranceTableNodata=!0),$scope.insuranceList=data})}function getAccommodationList(){$http.get("/getAccommodationList?cid="+$routeParams.cid).success(function(data){$scope.accommodationList=data,0==data.length&&($scope.accommodationTableNodata=!0)})}function getTransferList(){$http.get("/getTransferList?cid="+$routeParams.cid).success(function(data){$scope.transferList=data,0==data.length&&($scope.transferTableNodata=!0)})}function getAddonList(){$http.get("/getAddonList?cid="+$routeParams.cid).success(function(data){$scope.addonList=data,0==data.length&&($scope.addonTableNodata=!0)})}function getCharityList(){$http.get("/getCharityList?cid="+$routeParams.cid).success(function(data){$scope.charityList=data,0==data.length&&($scope.charityTableNodata=!0)})}function getVoucherList(){$http.get("/getVoucherList?cid="+$routeParams.cid).success(function(data){$scope.voucherList=data,0==data.length&&($scope.travelVoucherTableNodata=!0)})}function getOtherChargesList(){$http.get("/getOtherChargesList?cid="+$routeParams.cid).success(function(data){$scope.otherChargesList=data,0==data.length&&($scope.otherChargesTableNodata=!0)})}function findtrip(){$http.get("/findtrip?cid="+$routeParams.cid).success(function(data){$scope.tripList=data,0==data.length&&($scope.tripTableNodata=!0)})}function saveFileurl(filename){$http.post("/saveFileurl?filename="+filename+"&cid="+$routeParams.cid+"&attachedBy="+$rootScope.name).success(function(data){console.log(data),uploadFilesTPL.hide(),findFileRecords()})}function findFileRecords(){$http.get("/findFileRecords?cid="+$routeParams.cid).success(function(data){$scope.fileRecords=data})}if($scope.c=$routeParams.cid,$scope.showComplianceSection=!1,$scope.changingFieldArray=[],$scope.changingFinalData=[],$scope.timelineData=[],$scope.position="left",$rootScope.complianceActive){var personalClassContent=angular.element(document.querySelector("#personalClass"));personalClassContent.removeClass("active");var personaldetailsContent=angular.element(document.querySelector("#personal-details"));personaldetailsContent.removeClass("active");var complianceClassContent=angular.element(document.querySelector("#complianceClass"));complianceClassContent.addClass("active");var complianceContent=angular.element(document.querySelector("#compliance"));complianceContent.addClass("active")}("superadmin"==$rootScope.staffRole||"compliance"==$rootScope.staffRole)&&(console.log("congrats, you have the compliance permission"),$scope.showComplianceSection=!0);var editingProfileButtonsTPL=$aside({scope:$scope,template:"../bookings/editingProfileButtonsTPL.html",show:!1,placement:"right",backdrop:!1,animation:"am-slide-bottom"}),approveRedFlagsTpl=$aside({scope:$scope,template:"../bookings/approveRedFlagsTPL.html",show:!1,placement:"right",backdrop:!1,animation:"am-slide-bottom"}),invoiceTPL=$aside({scope:$scope,template:"../bookings/invoiceTPL.html",show:!1,placement:"right",backdrop:!1,animation:"am-slide-bottom"}),addFlightTPL=$aside({scope:$scope,template:"../bookings/addFlightTPL.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-bottom"}),addInsuranceTPL=$aside({scope:$scope,template:"../bookings/addInsuranceTPL.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-bottom"}),addAccommodationTPL=$aside({scope:$scope,template:"../bookings/addAccommodationTPL.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-bottom"}),addTransferTPL=$aside({scope:$scope,template:"../bookings/addTransferTPL.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-bottom"}),addAddonTPL=$aside({scope:$scope,template:"../bookings/addAddonTPL.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-bottom"}),addCharityTPL=$aside({scope:$scope,template:"../bookings/addCharityTPL.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-bottom"}),addVoucherTPL=$aside({scope:$scope,template:"../bookings/addVoucherTPL.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-bottom"}),addOtherChargesTPL=$aside({scope:$scope,template:"../bookings/addOtherChargesTPL.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-bottom"}),addNewTripTPL=$aside({scope:$scope,template:"../bookings/tpl/addNewTripTPL.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-bottom"}),editTripTPL=$aside({scope:$scope,template:"../bookings/tpl/editTripTPL.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-bottom"});$scope.tripTableNodata=!1,$scope.flightTableNodata=!1,$scope.insuranceTableNodata=!1,$scope.accommodationTableNodata=!1,$scope.transferTableNodata=!1,$scope.addonTableNodata=!1,$scope.charityTableNodata=!1,$scope.travelVoucherTableNodata=!1,$scope.otherChargesTableNodata=!1,findFileRecords(),findprofile(),findtravel(),checkMarketingCID(),$scope.status="Nothing";var AllocateCoordinatorTpl=$aside({scope:$scope,template:"../bookings/allocateCoordinatorTPL.html",show:!1,placement:"right",backdrop:!1,animation:"am-slide-right"});getAllCoordinators(),$scope.createCustomerpdf=function(){$http.get("/createCustomerpdf?cid="+$routeParams.cid).success(function(data){function downloadpdf(){var s=$rootScope.remoteURL+"//"+$scope.dd;$window.open(s,"_blank")}console.log(data),$scope.dd=data,$timeout(downloadpdf,7e3)})},$scope.showNotes=function(){NotesPageTpl.show(),$scope.saveNote=function(newNote){""!=newNote&&(console.log("test note",newNote),$http.post("/saveNewNote?cid="+$routeParams.cid+"&note="+newNote+"&staff="+$scope.staffName).success(function(data){console.log("success add one note",data);var aNote={time:"just now",staff:$scope.staffName,text:newNote};$scope.notesList.push(aNote),NotesPageTpl.toggle(),NotesPageTpl.toggle()}))}},getAllNotes();var NotesPageTpl=$aside({scope:$scope,template:"../bookings/notesTPL.html",show:!1,placement:"right",backdrop:!1,animation:"am-slide-right"});$scope.data2={availableOptions:[{id:"Paid",name:"Paid"},{id:"Next",name:"Next"},{id:"Error",name:"Error"},{id:"Refund",name:"Refund"},{id:"Discount",name:"Discount"},{id:"On Hold",name:"On Hold"}],selectedOption:{id:"Paid",name:"Paid"}},$scope.data3={availableOptions:[{id:"GBP",name:"GBP"},{id:"USD",name:"USD"},{id:"AUD",name:"AUD"},{id:"CAD",name:"CAD"}],selectedOption:{id:"AUD",name:"AUD"}},$scope.data4={availableOptions:[{id:"Week",name:"Week"},{id:"Month",name:"Month"}],selectedOption:{id:"Week",name:"Week"}},checkOffice(),$scope.addPay=function(){addPaymentTpl.show()};var addPaymentTpl=$aside({scope:$scope,template:"../bookings/addPaymentTpl.html",show:!1,placement:"right",backdrop:!1,animation:"am-slide-right"});$scope.todoList=[],$scope.dis=!1,$scope.repeatCheck="NO",$scope.isDisabled=!0,$scope.myFunction=function(repeatCheck){"YES"==repeatCheck?$scope.isDisabled=!1:$scope.isDisabled=!0},$scope.todoAdd=function(){$scope.dis=!0,$scope.todoList.push({done:!1})},$scope.remove=function(index){$scope.todoList.splice(index,1),0==$scope.todoList.length&&($scope.dis=!1)},$scope.addpayment=function(paymentDate,paymentAmount,repeatCheck,repeatPeriod,repeatTime){console.log("testttttt",$scope.selectedState);var customerName2=$scope.profile.first_name+", "+$scope.profile.last_name,paymentStatus=$scope.data2.selectedOption.name,currency=$scope.data3.selectedOption.name;console.log("1",paymentDate),"NO"==repeatCheck?$http.post("/addPayment?customerName2="+customerName2+"&paymentStatus="+paymentStatus+"&paymentAmount="+paymentAmount+"&paymentDate="+paymentDate+"&currency="+currency+"&cid="+$routeParams.cid+"&staffname="+$rootScope.name).success(function(data2){if($scope.todoList.length>0)for(console.log("ok, here is the list"),i=0;i<$scope.todoList.length;i++)addtodopayments(i,$routeParams.cid),console.log(i);else addPaymentTpl.toggle(),$rootScope.startAlert("success","Success","Well done! You successfully submit new payment form.","md md-done")}):repeatTime&&repeatPeriod?"Week"==$scope.data4.selectedOption.name?$http.post("/addPaymentRepeatweek?customerName2="+customerName2+"&paymentStatus="+paymentStatus+"&paymentAmount="+paymentAmount+"&paymentDate="+paymentDate+"&currency="+currency+"&cid="+$routeParams.cid+"&staffname="+$rootScope.name+"&period="+repeatPeriod+"&times="+repeatTime).success(function(data){addPaymentTpl.toggle(),$rootScope.startAlert("success","Success","Well done! You successfully submit MULTIPLE new payments.","md md-done")}):"Month"==$scope.data4.selectedOption.name&&$http.post("/addPaymentRepeatmonth?customerName2="+customerName2+"&paymentStatus="+paymentStatus+"&paymentAmount="+paymentAmount+"&paymentDate="+paymentDate+"&currency="+currency+"&cid="+$routeParams.cid+"&staffname="+$rootScope.name+"&period="+repeatPeriod+"&times="+repeatTime).success(function(data){addPaymentTpl.toggle(),$rootScope.startAlert("success","Success","Well done! You successfully submit MULTIPLE new payments monthly.","md md-done")}):(console.log("another test ok?????"),addPaymentTpl.toggle(),$rootScope.startAlert("danger","Error","Well, you must enter the repeat times and period","md md-error"))};var addComplianceTPL=$aside({scope:$scope,template:"../bookings/addComplianceTPL.html",show:!1,placement:"right",backdrop:!1,animation:"am-slide-right"});$scope.addCompliance=function(){addComplianceTPL.show()},$scope.formData={},$scope.submitCompliance=function(formData){function addcompliance(){$http.post("/addcompliance?introCheckA="+formData.introCheckA+"&introCommentsA="+formData.introCommentsA+"&introCheckB="+formData.introCheckB+"&introCommentsB="+formData.introCommentsB+"&qualificationCheckA="+formData.qualificationCheckA+"&qualificationCommentsA="+formData.qualificationCommentsA+"&qualificationCheckB="+formData.qualificationCheckB+"&qualificationCommentsB="+formData.qualificationCommentsB+"&qualificationCheckC="+formData.qualificationCheckC+"&qualificationCommentsC="+formData.qualificationCommentsC+"&qualificationCheckD="+formData.qualificationCheckD+"&qualificationCommentsD="+formData.qualificationCommentsD+"&qualificationCheckE="+formData.qualificationCheckE+"&qualificationCommentsE="+formData.qualificationCommentsE+"&backgroundCheckA="+formData.backgroundCheckA+"&backgroundCommentsA="+formData.backgroundCommentsA+"&selectionCheckA="+formData.selectionCheckA+"&selectionCommentsA="+formData.selectionCommentsA+"&selectionCheckB="+formData.selectionCheckB+"&selectionCommentsB="+formData.selectionCommentsB+"&selectionCheckC="+formData.selectionCheckC+"&selectionCommentsC="+formData.selectionCommentsC+"&selectionCheckD="+formData.selectionCheckD+"&selectionCommentsD="+formData.selectionCommentsD+"&selectionCheckE="+formData.selectionCheckE+"&selectionCommentsE="+formData.selectionCommentsE+"&selectionCheckF="+formData.selectionCheckF+"&selectionCommentsF="+formData.selectionCommentsF+"&selectionCheckG="+formData.selectionCheckG+"&selectionCommentsG="+$scope.selectionCommentsG+"&costCheckA="+$scope.costCheckA+"&costCommentsA="+formData.costCommentsA+"&costCheckB="+formData.costCheckB+"&costCommentsB="+formData.costCommentsB+"&costCheckC="+formData.costCheckC+"&costCommentsC="+formData.costCommentsC+"&costCheckD="+formData.costCheckD+"&costCommentsD="+formData.costCommentsD+"&costCheckE="+formData.costCheckE+"&costCommentsE="+formData.costCommentsE+"&costCheckF="+formData.costCheckF+"&costCommentsF="+formData.costCommentsF+"&costCheckG="+formData.costCheckG+"&costCommentsG="+formData.costCommentsG+"&urgencyCheckA="+formData.urgencyCheckA+"&urgencyCommentsA="+formData.urgencyCommentsA+"&urgencyCheckB="+formData.urgencyCheckB+"&urgencyCommentsB="+formData.urgencyCommentsB+"&urgencyCheckC="+formData.urgencyCheckC+"&urgencyCommentsC="+formData.urgencyCommentsC+"&urgencyCheckD="+formData.urgencyCheckD+"&urgencyCommentsD="+formData.urgencyCommentsD+"&urgencyCheckE="+formData.urgencyCheckE+"&urgencyCommentsE="+formData.urgencyCommentsE+"&othersCheckA="+formData.othersCheckA+"&othersCommentsA="+formData.othersCommentsA+"&othersCheckB="+formData.othersCheckB+"&othersCommentsB="+formData.othersCommentsB+"&othersCheckC="+formData.othersCheckC+"&othersCommentsC="+formData.othersCommentsC+"&othersCheckD="+formData.othersCheckD+"&othersCommentsD="+formData.othersCommentsD+"&othersCheckE="+formData.othersCheckE+"&othersCommentsE="+formData.othersCommentsE+"&othersCheckF="+formData.othersCheckF+"&othersCommentsF="+formData.othersCommentsF+"&cid="+$routeParams.cid+"&yellowflag="+$scope.yellowflag+"&redflag="+$scope.redflag+"&staff="+$rootScope.name).success(function(data){$rootScope.startAlert("success","Success","Well done! You have successfully submitted a new compliance form.","md md-done"),addComplianceTPL.toggle()})}console.log("ha ha ha",formData),formData.introCheckA&&formData.introCheckB&&formData.qualificationCheckA&&formData.qualificationCheckB&&formData.qualificationCheckC&&formData.qualificationCheckD&&formData.qualificationCheckE&&formData.backgroundCheckA&&formData.selectionCheckA&&formData.selectionCheckB&&formData.selectionCheckC&&formData.selectionCheckD&&formData.selectionCheckE&&formData.selectionCheckF&&formData.selectionCheckG&&formData.costCheckA&&formData.costCheckB&&formData.costCheckC&&formData.costCheckD&&formData.costCheckE&&formData.costCheckF&&formData.costCheckG&&formData.urgencyCheckA&&formData.urgencyCheckB&&formData.urgencyCheckC&&formData.urgencyCheckD&&formData.urgencyCheckE&&formData.othersCheckA&&formData.othersCheckB&&formData.othersCheckC&&formData.othersCheckD&&formData.othersCheckE&&formData.othersCheckF?($scope.redflag=0,$scope.yellowflag=0,"no"==formData.introCheckB&&($scope.yellowflag=$scope.yellowflag+1),"no"==formData.qualificationCheckC&&($scope.yellowflag=$scope.yellowflag+1),"no"==formData.qualificationCheckD&&($scope.yellowflag=$scope.yellowflag+1),"yes"==formData.selectionCheckC&&($scope.redflag=$scope.redflag+1),"yes"==formData.selectionCheckD&&($scope.redflag=$scope.redflag+1),"yes"==formData.selectionCheckE&&($scope.redflag=$scope.redflag+1),"yes"==formData.selectionCheckF&&($scope.redflag=$scope.redflag+1),"yes"==formData.selectionCheckG&&($scope.redflag=$scope.redflag+1),"no"==formData.costCheckC&&($scope.redflag=$scope.redflag+1),"no"==formData.costCheckD&&($scope.redflag=$scope.redflag+1),"yes"==formData.costCheckE&&($scope.redflag=$scope.redflag+1),"yes"==formData.costCheckG&&($scope.redflag=$scope.redflag+1),"yes"==formData.urgencyCheckA&&($scope.yellowflag=$scope.yellowflag+1),"yes"==formData.urgencyCheckB&&($scope.yellowflag=$scope.yellowflag+1),"yes"==formData.urgencyCheckC&&($scope.yellowflag=$scope.yellowflag+1),"yes"==formData.urgencyCheckE&&($scope.redflag=$scope.redflag+1),addcompliance()):($rootScope.startAlert("danger","Error","Please fullfill every question","md md-error"),addComplianceTPL.toggle())},getComplianceList();var ComplianceDetailsTPL=$aside({scope:$scope,template:"../bookings/ComplianceDetailsTPL.html",show:!1,placement:"right",backdrop:!1,animation:"am-slide-right"});$scope.showComplianceDetails=function(qid){$scope.qidNow=qid,ComplianceDetailsTPL.show(),getComplianceDetails()},$scope.downloadBookingPDF=function(){var pp="http://globalworkandtravel.com/book/upload/"+$scope.profile.first_name+"-"+$scope.profile.last_name+"-"+$routeParams.cid+".pdf";$window.open(pp,"_blank")};var myModal=$modal({scope:$scope,template:"modal.html",show:!1});$scope.showModal=function(fieldname){getLog(fieldname)},$scope.totalAmountPaid=0,$scope.totalAmountNext=0,$scope.totalAmountDiscount=0,getAllPayment(),$scope.invoice=function(){invoiceTPL.show()},$scope.data10={availableOptions:[{id:"Paid",name:"Paid"},{id:"Pending",name:"Pending"},{id:"Cancelled",name:"Cancelled"}],selectedOption:{id:"Paid",name:"Paid"}},$scope.flightairline={availableOptions:[{id:"airline1",name:"airline1"},{id:"airline2",name:"airline2"},{id:"airline3",name:"airline3"}],selectedOption:{id:"airline1",name:"airline1"}},$scope.flightclass={availableOptions:[{id:"classA",name:"classA"},{id:"classB",name:"classB"},{id:"classC",name:"classC"}],selectedOption:{id:"classA",name:"classA"}},$scope.otherChargesItem={availableOptions:[{id:"item1",name:"item1"},{id:"item2",name:"item2"},{id:"item3",name:"item3"}],selectedOption:{id:"item1",name:"item1"}},$scope.insuranceCompany={availableOptions:[{id:"company1",name:"company1"},{id:"company2",name:"company2"},{id:"company3",name:"company3"}],selectedOption:{id:"company1",name:"company1"}},$scope.insurancePlan={availableOptions:[{id:"plan1",name:"plan1"},{id:"plan2",name:"plan2"},{id:"plan3",name:"plan3"}],selectedOption:{id:"plan1",name:"plan1"}},$scope.addFlights=function(){addAccommodationTPL.hide(),addInsuranceTPL.hide(),addTransferTPL.hide(),addAddonTPL.hide(),addCharityTPL.hide(),addVoucherTPL.hide(),addOtherChargesTPL.hide(),addFlightTPL.show()},$scope.addInsurance=function(){addAccommodationTPL.hide(),addFlightTPL.hide(),addTransferTPL.hide(),addAddonTPL.hide(),addCharityTPL.hide(),addVoucherTPL.hide(),addOtherChargesTPL.hide(),addInsuranceTPL.show()},$scope.addAccommodation=function(){addInsuranceTPL.hide(),addFlightTPL.hide(),addTransferTPL.hide(),addAddonTPL.hide(),addCharityTPL.hide(),addVoucherTPL.hide(),addOtherChargesTPL.hide(),addAccommodationTPL.show()},$scope.addTransfer=function(){addInsuranceTPL.hide(),addFlightTPL.hide(),addAccommodationTPL.hide(),addAddonTPL.hide(),addCharityTPL.hide(),addVoucherTPL.hide(),addOtherChargesTPL.hide(),addTransferTPL.show()},$scope.addAddon=function(){addInsuranceTPL.hide(),addFlightTPL.hide(),addAccommodationTPL.hide(),addTransferTPL.hide(),addCharityTPL.hide(),addVoucherTPL.hide(),addOtherChargesTPL.hide(),addAddonTPL.show()},$scope.addCharity=function(){addInsuranceTPL.hide(),addFlightTPL.hide(),addAccommodationTPL.hide(),addTransferTPL.hide(),addAddonTPL.hide(),addVoucherTPL.hide(),addOtherChargesTPL.hide(),addCharityTPL.show()},$scope.addVoucher=function(){addInsuranceTPL.hide(),addFlightTPL.hide(),addAccommodationTPL.hide(),addTransferTPL.hide(),addAddonTPL.hide(),addCharityTPL.hide(),addOtherChargesTPL.hide(),addVoucherTPL.show()},$scope.addOtherCharges=function(){addInsuranceTPL.hide(),addFlightTPL.hide(),addAccommodationTPL.hide(),addTransferTPL.hide(),addAddonTPL.hide(),addCharityTPL.hide(),addVoucherTPL.hide(),addOtherChargesTPL.show()},$scope.flightStatus="inactive",$scope.flightRTN="return",$scope.saveFlightDetail=function(flightdate,flightQuotedAmount,flightTaxAmount,flightDepartureCity,flightArrivalCity,flightRTN,flightStatus,flightComments){$http.post("/saveFlightDetail?cid="+$routeParams.cid+"&flightdate="+flightdate+"&flightairline="+$scope.flightairline.selectedOption.name+"&flightclass="+$scope.flightclass.selectedOption.name+"&flightQuotedAmount="+flightQuotedAmount+"&flightTaxAmount="+flightTaxAmount+"&flightDepartureCity="+flightDepartureCity+"&flightArrivalCity="+flightArrivalCity+"&flightRTN="+flightRTN+"&flightStatus="+flightStatus+"&flightComments="+flightComments).success(function(data){$scope.flightTableNodata=!1,addFlightTPL.hide();var newFlight={flight_airline:$scope.flightairline.selectedOption.name,flight_booking_class:$scope.flightclass.selectedOption.name,flight_tentative_departure_date:flightdate,flight_quoted_airfare_amount:flightQuotedAmount,flight_taxes_amount:flightTaxAmount,flight_departure_city:flightDepartureCity,flight_arrival_city:flightArrivalCity,flight_rtnow:flightRTN,flight_comments:flightComments,flight_status:flightStatus};$scope.flightsList.push(newFlight)})},$scope.insuranceData={},$scope.insuranceData.excess="no",$scope.insuranceData.status="inactive",$scope.saveInsuranceDetail=function(insuranceData){$http.post("/saveInsuranceDetail?cid="+$routeParams.cid+"&company="+$scope.insuranceCompany.selectedOption.name+"&from="+insuranceData.from+"&to="+insuranceData.to+"&plan="+$scope.insurancePlan.selectedOption.name+"&excess="+insuranceData.excess+"&amount="+insuranceData.amount+"&comments="+insuranceData.comments+"&status="+insuranceData.status).success(function(data){addInsuranceTPL.hide(),$scope.insuranceData={},$scope.insuranceData.excess="no",$scope.insuranceData.status="inactive",$scope.insuranceTableNodata=!1;var newInsurance={insurance_company:$scope.insuranceCompany.selectedOption.name,insurance_from:insuranceData.from,insurance_to:insuranceData.to,insurance_plan:$scope.insurancePlan.selectedOption.name,insurance_excess:insuranceData.excess,insurance_amount:insuranceData.amount,insurance_comments:insuranceData.comments,insurance_status:insuranceData.status};$scope.insuranceList.push(newInsurance)})},$scope.hideInsuranceTPL=function(){addInsuranceTPL.hide(),$scope.insuranceData={},$scope.insuranceData.excess="no",$scope.insuranceData.status="inactive"},$scope.accommodationData={},$scope.accommodationData.transfer="no",$scope.accommodationData.status="inactive",$scope.saveAccommodationDetail=function(accommodationData){$http.post("/saveAccommodationDetail?cid="+$routeParams.cid+"&from="+accommodationData.from+"&to="+accommodationData.to+"&transfer="+accommodationData.transfer+"&comments="+accommodationData.comments+"&detail="+accommodationData.detail+"&amount="+accommodationData.amount+"&status="+accommodationData.status).success(function(data){addAccommodationTPL.hide(),$scope.accommodationData={},$scope.accommodationData.transfer="no",$scope.accommodationData.status="inactive",$scope.accommodationTableNodata=!1;var newAccommodation={accommodation_from:accommodationData.from,accommodation_to:accommodationData.to,accommodation_transfer:accommodationData.transfer,accommodation_comments:accommodationData.comments,additional_accommodation:accommodationData.detail,accommodation_amount:accommodationData.amount,accommodation_status:accommodationData.status};$scope.accommodationList.push(newAccommodation)})},$scope.hideAccommodationTPL=function(){addAccommodationTPL.hide(),$scope.accommodationData={},$scope.accommodationData.transfer="no",$scope.accommodationData.status="inactive"},$scope.transferData={},$scope.transferData.returnow="return",$scope.transferData.status="inactive",$scope.saveTransferDetail=function(transferData){$http.post("/saveTransferDetail?cid="+$routeParams.cid+"&detail="+transferData.detail+"&amount="+transferData.amount+"&from="+transferData.from+"&to="+transferData.to+"&returnow="+transferData.rtnow+"&comments="+transferData.comments+"&status="+transferData.status).success(function(data){addTransferTPL.hide(),$scope.transferData={},$scope.transferData.returnow="return",$scope.transferData.status="inactive",$scope.transferTableNodata=!1;var newTransfer={additional_transfer:transferData.detail,transfer_amount:transferData.amount,transfer_from:transferData.from,transfer_to:transferData.to,transfer_returnow:transferData.rtnow,transfer_comments:transferData.comments,transfer_status:transferData.status};$scope.transferList.push(newTransfer)})},$scope.hideTransferTPL=function(){addTransferTPL.hide(),$scope.transferData={},$scope.transferData.returnow="return",$scope.transferData.status="inactive"},$scope.addonData={},$scope.addonData.status="inactive",$scope.saveAddonDetail=function(addonData){$http.post("/saveAddonDetail?cid="+$routeParams.cid+"&supplier="+addonData.supplier+"&grossAmount="+addonData.grossAmount+"&tour="+addonData.tourName+"&nettAmount="+addonData.nettAmount+"&from="+addonData.from+"&to="+addonData.to+"&comments="+addonData.comments+"&status="+addonData.status).success(function(data){addAddonTPL.hide(),$scope.addonData={},$scope.addonData.status="inactive",$scope.addonTableNodata=!1;var newAddon={addon_supplier:addonData.supplier,addon_gross_amount:addonData.grossAmount,addon_tour_name:addonData.tourName,addon_nett_amount:addonData.nettAmount,addon_from:addonData.from,addon_to:addonData.to,addon_comments:addonData.comments,addon_status:addonData.status};$scope.addonList.push(newAddon)})},$scope.hideAddonTPL=function(){addAddonTPL.hide(),$scope.addonData={},$scope.addonData.status="inactive"},$scope.charityData={},$scope.charityData.status="inactive",$scope.saveCharityDetail=function(charityData){$http.post("/saveCharityDetail?cid="+$routeParams.cid+"&foundation="+charityData.foundation+"&amount="+charityData.amount+"&comments="+charityData.comments+"&status="+charityData.status).success(function(data){addCharityTPL.hide(),$scope.charityData={},$scope.charityData.status="inactive",$scope.charityTableNodata=!1;var newCharity={charity_global_foundation:charityData.foundation,charity_amount:charityData.amount,charity_comments:charityData.comments,charity_status:charityData.status};$scope.charityList.push(newCharity)})},$scope.hideCharityTPL=function(){addCharityTPL.hide(),$scope.charityData={},$scope.charityData.status="inactive"},$scope.voucherData={},$scope.voucherData.status="inactive",$scope.saveVoucherDetail=function(voucherData){$http.post("/saveVoucherDetail?cid="+$routeParams.cid+"&detail="+voucherData.detail+"&amount="+voucherData.amount+"&comments="+voucherData.comments+"&status="+voucherData.status).success(function(data){addVoucherTPL.hide(),$scope.voucherData={},$scope.voucherData.status="inactive",$scope.travelVoucherTableNodata=!1;var newVoucher={travel_credit_voucher:voucherData.detail,travel_voucher_amount:voucherData.amount,travel_voucher_comments:voucherData.comments,travel_voucher_status:voucherData.status};$scope.voucherList.push(newVoucher);
})},$scope.hideVoucherTPL=function(){addVoucherTPL.hide(),$scope.voucherData={},$scope.voucherData.status="inactive"},$scope.otherChargesData={},$scope.otherChargesData.status="inactive",$scope.saveOtherChargesDetail=function(otherChargesData){$http.post("/saveOtherChargesDetail?cid="+$routeParams.cid+"&item="+$scope.otherChargesItem.selectedOption.name+"&amount="+otherChargesData.amount+"&comments="+otherChargesData.comments+"&status="+otherChargesData.status).success(function(data){addOtherChargesTPL.hide(),$scope.otherChargesData={},$scope.otherChargesData.status="inactive",$scope.otherChargesTableNodata=!1;var newOtherCharge={other_charges_item:$scope.otherChargesItem.selectedOption.name,other_charges_amount:otherChargesData.amount,other_charges_comments:otherChargesData.comments,other_charges_status:otherChargesData.status};$scope.otherChargesList.push(newOtherCharge)})},$scope.hideOtherChargesTPL=function(){addOtherChargesTPL.hide(),$scope.otherChargesData={},$scope.otherChargesData.status="inactive"};var editFlightTPL=$aside({scope:$scope,template:"../bookings/editFlightTPL.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-bottom"});$scope.editFlight=function(f){editFlightTPL.show(),$scope.f=f,$scope.f.flight_quoted_airfare_amount=parseInt(f.flight_quoted_airfare_amount),$scope.f.flight_taxes_amount=parseInt(f.flight_taxes_amount),$scope.flightairline.selectedOption.id=f.flight_airline,$scope.flightairline.selectedOption.name=f.flight_airline,$scope.flightclass.selectedOption.id=f.flight_booking_class,$scope.flightclass.selectedOption.name=f.flight_booking_class},$scope.updateFlightDetail=function(f){$http.post("/editFlightDetail?fid="+f.flight_id+"&flightdate="+f.flight_tentative_departure_date+"&flightairline="+$scope.flightairline.selectedOption.name+"&flightclass="+$scope.flightclass.selectedOption.name+"&flightQuotedAmount="+f.flight_quoted_airfare_amount+"&flightTaxAmount="+f.flight_taxes_amount+"&flightDepartureCity="+f.flight_departure_city+"&flightArrivalCity="+f.flight_arrival_city+"&flightRTN="+f.flight_rtnow+"&flightStatus="+f.flight_status+"&flightComments="+f.flight_comments).success(function(data){editFlightTPL.hide(),getFlightsList()})},$scope.hideEditFlightTPL=function(){editFlightTPL.hide(),getFlightsList()};var editInsuranceTPL=$aside({scope:$scope,template:"../bookings/editInsuranceTPL.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-bottom"});$scope.editInsurance=function(i){editInsuranceTPL.show(),$scope.i=i,$scope.i.insurance_amount=parseInt(i.insurance_amount),$scope.insuranceCompany.selectedOption.id=i.insurance_company,$scope.insuranceCompany.selectedOption.name=i.surance_company,$scope.insurancePlan.selectedOption.id=i.insurance_plan,$scope.insurancePlan.selectedOption.name=i.insurance_plan},$scope.updateInsuranceDetail=function(i){$http.post("/updateInsuranceDetail?insuranceid="+i.insurance_id+"&company="+$scope.insuranceCompany.selectedOption.name+"&from="+i.insurance_from+"&to="+i.insurance_to+"&plan="+$scope.insurancePlan.selectedOption.name+"&excess="+i.insurance_excess+"&amount="+i.insurance_amount+"&comments="+i.insurance_comments+"&status="+i.insurance_status).success(function(data){editInsuranceTPL.hide(),getInsuranceList()})},$scope.hideEditInsuranceTPL=function(){editInsuranceTPL.hide(),getInsuranceList()};var editAccommodationTPL=$aside({scope:$scope,template:"../bookings/editAccommodationTPL.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-bottom"});$scope.editAccommodation=function(a){editAccommodationTPL.show(),$scope.a=a,$scope.a.accommodation_amount=parseInt(a.accommodation_amount)},$scope.hideEditAccommodationTPL=function(){editAccommodationTPL.hide(),getAccommodationList()},$scope.updateAccommodationDetail=function(a){$http.post("/updateAccommodationDetail?accommodationid="+a.accommodation_id+"&from="+a.accommodation_from+"&to="+a.accommodation_to+"&transfer="+a.accommodation_transfer+"&comments="+a.accommodation_comments+"&detail="+a.additional_accommodation+"&amount="+a.accommodation_amount+"&status="+a.accommodation_status).success(function(data){editAccommodationTPL.hide(),getAccommodationList()})};var editTransferTPL=$aside({scope:$scope,template:"../bookings/editTransferTPL.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-bottom"});$scope.editTransfer=function(t){editTransferTPL.show(),$scope.tEdit=t,$scope.tEdit.transfer_amount=parseInt(t.transfer_amount)},$scope.hideEditTransferTPL=function(){editTransferTPL.hide(),getTransferList()},$scope.updateTransferDetail=function(tEdit){$http.post("/updateTransferDetail?transferid="+tEdit.transfer_id+"&detail="+tEdit.additional_transfer+"&amount="+tEdit.transfer_amount+"&from="+tEdit.transfer_from+"&to="+tEdit.transfer_to+"&returnow="+tEdit.transfer_returnow+"&comments="+tEdit.transfer_comments+"&status="+tEdit.transfer_status).success(function(data){editTransferTPL.hide(),getTransferList()})};var editAddonTPL=$aside({scope:$scope,template:"../bookings/editAddonTPL.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-bottom"});$scope.editAddon=function(a){editAddonTPL.show(),$scope.aEdit=a,$scope.aEdit.addon_gross_amount=parseInt(a.addon_gross_amount),$scope.aEdit.addon_nett_amount=parseInt(a.addon_nett_amount)},$scope.hideEditAddonTPL=function(){editAddonTPL.hide(),getAddonList()},$scope.updateAddonDetail=function(aEdit){$http.post("/updateAddonDetail?addonid="+aEdit.addon_id+"&supplier="+aEdit.addon_supplier+"&grossamount="+aEdit.addon_gross_amount+"&tour="+aEdit.addon_tour_name+"&nettamount="+aEdit.addon_nett_amount+"&from="+aEdit.addon_from+"&to="+aEdit.addon_to+"&comments="+aEdit.addon_comments+"&status="+aEdit.addon_status).success(function(data){editAddonTPL.hide(),getAddonList()})};var editCharityTPL=$aside({scope:$scope,template:"../bookings/editCharityTPL.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-bottom"});$scope.editCharity=function(c){editCharityTPL.show(),$scope.cEdit=c,$scope.cEdit.charity_amount=parseInt(c.charity_amount)},$scope.hideEditCharityTPL=function(){editCharityTPL.hide(),getCharityList()},$scope.updateCharityDetail=function(cEdit){$http.post("/updateCharityDetail?charityid="+cEdit.charity_id+"&foundation="+cEdit.charity_global_foundation+"&amount="+cEdit.charity_amount+"&comments="+cEdit.charity_comments+"&status="+cEdit.charity_status).success(function(data){editCharityTPL.hide(),getCharityList()})};var editVoucherTPL=$aside({scope:$scope,template:"../bookings/editVoucherTPL.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-bottom"});$scope.editVoucher=function(v){editVoucherTPL.show(),$scope.vEdit=v,$scope.vEdit.travel_voucher_amount=parseInt(v.travel_voucher_amount)},$scope.hideEditVoucherTPL=function(){editVoucherTPL.hide(),getVoucherList()},$scope.updateVoucherDetail=function(vEdit){$http.post("/updateVoucherDetail?voucherid="+vEdit.travel_voucher_id+"&detail="+vEdit.travel_credit_voucher+"&amount="+vEdit.travel_voucher_amount+"&comments="+vEdit.travel_voucher_comments+"&status="+vEdit.travel_voucher_status).success(function(data){editVoucherTPL.hide(),getVoucherList()})};var editOtherTPL=$aside({scope:$scope,template:"../bookings/editOtherTPL.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-bottom"});$scope.editOther=function(oo){editOtherTPL.show(),$scope.ooEdit=oo,$scope.ooEdit.other_charges_amount=parseInt(oo.other_charges_amount),$scope.otherChargesItem.selectedOption.name=oo.other_charges_item,$scope.otherChargesItem.selectedOption.id=oo.other_charges_item},$scope.hideEditOtherChargesTPL=function(){editOtherTPL.hide(),getOtherChargesList()},$scope.updateOtherChargesDetail=function(ooEdit){$http.post("/updateOtherChargesDetail?otherchargesid="+ooEdit.other_charges_id+"&item="+$scope.otherChargesItem.selectedOption.name+"&amount="+ooEdit.other_charges_amount+"&comments="+ooEdit.other_charges_comments+"&status="+ooEdit.other_charges_status).success(function(data){editOtherTPL.hide(),getOtherChargesList()})},$scope.tripExperienceList={availableOptions:[{id:"Working Holiday",name:"Working Holiday"},{id:"Volunteer",name:"Volunteer"},{id:"Au Pair",name:"Au Pair"},{id:"Teach",name:"Teach"},{id:"Internship",name:"Internship"}],selectedOption:{id:"Working Holiday",name:"Working Holiday"}},$scope.tripExperience={availableOptions:[{id:"Working Holiday",name:"Working Holiday"},{id:"Volunteer",name:"Volunteer"},{id:"Au Pair",name:"Au Pair"},{id:"Teach",name:"Teach"},{id:"Internship",name:"Internship"}],selectedOption:{id:"Working Holiday",name:"Working Holiday"}},$scope.tripStatusList={availableOptions:[{id:"Pending",name:"Pending"},{id:"New File",name:"New File"},{id:"In Progress",name:"In Progress"},{id:"On Hold",name:"On Hold"},{id:"Cancelled",name:"Cancelled"},{id:"Refunded",name:"Refunded"},{id:"Legal",name:"Legal"},{id:"Departed",name:"Departed"},{id:"Rejected",name:"Rejected"}],selectedOption:{id:"Pending",name:"Pending"}},findtrip(),$scope.addNewTrip=function(){addNewTripTPL.show()},$scope.saveNewTrip=function(tripDestination,tripCode,tripDuration,tripPrice){$http.post("/saveNewTrip?tripDestination="+tripDestination+"&tripCode="+tripCode+"&tripDuration="+tripDuration+"&tripPrice="+tripPrice+"&cid="+$routeParams.cid+"&tripExperienceName="+$scope.tripExperienceList.selectedOption.id+"&tripStatus="+$scope.tripStatusList.selectedOption.id).success(function(data){addNewTripTPL.hide(),findtrip(),$scope.tripTableNodata=!1})},$scope.editTrip=function(tl){editTripTPL.show(),$scope.tl=tl,$scope.tripExperience.selectedOption.id=$scope.tl.trip_experience_name,$scope.tripExperience.selectedOption.name=$scope.tl.trip_experience_name,$scope.tripStatusList.selectedOption.id=$scope.tl.trip_status,$scope.tripStatusList.selectedOption.name=$scope.tl.trip_status},$scope.updateTripDetail=function(tl){console.log("test tl here",tl),$http.post("/updateTripDetail?tripDestination="+tl.trip_destination+"&tripCode="+tl.trip_code+"&tripDuration="+tl.trip_duration+"&tripPrice="+tl.trip_price+"&tid="+tl.trip_id+"&tripExperienceName="+$scope.tripExperience.selectedOption.id+"&tripStatus="+$scope.tripStatusList.selectedOption.id).success(function(data){editTripTPL.hide(),findtrip()})},$scope.hideEditTripDetailTPL=function(){editTripTPL.hide(),findtrip()},$scope.openTravelProfile=function(){$window.open("http://globalworkandtravel.com/travel","_blank")};var uploadFilesTPL=$aside({scope:$scope,template:"../bookings/tpl/uploadFilesTPL.html",show:!1,placement:"right",backdrop:!1,animation:"am-slide-bottom"});$scope.fileTypeList={availableOptions:[{id:"resume",name:"Resume"},{id:"profile",name:"Profile"}],selectedOption:{id:"resume",name:"Resume"}},$scope.openToUpload=function(){uploadFilesTPL.show()},$scope.uploadfileButton=function(files){console.log("uploading starting..",files),files&&(console.log("there is file"),$scope.upload(files))},$scope.upload=function(file){var paremeter=$routeParams.cid+" "+$scope.fileTypeList.selectedOption.id;Upload.upload({url:"/uploadProfileFile?parameter="+paremeter,method:"POST",data:{file:file}}).then(function(resp){0===resp.data.error_code?(console.log(resp.data.filename),saveFileurl(resp.data.filename)):$window.alert("an error occured")},function(resp){console.log("Error status: "+resp.status),$window.alert("Error status: "+resp.status)},function(evt){console.log(evt);var progressPercentage=parseInt(100*evt.loaded/evt.total);console.log("progress: "+progressPercentage+"% "+evt.config.data.file.name),vm.progress="progress: "+progressPercentage+"% "})},$scope.createPlacementPDF=function(){$http.get("/createPlacementPDF?cid="+$routeParams.cid+"&fname="+$scope.profile.first_name+"&mname="+$scope.profile.middle_name+"&lname="+$scope.profile.last_name+"&gender="+$scope.profile.gender+"&dob="+$scope.profile.dob+"&nationality="+$scope.profile.nationality+"&tripName="+$scope.profile.trip_experience_name+"&tripLocation="+$scope.profile.trip_destination+"&tripCode="+$scope.profile.trip_code+"&tripStartDate="+$scope.profile.date_departure+"&phone="+$scope.profile.prefferd_contact_no+"&email="+$scope.profile.email+"&address="+$scope.profile.address+"&suburb="+$scope.profile.suburb+"&state="+$scope.profile.state+"&country="+$scope.profile.country+"&postCode="+$scope.profile.post_code+"&emergencyName="+$scope.profile.emrg_contact_name+"&emergencyRelationship="+$scope.profile.emrg_contact_relation+"&emergencyEmail="+$scope.profile.emrg_contact_email+"&emergencyPhone="+$scope.profile.emrg_contact_number+"&healthCondition="+$scope.profile.health_conditions+"&healthConditionDescribe="+$scope.profile.health_conditions_describe+"&dietary="+$scope.profile.dietary+"&dietaryDescribe="+$scope.profile.dietary_describe).success(function(data){function downloadPlaceformpdf(){var s=$rootScope.remoteURL+"/"+$scope.pfurl;$window.open(s,"_blank")}console.log(data),$scope.pfurl=data,$timeout(downloadPlaceformpdf,7e3)})}}]),app.controller("resumeCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location",function($scope,$http,$interval,$filter,NgTableParams,$routeParams,$location){function findResumes(){$http.get("/findResumes?action="+$scope.actionQuery).success(function(data){console.log(data),$scope.resumes=data,$scope.resumesTable=new NgTableParams({page:1,count:10,sorting:{submission_date:"desc"}},{total:$scope.resumes.length,getData:function(params){return $scope.data=params.sorting()?$filter("orderBy")($scope.resumes,params.orderBy()):$scope.resumes,$scope.data=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data,$scope.data=$scope.data.slice((params.page()-1)*params.count(),params.page()*params.count()),$scope.data}})})}"superadmin"==$scope.staffRole||"coordinator"==$scope.staffRole||"arrivals"==$scope.staffRole?console.log("works fine"):(console.log("no permission dude"),$location.path("/")),$scope.actionQuery="incomplete",findResumes(),$scope.actionQueryChange=function(){findResumes()},$scope.viewForm=function(r){var id=r.r_id;$location.path("/viewForm/"+id)}}]),app.controller("resumeformCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location","$attrs","Upload","$window","$timeout","$rootScope","$aside",function($scope,$http,$interval,$filter,NgTableParams,$routeParams,$location,$attrs,Upload,$window,$timeout,$rootScope,$aside){function findform(){$http.get("/findform?rid="+$routeParams.id).success(function(data){console.log(data[0]),$scope.form=data[0],console.log("test photo url here",data[0].photo_url),$scope.src="/"+data[0].photo_url,$http.get($scope.src).success(function(data,status){console.log("ac",status)}).error(function(data,status){console.log("bc",status),$scope.src="http://globalworkandtravel.com/resume/uploads/"+$scope.form.photo_url,console.log("test photo url here",$scope.src)}),"complete"==$scope.form.action?$scope.action="complete":$scope.action="incomplete",$scope.actionChange=function(){console.log($scope.action),$http.post("/updateAction?rid="+$routeParams.id+"&action="+$scope.action).success(function(returnDate){console.log("action status updated"),$scope.form.modified_date="just now"})},$scope.viewContact={editableValue1:$scope.form.fname,editableValue2:$scope.form.mname,editableValue3:$scope.form.lname,editableValue4:$scope.form.email,editableValue5:$scope.form.phoneno,editableValue6:$scope.form.skype,id1:"fname",id2:"mname",id3:"lname",id4:"email",id5:"phoneno",id6:"skype"},$scope.viewIntro={editableValue:$scope.form.introduce,id:"introduce"},$scope.viewObjective={editableValue:$scope.form.objective,id:"objective"},$scope.viewSkills={editableValue:$scope.form.skill1,id:"skill1"},$scope.viewEducation={editableValue1:$scope.form.title1,editableValue2:$scope.form.institution1,editableValue3:$scope.form.educationfrom1,editableValue4:$scope.form.educationto1,editableValue5:$scope.form.title2,editableValue6:$scope.form.institution2,editableValue7:$scope.form.educationfrom2,editableValue8:$scope.form.educationto2,editableValue9:$scope.form.title3,editableValue10:$scope.form.institution3,editableValue11:$scope.form.educationfrom3,editableValue12:$scope.form.educationto3,id1:"title1",id2:"institution1",id3:"educationfrom1",id4:"educationto1",id5:"title2",id6:"institution2",id7:"educationfrom2",id8:"educationto2",id9:"title3",id10:"institution3",id11:"educationfrom3",id12:"educationto3"},$scope.viewCertificates={editableValue:$scope.form.certificate,id:"certificate"},$scope.viewLicenses={editableValue:$scope.form.license,id:"license"},$scope.viewEmployment={editableValue1:$scope.form.jtitle1,editableValue2:$scope.form.cname1,editableValue3:$scope.form.cwebsite1,editableValue4:$scope.form.jfrom1,editableValue5:$scope.form.jto1,editableValue6:$scope.form.duty1,editableValue7:$scope.form.jtitle2,editableValue8:$scope.form.cname2,editableValue9:$scope.form.cwebsite2,editableValue10:$scope.form.jfrom2,editableValue11:$scope.form.jto2,editableValue12:$scope.form.duty2,editableValue13:$scope.form.jtitle3,editableValue14:$scope.form.cname3,editableValue15:$scope.form.cwebsite3,editableValue16:$scope.form.jfrom3,editableValue17:$scope.form.jto3,editableValue18:$scope.form.duty3,editableValue19:$scope.form.jtitle4,editableValue20:$scope.form.cname4,editableValue21:$scope.form.cwebsite4,editableValue22:$scope.form.jfrom4,editableValue23:$scope.form.jto4,editableValue24:$scope.form.duty4,editableValue25:$scope.form.jtitle5,editableValue26:$scope.form.cname5,editableValue27:$scope.form.cwebsite5,editableValue28:$scope.form.jfrom5,editableValue29:$scope.form.jto5,editableValue30:$scope.form.duty5,id1:"jtitle1",id2:"cname1",id3:"cwebsite1",id4:"jfrom1",id5:"jto1",id6:"duty1",id7:"jtitle2",id8:"cname2",id9:"cwebsite2",id10:"jfrom2",id11:"jto2",id12:"duty2",id13:"jtitle3",id14:"cname3",id15:"cwebsite3",id16:"jfrom3",id17:"jto3",id18:"duty3",id19:"jtitle4",id20:"cname4",id21:"cwebsite4",id22:"jfrom4",id23:"jto4",id24:"duty4",id25:"jtitle5",id26:"cname5",id27:"cwebsite5",id28:"jfrom5",id29:"jto5",id30:"duty5"},$scope.enableEditorButtons=function(field){-1===$scope.changingFieldArray.indexOf(field)&&$scope.changingFieldArray.push(field),editingResumeButtonsTPL.show(),console.log($scope.changingFieldArray)},$scope.cancelResumeChange=function(){editingResumeButtonsTPL.hide(),console.log("cancel profile changes"),$scope.viewContact.editableValue1=$scope.form.fname,$scope.viewContact.editableValue2=$scope.form.mname,$scope.viewContact.editableValue3=$scope.form.lname,$scope.viewContact.editableValue4=$scope.form.email,$scope.viewContact.editableValue5=$scope.form.phoneno,$scope.viewContact.editableValue6=$scope.form.skype,$scope.viewIntro.editableValue=$scope.form.introduce,$scope.viewObjective.editableValue=$scope.form.objective,$scope.viewSkills.editableValue=$scope.form.skill1,$scope.viewEducation.editableValue1=$scope.form.title1,$scope.viewEducation.editableValue2=$scope.form.institution1,$scope.viewEducation.editableValue3=$scope.form.educationfrom1,$scope.viewEducation.editableValue4=$scope.form.educationto1,$scope.viewEducation.editableValue5=$scope.form.title2,$scope.viewEducation.editableValue6=$scope.form.institution2,$scope.viewEducation.editableValue7=$scope.form.educationfrom2,$scope.viewEducation.editableValue8=$scope.form.educationto2,$scope.viewEducation.editableValue9=$scope.form.title3,$scope.viewEducation.editableValue10=$scope.form.institution3,$scope.viewEducation.editableValue11=$scope.form.educationfrom3,$scope.viewEducation.editableValue12=$scope.form.educationto3,$scope.viewCertificates.editableValue=$scope.form.certificate,$scope.viewLicenses.editableValue=$scope.form.license,$scope.viewEmployment.editableValue1=$scope.form.jtitle1,$scope.viewEmployment.editableValue2=$scope.form.cname1,$scope.viewEmployment.editableValue3=$scope.form.cwebsite1,$scope.viewEmployment.editableValue4=$scope.form.jfrom1,$scope.viewEmployment.editableValue5=$scope.form.jto1,$scope.viewEmployment.editableValue6=$scope.form.duty1,$scope.viewEmployment.editableValue7=$scope.form.jtitle2,$scope.viewEmployment.editableValue8=$scope.form.cname2,$scope.viewEmployment.editableValue9=$scope.form.cwebsite2,$scope.viewEmployment.editableValue10=$scope.form.jfrom2,$scope.viewEmployment.editableValue11=$scope.form.jto2,$scope.viewEmployment.editableValue12=$scope.form.duty2,$scope.viewEmployment.editableValue13=$scope.form.jtitle3,$scope.viewEmployment.editableValue14=$scope.form.cname3,$scope.viewEmployment.editableValue15=$scope.form.cwebsite3,$scope.viewEmployment.editableValue16=$scope.form.jfrom3,$scope.viewEmployment.editableValue17=$scope.form.jto3,$scope.viewEmployment.editableValue18=$scope.form.duty3,$scope.viewEmployment.editableValue19=$scope.form.jtitle4,$scope.viewEmployment.editableValue20=$scope.form.cname4,$scope.viewEmployment.editableValue21=$scope.form.cwebsite4,$scope.viewEmployment.editableValue22=$scope.form.jfrom4,$scope.viewEmployment.editableValue23=$scope.form.jto4,$scope.viewEmployment.editableValue24=$scope.form.duty4,$scope.viewEmployment.editableValue25=$scope.form.jtitle5,$scope.viewEmployment.editableValue26=$scope.form.cname5,$scope.viewEmployment.editableValue27=$scope.form.cwebsite5,$scope.viewEmployment.editableValue28=$scope.form.jfrom5,$scope.viewEmployment.editableValue29=$scope.form.jto5,$scope.viewEmployment.editableValue30=$scope.form.duty5,$scope.changingFieldArray=[],$scope.changingFinalData=[]},$scope.saveResumeChange=function(){$scope.showSpinner=!0,console.log("saving resume changes starting.."),$scope.saveContact(),$scope.saveIntro(),$scope.saveObjective(),$scope.saveSkills(),$scope.saveEducation(),$scope.saveCertificates(),$scope.saveLicenses(),$scope.saveEmployment(),console.log($scope.changingFieldArray);for(var i=0;i<$scope.changingFieldArray.length;i++){var one={};one.field=$scope.changingFieldArray[i],one.value=$scope.form[one.field],console.log("original value",one.value),one.value=one.value.replace(/&/g,"specialCharacter"),one.value=one.value.replace(/%/g,"htmlemtity2"),one.value=one.value.replace(/#/g,"htmlemtity3"),console.log("new value",one.value),one.rid=$routeParams.id,$scope.changingFinalData.push(one)}console.log("final object",$scope.changingFinalData);var changingFinalDataJSON=JSON.stringify($scope.changingFinalData);console.log("json is ",changingFinalDataJSON),$http.post("/updateResumeChangedData?changingFinalDataJSON="+changingFinalDataJSON).success(function(datar){console.log(datar),$rootScope.startAlert("success","Success","Updated Successfully!"),editingResumeButtonsTPL.hide(),$scope.changingFieldArray=[],$scope.changingFinalData=[],$scope.showSpinner=!1})},$scope.saveContact=function(){$scope.form.fname=$scope.viewContact.editableValue1,$scope.form.mname=$scope.viewContact.editableValue2,$scope.form.lname=$scope.viewContact.editableValue3,$scope.form.email=$scope.viewContact.editableValue4,$scope.form.phoneno=$scope.viewContact.editableValue5,$scope.form.skype=$scope.viewContact.editableValue6},$scope.saveIntro=function(){$scope.form.introduce=$scope.viewIntro.editableValue},$scope.saveObjective=function(){$scope.form.objective=$scope.viewObjective.editableValue},$scope.saveSkills=function(){$scope.form.skill1=$scope.viewSkills.editableValue},$scope.saveEducation=function(){$scope.form.title1=$scope.viewEducation.editableValue1,$scope.form.institution1=$scope.viewEducation.editableValue2,$scope.form.educationfrom1=$scope.viewEducation.editableValue3,$scope.form.educationto1=$scope.viewEducation.editableValue4,$scope.form.title2=$scope.viewEducation.editableValue5,$scope.form.institution2=$scope.viewEducation.editableValue6,$scope.form.educationfrom2=$scope.viewEducation.editableValue7,$scope.form.educationto2=$scope.viewEducation.editableValue8,$scope.form.title3=$scope.viewEducation.editableValue9,$scope.form.institution3=$scope.viewEducation.editableValue10,$scope.form.educationfrom3=$scope.viewEducation.editableValue11,$scope.form.educationto3=$scope.viewEducation.editableValue12},$scope.saveCertificates=function(){$scope.form.certificate=$scope.viewCertificates.editableValue},$scope.saveLicenses=function(){$scope.form.license=$scope.viewLicenses.editableValue},$scope.saveEmployment=function(){$scope.form.jtitle1=$scope.viewEmployment.editableValue1,$scope.form.cname1=$scope.viewEmployment.editableValue2,$scope.form.cwebsite1=$scope.viewEmployment.editableValue3,$scope.form.jfrom1=$scope.viewEmployment.editableValue4,$scope.form.jto1=$scope.viewEmployment.editableValue5,$scope.form.duty1=$scope.viewEmployment.editableValue6,$scope.form.jtitle2=$scope.viewEmployment.editableValue7,$scope.form.cname2=$scope.viewEmployment.editableValue8,$scope.form.cwebsite2=$scope.viewEmployment.editableValue9,$scope.form.jfrom2=$scope.viewEmployment.editableValue10,$scope.form.jto2=$scope.viewEmployment.editableValue11,$scope.form.duty2=$scope.viewEmployment.editableValue12,$scope.form.jtitle3=$scope.viewEmployment.editableValue13,$scope.form.cname3=$scope.viewEmployment.editableValue14,$scope.form.cwebsite3=$scope.viewEmployment.editableValue15,$scope.form.jfrom3=$scope.viewEmployment.editableValue16,$scope.form.jto3=$scope.viewEmployment.editableValue17,$scope.form.duty3=$scope.viewEmployment.editableValue18,$scope.form.jtitle4=$scope.viewEmployment.editableValue19,$scope.form.cname4=$scope.viewEmployment.editableValue20,$scope.form.cwebsite4=$scope.viewEmployment.editableValue21,$scope.form.jfrom4=$scope.viewEmployment.editableValue22,$scope.form.jto4=$scope.viewEmployment.editableValue23,$scope.form.duty4=$scope.viewEmployment.editableValue24,$scope.form.jtitle5=$scope.viewEmployment.editableValue25,$scope.form.cname5=$scope.viewEmployment.editableValue26,$scope.form.cwebsite5=$scope.viewEmployment.editableValue27,$scope.form.jfrom5=$scope.viewEmployment.editableValue28,$scope.form.jto5=$scope.viewEmployment.editableValue29,$scope.form.duty5=$scope.viewEmployment.editableValue30},$scope.viewIMG={editorEnabled:!1},$scope.enableEditorIMG=function(){$scope.viewIMG.editorEnabled=!0},$scope.disableEditorIMG=function(){$scope.viewIMG.editorEnabled=!1},$scope.saveIMG=function(upload_form){function upload(file){console.log("upload test here"),Upload.upload({url:"/uploadpicture",data:{file:file}}).then(function(resp){console.log("test response after upload",resp.data.error_code),1===resp.data.error_code?$window.alert("an error occured"):(console.log(resp.data.filename),$http.post("/savefilename?fn="+resp.data.filename+"&rid="+$routeParams.id).success(function(data){console.log("updated file into database successfully"),$scope.form.modified_date="just now",$scope.src="/"+resp.data.filename}))},function(resp){console.log("Error status: "+resp.status),$window.alert("Error status: "+resp.status)},function(evt){console.log(evt);var progressPercentage=parseInt(100*evt.loaded/evt.total);console.log("progress: "+progressPercentage+"% "+evt.config.data.file.name),$scope.progress="progress: "+progressPercentage+"% "})}$scope.disableEditorIMG(),console.log("avc test");upload_form.file.$valid&&$scope.file&&(console.log("hello "),upload($scope.file))},$scope.form.title2||$scope.form.institution2||$scope.form.educationfrom2||$scope.form.educationto2||($scope.cancelalleducation2=function(){$scope.hideEducation2=!0}),$scope.form.title3||$scope.form.institution3||$scope.form.educationfrom3||$scope.form.educationto3||($scope.cancelalleducation3=function(){$scope.hideEducation3=!0}),$scope.form.jtitle2||$scope.form.cname2||$scope.form.cwebsite2||$scope.form.jfrom2||$scope.form.jto2||$scope.form.duty2||($scope.cancelallemployment2=function(){$scope.hideEmployment2=!0}),$scope.form.jtitle3||$scope.form.cname3||$scope.form.cwebsite3||$scope.form.jfrom3||$scope.form.jto3||$scope.form.duty3||($scope.cancelallemployment3=function(){$scope.hideEmployment3=!0}),$scope.form.jtitle4||$scope.form.cname4||$scope.form.cwebsite4||$scope.form.jfrom4||$scope.form.jto4||$scope.form.duty4||($scope.cancelallemployment4=function(){$scope.hideEmployment4=!0}),$scope.form.jtitle5||$scope.form.cname5||$scope.form.cwebsite5||$scope.form.jfrom5||$scope.form.jto5||$scope.form.duty5||($scope.cancelallemployment5=function(){$scope.hideEmployment5=!0}),data[0].title2||data[0].institution2||data[0].educationfrom2||data[0].educationto2?($scope.hideEducation2=!1,$scope.hideEC2=!0):($scope.hideEducation2=!0,$scope.hideEC2=!1),data[0].title3||data[0].institution3||data[0].educationfrom3||data[0].educationto3?($scope.hideEducation3=!1,$scope.hideEC3=!0):($scope.hideEducation3=!0,$scope.hideEC3=!1),data[0].jtitle2||data[0].cname2||data[0].cwebsite2||data[0].jfrom2||data[0].jto2||data[0].duty2?($scope.hideEmployment2=!1,$scope.hideEPC2=!0):($scope.hideEmployment2=!0,$scope.hideEPC2=!1),data[0].jtitle3||data[0].cname3||data[0].cwebsite3||data[0].jfrom3||data[0].jto3||data[0].duty3?($scope.hideEmployment3=!1,$scope.hideEPC3=!0):($scope.hideEmployment3=!0,$scope.hideEPC3=!1),data[0].jtitle4||data[0].cname4||data[0].cwebsite4||data[0].jfrom4||data[0].jto4||data[0].duty4?($scope.hideEmployment4=!1,$scope.hideEPC4=!0):($scope.hideEmployment4=!0,$scope.hideEPC4=!1),data[0].jtitle5||data[0].cname5||data[0].cwebsite5||data[0].jfrom5||data[0].jto5||data[0].duty5?($scope.hideEmployment5=!1,$scope.hideEPC5=!0):($scope.hideEmployment5=!0,$scope.hideEPC5=!1),$scope.addoneEducation=function(){1==$scope.hideEducation2?$scope.hideEducation2=!1:1==$scope.hideEducation3?$scope.hideEducation3=!1:console.log("mate, 3 education is enough here")},$scope.addoneEmployment=function(){1==$scope.hideEmployment2?$scope.hideEmployment2=!1:1==$scope.hideEmployment3?$scope.hideEmployment3=!1:1==$scope.hideEmployment4?$scope.hideEmployment4=!1:1==$scope.hideEmployment5&&($scope.hideEmployment5=!1)},$scope.createpdf=function(){$http.post("/createpdf?rid="+$routeParams.id+"&url="+$scope.src).success(function(data){function downloadpdf(){var s=$rootScope.remoteURL+"/"+$scope.dd;$window.open(s,"_blank")}console.log(data),$scope.dd=data,$timeout(downloadpdf,7e3)})}})}$scope.showSpinner=!1,"superadmin"==$scope.staffRole||"coordinator"==$scope.staffRole||"arrivals"==$scope.staffRole?console.log("works fine"):(console.log("no permission dude"),$location.path("/")),$scope.id=$routeParams.id,$scope.changingFieldArray=[],$scope.changingFinalData=[];var editingResumeButtonsTPL=$aside({scope:$scope,template:"../coordination/editingResumeButtonsTPL.html",show:!1,placement:"right",backdrop:!1,animation:"am-slide-bottom"});findform()}]),app.controller("searchccCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location",function($scope,$http,$interval,$filter,NgTableParams,$routeParams,$location){"superadmin"==$scope.staffRole||"coordinator"==$scope.staffRole?console.log("works fine"):(console.log("no permission dude"),$location.path("/")),$scope.findcid=function(){function findfromcid(){$http.get("/findfromcid?cid="+$scope.CID).success(function(data){$scope.cinfo=data[0],console.log($scope.cinfo)})}findfromcid()}}]),app.controller("searchPaymentCtrl",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location","$rootScope",function($scope,$http,$interval,$filter,NgTableParams,$routeParams,$location,$rootScope){function findmergePayments(){$http.get("/findmergePayments").success(function(data){for($scope.allpayments=data,$scope.data=data,i=0;i<$scope.data.length;i++){var a=$scope.data[i].first_name.trim(),b=$scope.data[i].last_name.trim();$scope.data[i].customerName=a+" "+b}$scope.tableParams=new NgTableParams({page:1,count:10,sorting:{firstname:"asc"}},{filterDelay:50,total:$scope.data.length,getData:function($defer,params){var searchStr=params.filter().search,searchStr2=params.filter().search2,startStr=params.filter().start,endStr=params.filter().end,status=params.filter().statusSelect;console.log("search: "+searchStr),console.log("search2: "+searchStr2),console.log("start: "+startStr),console.log("end: "+endStr),console.log("status: "+status);var mydata=[];for(mydata=$scope.data,$scope.totalNextAmount=0,$scope.totalPaidAmount=0,searchStr&&(console.log("test test"),searchStr=searchStr.toLowerCase(),
mydata=mydata.filter(function(item){return item.customerName.toLowerCase().indexOf(searchStr)>-1})),searchStr2&&(searchStr2=searchStr2.toLowerCase(),mydata=mydata.filter(function(item){return item.Staff.toLowerCase().indexOf(searchStr2)>-1})),startStr&&endStr?mydata=mydata.filter(function(item){return item.paymentDate>=startStr&&item.paymentDate<=endStr}):startStr?mydata=mydata.filter(function(item){return item.paymentDate>=startStr}):endStr&&(mydata=mydata.filter(function(item){return item.paymentDate<=endStr})),status&&(mydata=mydata.filter(function(item){return item.paymentStatus==status})),console.log(mydata),i=0;i<mydata.length;i++)"Next"==mydata[i].paymentStatus?$scope.totalNextAmount=$scope.totalNextAmount+parseInt(mydata[i].paymentAmount):"Paid"==mydata[i].paymentStatus&&($scope.totalPaidAmount=$scope.totalPaidAmount+parseInt(mydata[i].paymentAmount)),i==mydata.length-1&&($scope.totalNextAmount=$scope.totalNextAmount.toLocaleString(),$scope.totalPaidAmount=$scope.totalPaidAmount.toLocaleString());mydata=params.sorting()?$filter("orderBy")(mydata,params.orderBy()):mydata,$defer.resolve(mydata.slice((params.page()-1)*params.count(),params.page()*params.count()))}})})}"superadmin"==$scope.staffRole||"coordinator"==$scope.staffRole?console.log("works fine"):(console.log("no permission dude"),$location.path("/")),$scope.reset=function(){window.location.reload()},$scope.overduess=!1,findmergePayments(),$scope.checkboxCheck=function(){function load_pictures(){$http.get("/findOverdues").success(function(data){for($scope.data=data,console.log(data),i=0;i<$scope.data.length;i++){var a=$scope.data[i].first_name.trim(),b=$scope.data[i].last_name.trim();$scope.data[i].customerName=a+" "+b}$scope.tableParams=new NgTableParams({page:1,count:10,sorting:{firstname:"asc"}},{filterDelay:50,total:data.length,getData:function($defer,params){var searchStr=params.filter().search,searchStr2=params.filter().search2,startStr=params.filter().start,endStr=params.filter().end,status=params.filter().statusSelect;console.log("search: "+searchStr),console.log("search2: "+searchStr2),console.log("start: "+startStr),console.log("end: "+endStr),console.log("status: "+status);var mydata=[];for(mydata=$scope.data,$scope.totalNextAmount=0,$scope.totalPaidAmount=0,searchStr&&(console.log("test test"),searchStr=searchStr.toLowerCase(),mydata=mydata.filter(function(item){return item.customerName.toLowerCase().indexOf(searchStr)>-1})),searchStr2&&(searchStr2=searchStr2.toLowerCase(),mydata=mydata.filter(function(item){return item.Staff.toLowerCase().indexOf(searchStr2)>-1})),startStr&&endStr?mydata=mydata.filter(function(item){return item.paymentDate>=startStr&&item.paymentDate<=endStr}):startStr?mydata=mydata.filter(function(item){return item.paymentDate>=startStr}):endStr&&(mydata=mydata.filter(function(item){return item.paymentDate<=endStr})),status&&(mydata=mydata.filter(function(item){return item.paymentStatus==status})),i=0;i<mydata.length;i++)"Next"==mydata[i].paymentStatus?$scope.totalNextAmount=$scope.totalNextAmount+parseInt(mydata[i].paymentAmount):"Paid"==mydata[i].paymentStatus&&($scope.totalPaidAmount=$scope.totalPaidAmount+parseInt(mydata[i].paymentAmount)),i==mydata.length-1&&($scope.totalNextAmount=$scope.totalNextAmount.toLocaleString(),$scope.totalPaidAmount=$scope.totalPaidAmount.toLocaleString());mydata=params.sorting()?$filter("orderBy")(mydata,params.orderBy()):mydata,$defer.resolve(mydata.slice((params.page()-1)*params.count(),params.page()*params.count()))}})})}$scope.overduess?(load_pictures(),console.log("overdue data")):(console.log("all data"),findmergePayments())},$scope.update=function(p){function changePayment(){$http.get("/changePayment?paymentID="+paymentID+"&paymentAmount="+paymentAmount+"&paymentStatus="+paymentStatus+"&paymentDate="+paymentDate).success(function(d){$rootScope.startAlert("info","Success","Well done! You have successfully updated.","md md-done")})}var payment=[];payment[0]=p.paymentID,payment[1]=p.paymentAmount,payment[2]=p.paymentStatus,payment[3]=p.paymentDate;var paymentID=payment[0],paymentAmount=payment[1],paymentStatus=payment[2],paymentDate=payment[3];console.log("test array",payment),changePayment()}}]),app.controller("searchCtrl",["$scope","$http","$routeParams","$location",function($scope,$http,$routeParams,$location){$scope.a="abcv"}]),app.controller("testController",["$scope","$http","$interval","$filter","NgTableParams","$routeParams","$location","$timeout","promiseTracker","$rootScope",function($scope,$http,$interval,$filter,NgTableParams,$routeParams,$location,$timeout,promiseTracker,$rootScope){function testMongoose(){$http.get("/testMongoose").success(function(data){console.log("hello mongoose")})}testMongoose()}]),app.controller("usersCtrl",["$scope","$window","$aside","$http","$location","$rootScope","$route",function($scope,$window,$aside,$http,$location,$rootScope,$route){function findUsers(){$http.get("/findUsers").success(function(data2){console.log(data2),$scope.data=data2})}"superadmin"==$scope.staffRole?console.log("hello super admin"):(console.log("you are not super admin"),$location.path("/")),$scope.settings={singular:"User",plural:"Users",cmd:"Add"},$scope.roleselect={availableOptions:[{id:"admin",name:"admin"},{id:"travel",name:"travel"},{id:"coordinator",name:"coordinator"},{id:"finance",name:"finance"},{id:"compliance",name:"compliance"},{id:"superadmin",name:"superadmin"},{id:"sales",name:"sales"},{id:"arrivals",name:"arrivals"},{id:"cancellation",name:"cancellation"}],selectedOption:{id:"admin",name:"admin"}},$scope.officeselect={availableOptions:[{id:"australia",name:"australia"},{id:"canada",name:"canada"},{id:"uk",name:"uk"}],selectedOption:{id:"australia",name:"australia"}},findUsers();var formTpl=$aside({scope:$scope,template:"../setting/users-form.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-left"}),formEditTpl=$aside({scope:$scope,template:"../setting/edit.html",show:!1,placement:"left",backdrop:!1,animation:"am-slide-bottom"});$scope.checkAll=function(){angular.forEach($scope.data,function(item){item.selected=!item.selected})},$scope.editItem=function(item){item&&(item.editing=!0,$scope.item=item,$scope.roleselect.selectedOption.name=item.role,$scope.roleselect.selectedOption.id=item.role,$scope.officeselect.selectedOption.name=item.office,$scope.officeselect.selectedOption.id=item.office,console.log("this item need to be edited:",item.email,item.id),$scope.settings.cmd="Edit",console.log($scope.settings.cmd),$scope.editconfirm=!0,showEditForm())},$scope.changeP=function(item){item&&(item.editing=!0,item.hide=!0,$scope.item=item,$scope.item.password="",$scope.settings.cmd="changeP",showForm())},$scope.viewItem=function(item){item&&(item.editing=!1,item.hide=!1,$scope.item=item,$scope.roleselect.selectedOption.name=item.role,$scope.roleselect.selectedOption.id=item.role,$scope.officeselect.selectedOption.name=item.office,$scope.officeselect.selectedOption.id=item.office,$scope.settings.cmd="View",showForm())},$scope.createItem=function(){var item={editing:!0,hide:!1};$scope.item=item,$scope.settings.cmd="New",showForm()},$scope.saveItem=function(){console.log($scope.settings.cmd),"New"==$scope.settings.cmd&&($scope.item.password==$scope.item.repeatedpassword?$http.post("/addUser?f="+$scope.item.first_name+"&l="+$scope.item.last_name+"&r="+$scope.roleselect.selectedOption.name+"&o="+$scope.officeselect.selectedOption.name+"&e="+$scope.item.email+"&p="+$scope.item.password).success(function(data10){$scope.item.role=$scope.roleselect.selectedOption.name,$scope.item.office=$scope.officeselect.selectedOption.name,$scope.data.push($scope.item),$rootScope.startAlert("success","Success","Well done! You have successfully added a new user.","md md-done"),console.log(data10),hideForm()}):($rootScope.startAlert("danger","Error","Please check the password and type again","md md-error"),hideForm())),"changeP"==$scope.settings.cmd&&($scope.item.password==$scope.item.repeatedpassword?$http.post("/changePassword?p="+$scope.item.password+"&e="+$scope.item.email).success(function(data12){$rootScope.startAlert("success","Success","Well done! You have successfully changes the password.","md md-done"),hideForm()}):($rootScope.startAlert("danger","Error","Please confirm your password","md md-error"),hideForm()))},$scope.saveEditItem=function(){console.log("for editing test"),console.log($scope.settings.cmd),"Edit"==$scope.settings.cmd&&(console.log("time to edit"),$http.post("/editUser?f="+$scope.item.first_name+"&l="+$scope.item.last_name+"&r="+$scope.roleselect.selectedOption.name+"&o="+$scope.officeselect.selectedOption.name+"&e="+$scope.item.email+"&id="+$scope.item.id).success(function(data11){$rootScope.startAlert("success","Success","Well done! You have successfully edited this user info.","md md-done"),$route.reload()}))},$scope.remove=function(item){confirm("Are you sure?")&&(item?(console.log("test here",item.email),$http.post("/deleteUser?email="+item.email).success(function(data3){$rootScope.startAlert("info","Success","You have just successfully deleted a user.","md md-done"),$scope.data.splice($scope.data.indexOf(item),1)})):(console.log(item,"testha"),$rootScope.startAlert("info","Success","You have just successfully removed multiple users.","md md-done"),$scope.data=$scope.data.filter(function(item){return item.selected&&$http.post("/deleteUser?email="+item.email).success(function(data3){console.log(item.first_name,"deleted")}),!item.selected}),console.log("test 2 here"),$scope.selectAll=!1))},showForm=function(){angular.element(".tooltip").remove(),formTpl.show()},showEditForm=function(){angular.element(".tooltip").remove(),formEditTpl.show()},hideForm=function(){formTpl.hide()},hideEditForm=function(){formEditTpl.hide()},$scope.$on("$destroy",function(){hideForm(),hideEditForm()})}]),app.controller("wronglocationCtrl",["$scope","$http","$interval","$filter","$routeParams","$location","$timeout",function($scope,$http,$interval,$filter,$routeParams,$location,$timeout){}]),app.config(["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){$routeProvider.when("/customer",{templateUrl:"../bookings/customer.html"}).when("/viewProfile/:cid",{templateUrl:"../bookings/profile.html"}).when("/searchcc",{templateUrl:"../bookings/searchcc.html"}).when("/newCustomer",{templateUrl:"../payment/newCustomer.html"}).when("/addPayment",{templateUrl:"../payment/addPayment.html"}).when("/searchPayment",{templateUrl:"../payment/searchPayment.html"}).when("/compliance",{templateUrl:"../compliance/compliance.html"}).when("/listInCompliance",{templateUrl:"../compliance/listInCompliance.html"}).when("/listAllCompliance",{templateUrl:"../compliance/listAllCompliance.html"}).when("/resume",{templateUrl:"../coordination/resume.html"}).when("/viewForm/:id",{templateUrl:"../coordination/form.html"}).when("/viewDetails/:cid/:qid",{templateUrl:"../compliance/complianceDetails.html"}).when("/users",{templateUrl:"../setting/users.html"}).when("/bookings",{templateUrl:"../sales/bookings.html"}).when("/adminbookings",{templateUrl:"../admin/adminbookings.html"}).when("/commission",{templateUrl:"../sales/commission.html"}).when("/payroll",{templateUrl:"../sales/payroll.html"}).when("/",{templateUrl:"../dashboard.html"}).when("/test",{templateUrl:"test.html"}).otherwise({templateUrl:"../dashboard.html"})}]),app.config(["cfpLoadingBarProvider",function(cfpLoadingBarProvider){cfpLoadingBarProvider.includeSpinner=!1,cfpLoadingBarProvider.latencyThreshold=300}]),app.config(["$animateProvider",function($animateProvider){$animateProvider.classNameFilter(/^(?:(?!ng-animate-disabled).)*$/)}]);